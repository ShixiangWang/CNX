<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />

        <meta name="author" content="Shixiang Wang, Ziyu Tao, Tao Wu, Huimin Li, Xue-Song Liu (Corresponding author)" />
    
        <meta name="date" content="2021-01-22" />
    
    <title>Pan-Cancer Copy Number Signature Identification and Analysis</title>

        <script src="index_files/header-attrs-2.6/header-attrs.js"></script>
        <script src="index_files/jquery-3.5.1/jquery.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="index_files/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
        <script src="index_files/bootstrap-3.3.7/js/bootstrap.min.js"></script>
        <script src="index_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
        <script src="index_files/navigation-1.1/tabsets.js"></script>
        <link href="index_files/magnific-popup-1.1.0/magnific-popup.css" rel="stylesheet" />
        <script src="index_files/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script>
        <link href="index_files/downcute-0.1/downcute.css" rel="stylesheet" />
        <link href="index_files/downcute-0.1/downcute_fonts_embed.css" rel="stylesheet" />
        <script src="index_files/downcute-0.1/downcute.js"></script>
        <script src="index_files/prism-1.22/prism.js"></script>
        <script src="index_files/htmlwidgets-1.5.3/htmlwidgets.js"></script>
        <link href="index_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
        <script src="index_files/datatables-binding-0.17/datatables.js"></script>
        <link href="index_files/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
        <link href="index_files/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
        <script src="index_files/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
        <link href="index_files/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
        <script src="index_files/crosstalk-1.1.1/js/crosstalk.min.js"></script>
    
    
        <style type="text/css">code{white-space: pre;}</style>
    <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ff0000; font-weight: bold; } /* Alert */
      code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #7d9029; } /* Attribute */
      code span.bn { color: #40a070; } /* BaseN */
      code span.bu { } /* BuiltIn */
      code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4070a0; } /* Char */
      code span.cn { color: #880000; } /* Constant */
      code span.co { color: #60a0b0; font-style: italic; } /* Comment */
      code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #ba2121; font-style: italic; } /* Documentation */
      code span.dt { color: #902000; } /* DataType */
      code span.dv { color: #40a070; } /* DecVal */
      code span.er { color: #ff0000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #40a070; } /* Float */
      code span.fu { color: #06287e; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #007020; font-weight: bold; } /* Keyword */
      code span.op { color: #666666; } /* Operator */
      code span.ot { color: #007020; } /* Other */
      code span.pp { color: #bc7a00; } /* Preprocessor */
      code span.sc { color: #4070a0; } /* SpecialChar */
      code span.ss { color: #bb6688; } /* SpecialString */
      code span.st { color: #4070a0; } /* String */
      code span.va { color: #19177c; } /* Variable */
      code span.vs { color: #4070a0; } /* VerbatimString */
      code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    </style>
    
    
    <!-- tabsets -->
    <script>
      $(document).ready(function () {
	  window.buildTabsets("toc");
      });
      $(document).ready(function () {
	  $('.tabset-dropdown > .nav-tabs > li').click(function () {
	      $(this).parent().toggleClass('nav-tabs-open')
	  });
      });
    </script>

    <!-- code folding -->
    
    <!-- code download -->
    
    <!-- tabsets dropdown -->

    <style type="text/css">
      .tabset-dropdown > .nav-tabs {
	  display: inline-table;
	  max-height: 500px;
	  min-height: 44px;
	  overflow-y: auto;
	  background: white;
	  border: 1px solid #ddd;
	  border-radius: 4px;
      }
      
      .tabset-dropdown > .nav-tabs > li.active:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
	  content: "&#xe258;";
	  border: none;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs > li.active {
	  display: block;
      }

      .tabset-dropdown > .nav-tabs > li.active a {
  	  padding: 0 15px !important;
      }

      .tabset-dropdown > .nav-tabs > li > a,
      .tabset-dropdown > .nav-tabs > li > a:focus,
      .tabset-dropdown > .nav-tabs > li > a:hover {
	  border: none;
	  display: inline-block;
	  border-radius: 4px;
	  background-color: transparent;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li {
	  display: block;
	  float: none;
      }
      
      .tabset-dropdown > .nav-tabs > li {
	  display: none;
	  margin-left: 0 !important;
      }
    </style>
    
</head>

<body class="preload">

   	
               <!-- downcute start -->   
   <div id="docute" class="Root">
     <div class="Page layout-narrow">
      <div class="Wrap">
        <div class="Sidebar">
          <div class="SidebarItems" id="toc">
            <ul>
            <li><a href="#license">LICENSE</a></li>
            <li><a href="#part-0-data-preprocessing">PART 0: Data preprocessing</a>
            <ul>
            <li><a href="#prepare-pcawg-datasets">Prepare PCAWG datasets</a></li>
            <li><a href="#generate-pcawg-sample-by-component-matrix">Generate PCAWG sample-by-component matrix</a></li>
            <li><a href="#prepare-tcga-datasets">Prepare TCGA datasets</a></li>
            <li><a href="#generate-tcga-sample-by-component-matrix">Generate TCGA sample-by-component matrix</a></li>
            <li><a href="#pcawg-genotypephenotype-data-type-and-source">PCAWG genotype/phenotype data type and source</a></li>
            </ul></li>
            <li><a href="#part-1-copy-number-signature-identification-and-activity-attribution">PART 1: Copy number signature identification and activity attribution</a>
            <ul>
            <li><a href="#copy-number-signature-identification">Copy number signature identification</a>
            <ul>
            <li><a href="#apply-to-pcawg-catalog-matrix">Apply to PCAWG catalog matrix</a></li>
            <li><a href="#signature-number-determination">Signature number determination</a></li>
            </ul></li>
            <li><a href="#sample-copy-number-catalog-reconstruction">Sample copy number catalog reconstruction</a></li>
            </ul></li>
            <li><a href="#part-2-signature-profile-visualization-and-analysis">PART 2: Signature profile visualization and analysis</a>
            <ul>
            <li><a href="#signature-profile-visualization">Signature profile visualization</a></li>
            <li><a href="#signature-analysis">Signature analysis</a>
            <ul>
            <li><a href="#signature-similarity">Signature similarity</a></li>
            <li><a href="#signature-activity-distribution">Signature activity distribution</a></li>
            </ul></li>
            <li><a href="#copy-number-profile-and-signature-activity">Copy number profile and signature activity</a>
            <ul>
            <li><a href="#copy-number-profile-for-representative-samples">Copy number profile for representative samples</a></li>
            <li><a href="#ideograph-for-copy-number-profile-reconstruction">Ideograph for copy number profile reconstruction</a></li>
            </ul></li>
            </ul></li>
            <li><a href="#part-3-pan-cancer-signature-analysis">PART 3: Pan-Cancer signature analysis</a>
            <ul>
            <li><a href="#signature-number-and-contribution-in-each-cancer-type">Signature number and contribution in each cancer type</a>
            <ul>
            <li><a href="#signature-activity-in-each-cancer-type">Signature activity in each cancer type</a></li>
            <li><a href="#signature-landscape">Signature landscape</a></li>
            <li><a href="#signature-number-distribution">Signature number distribution</a></li>
            </ul></li>
            <li><a href="#cancer-type-associated-enrichment">Cancer type associated enrichment</a></li>
            </ul></li>
            <li><a href="#part-4-cancer-subtyping-and-prognosis-analysis">PART 4: Cancer subtyping and prognosis analysis</a>
            <ul>
            <li><a href="#data-integration">Data integration</a></li>
            <li><a href="#clustering-with-signature-activity">Clustering with signature activity</a>
            <ul>
            <li><a href="#step-1-select-suitable-method-combination">Step 1: select suitable method combination</a></li>
            <li><a href="#step-2-select-suitable-cluster-number">Step 2: select suitable cluster number</a></li>
            </ul></li>
            <li><a href="#heatmap-for-clustering-and-genotypephenotype-features">Heatmap for clustering and genotype/phenotype features</a></li>
            <li><a href="#exploration-of-patients-prognosis-difference-across-clusters">Exploration of patients’ prognosis difference across clusters</a>
            <ul>
            <li><a href="#clean-data-for-survival-analysis">Clean data for survival analysis</a></li>
            <li><a href="#forest-plot">Forest plot</a></li>
            <li><a href="#k-m-plot">K-M plot</a></li>
            </ul></li>
            <li><a href="#the-difference-of-genotypephenotype-measures-across-clusters">The difference of genotype/phenotype measures across clusters</a>
            <ul>
            <li><a href="#signatures">Signatures</a></li>
            <li><a href="#other-integrated-variables">Other integrated variables</a></li>
            <li><a href="#driver-genes">Driver genes</a></li>
            </ul></li>
            </ul></li>
            <li><a href="#part-5-inference-of-copy-number-signature-etiologies">PART 5: Inference of copy number signature etiologies</a>
            <ul>
            <li><a href="#association-analysis-for-copy-number-signatures">Association analysis for copy number signatures</a>
            <ul>
            <li><a href="#copy-number-signature-activity-self-association">Copy number signature activity self-association</a></li>
            <li><a href="#copy-number-signatures-and-cosmic-signatures">Copy number signatures and COSMIC signatures</a></li>
            <li><a href="#signature-clustering">Signature clustering</a></li>
            <li><a href="#association-between-cns-and-genotypephenotype-features">Association between CNS and genotype/phenotype features</a></li>
            <li><a href="#association-between-cns-and-patients-prognosis">Association between CNS and patients’ prognosis</a></li>
            </ul></li>
            <li><a href="#signature-similarity-comparison-between-different-types-of-signatures">Signature similarity comparison between different types of signatures</a></li>
            <li><a href="#data-summary-and-inference-of-signature-etiologies">Data summary and inference of signature etiologies</a></li>
            </ul></li>
            <li><a href="#supplementary-analyses">Supplementary Analyses</a>
            <ul>
            <li><a href="#cns-validation">CNS validation</a>
            <ul>
            <li><a href="#tcga-cns">TCGA CNS</a></li>
            <li><a href="#merged-cns-from-clustering-of-cancer-type-associated-cns">Merged CNS from clustering of cancer-type associated CNS</a></li>
            </ul></li>
            <li><a href="#pcawg-and-tcga-pan-cancer-copy-number-alteration-profile-and-analysis">PCAWG and TCGA Pan-Cancer copy number alteration profile and analysis</a>
            <ul>
            <li><a href="#summary">Summary</a></li>
            <li><a href="#summary-data-analysis">Summary data analysis</a></li>
            <li><a href="#cancer-type">Cancer type</a></li>
            <li><a href="#variation-enrichment-in-cancer-types">Variation enrichment in cancer types</a></li>
            </ul></li>
            </ul></li>
            <li><a href="#r-session">R Session:</a></li>
            <li><a href="#references">References</a></li>
            </ul>
          </div>
          <div data-position="sidebar:post-end" class="InjectedComponents"><div class="dark-theme-toggler"><div class="toggle"><div class="toggle-track"><div class="toggle-track-check"><img  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAABlJJREFUWAm1V3tsFEUcntnXvXu0tBWo1ZZHihBjCEWqkHiNaMLDRKOtQSKaiCFKQtS/SbxiFCHGCIkmkBSMwZhQNTFoQZD0DFiwtCDFAkdDqBBBKFj63rvdnfH7zfVo5aFBj0l2Z/dm5vd98/0es8dYjlpr62azufnDQNZcU1PciMfjWvb9rvZSMk4Ayfb36pLH13189GC8LAtIRLLPt+pzwrCuLq4ISEv/gHmitrAwfPbEkXc/ad4dL6iujrvyX0jcitgd/yZlZqftP6995Mr5TVLa22Tn8XVX2g/XLSRjUu7Q79jonS7I7hS7/0oOb5VyqF52n98oj7esXX07EjlxwXWisRmSnm3b29TTM8iYrjmFBWExubxwY/uhNas4r/WySl1fc5cetDMd7ydl+lMJJRw5WC8ud62Xx5rfepzwxgZmbhUYNS5Stvsj4yo2GXJEFBVHWDBkfdbR9HpYBaaUajDnBLKKpl1xRKYcgGtMCqEzTaSnThk/SQT0uJqTqFNBmXMCsZE48DzRZRMBRjv1GHNdk3HBImF9ZUvTyxM40pMKVc4JZBXQOLOFoDeKSxdp6HIQcO4rjYT9fn0pjbz9GLt7BAAODmjSVReXUMFzNW5x5vfxp2mIxZjIuQKJxAmFa+is2DQJJQ0JyBVExNOYcJnPxx/6/utnijmP555ALEagKAGGnGn64QORBjARcIA/yJk7JMJBLRrNtybTvH88KGjCf2jK86bhzmMcwDKFZEQvbIhxFYhChoMWMzU2iWznlIBEVJOsP+1bdX/ALx9l7jApADeDAEcMkE90JnUmmGl4USKQ0xhoW3JB5XY0YrxYWhLwMZZypUyjDGH35AbNwgUGiFBPpuGbHCpAOV1ZGXf2f/taftAv31DyeymN2d1IhAFAwTOmnzF/kKcdh3me7CYCOVNgycju84u8DeVlwfFq9/ZlTfldYrMUjOlrkjkD+rU+WzCROkcEchIDHR011syZW9JHD7y07N6JvhWMpz3pugaTkB6lWFVCKkhck0zzeMp2utq+uHrmfxOgoCO/Z8CXPlEQ1bdH8wgvhSIkEG0ICcQeExIFGdimjvKka7btJFZuaXOammIGKUCFQ53j9EN1dYKWqHf0t2w407W2tgs6h89ZnImjB55flh81tt9XirjjDuSl+oIPRQ0iWPgNZ5GqTqbBe3vSzEl5n5PhWKwocyR2HlqYN61qV18WjYjE8JLARZPQsUSim8foIRYTlGr02Ly7piASFRtKJ4VfieYhxdS2JcDVMN6xVOKZyrCGm8b108lrLRVzvptLH7IoEFLFANes6KnDi+uxfmvFnF17oALq5u1agu3/YfHkcSFzeSggV5eXRfIB7CHNcO5SUI+Ih5Ir7f4MAV9IqdFzdZgNpZw1Gcs1mNvgGbTbqQ9/cz7ZuuhgyYRQ49ljTyWHhr2DwpNHHFf+5gnWZ3Bharo+0TD5dNMw5vv9RlVpSRDHK4TlnoukhtYApuOHejSZQuo5g/A9BysdKRCyLl6062fN37OXMDlvUJtUrtmxo0avrW3wTrYs3jJ9RvRVChrmSmanPMpX2OXMsmDGh6AiEIwBAlvkOqIdBy+8JyAz8pz7QxiDth4KDy5uAlwzrWTnwC8Vc4KVAMZ3YUZ+IqoIjP3h5KFFX1ZMy3uW+7RhEDHgTi0zC9rS7uhPCDiNrGFyqBeERtKN/B0YlyFCkw0NJ5C0Ojv7zvT1a1WV1TuvZDdL4NTgB7CASYpsen6gqvG5jmTf5qHedADgkBl3D0nkSgNhZACDyi0FUKZRr3IdRjgN4WPPoFMIIegIK3mqd38fS80mcJKelM4szNyzZtQbkchGePuBRS8Eg9pHU8ojRQpSqs+ajAIwTjjUMQ/nvTNM0kicwYxZIYMh/891DYi+fvedB+c1xsm4lDU6ya+Axtz+RiAzEVYbajQOpq17F0R9QevNcEhfcU+xvyQQUalGJBSesqOkgPQ4YNyUZL9fSvUPDjoNAwN8/dwFjaczNkc3ptaMud1EIDtGcmXTcefO2cGSvKIFfp/2JIJxlq7xEl3nVPM4fDeIbPkD16/ptNc0bDu7qxbsu0R2JGywWMIjF2ft3tjfloAyQAGXiOn8hrqwbVvMXzaO+QeHXP6nF0wvX74Hf4NGG5GPjSlYoyM3P/0FbCT6zvM/yYoAAAAASUVORK5CYII=" role="presentation" style="pointer-events: none;" width="16" height="16"></div> <div class="toggle-track-x"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAABwNJREFUWAmtV1tsFFUY/s6Z2d22zLYlZakUCRVaQcqlWIiCiS1gTEB9UAO+GR9En3iQGI0xJiSiRB98MjEq8cEQTSBeHhQM0V7whtEGDWC90BYitxahtNtu25058/v/ZzvLbilawJNM5+yZ89+//1LgJhYRNLW1uDfBAvpGiIk2O5auvfFxqIH3ZJ8/u06GN6Z9+wVl5SjcD1IbZa/UPkPyYl2uR4dreoD2bnbYxTlBBRytkHXtAREphP5KuH4lddx9h70yxX05t7yYXwGb6W8nx1jibpl2rFlGBxcG9M18okOrn7Bnk/BAO/4bI0UeEE1zjBp3UmvjOxJXJdaKN/ZiIu4tOZrAb4aTdZAZArKmWeiiJZ6jt5tiagdCS9+6cgO1Ne6Mvhe+ixTIfyDVhipnK9p+P0Edqx9RW/YZtQVGmOLChRxNNlyPsTEgPQKMB3dbEHa0h1awYmQ83enTd2vmUtvKd1Glv2RkzBb+kZGRrKtjzG60Wguhd/lJZBingbcfWWe72vjT75bJDrhYtvA0hrurETDr5HyF2Knb1MM4ab//xIoOqueA0edRnkkinTyJdYvqLFDZO4zUPFCvVoDjJq4T7TE61IWh4x5KqxX5KVKkX8WZ/t2ov2cb3MHt4dhIyOxIJxJOOF6xRx/99BksXLoecWcXytILMNBDqKpnGZWPquYfPxY8iXGR9fK+SgFrgcRPXPjVqhehL+3EmZ5RGJQi1QBU8TPThQnOQzm+5UXGIcetUeEAfP13VwzpI+w1jGJWdSliNfvVhiMPiOsllJag4M/UGHiqM6dlBb2OTLKHHV6KkvogrJ4XhBWniWK/Gp1MQyf93FOeUXKmKk/FzJxbQtKLjFXYT4USupy8fQVir2ynVEBiZMG0qtOHMS/AW4Gwrk7BG3C1F0B5nqNKE0CME4MfVRLPnXkBKe+ipvoFhNQywOhdghvLi0F8ReyVXV4BKTBRbbe5f64zR/DHsdZw1hJfeWlHl/GNRJzDxrd5m192z78TMaVnKELZoINZS4BzQ7vtnZljSnha/pPCbkuxzXcupYwI5tIeCpGc0Yp9tWHZQy/rmYhRfNgg4bHJBYLzGkxsRJF4XKlE2jBOHNSv3kY7Tj6vthzPFl61BrYwqFlmEQhtSVXmLiksxLmtRgYXI1ULU61JJ4eVKmG3/5sCVgpbMT6OMJ2E08/29Xf3w6v4FnHdCjfWgXu/O8Z5mLdCkeRs2khHe1DqOtQwbHWTAnM5S2HNmhALYo5KjkPFrMMKjZl6HxhWIAb0BqE+/73GrBRQUsKYiBu4JX8ycI6wtw+i5ef3NZpsrKVSHYCP37jwGDgeE1SA0S/xtl5SU2fs1ApEp0qTLVRjgyycDSsLHMSwmFltZMStR3uLLg6BdLhDa5dC6ryU2pHBe1BVO9tUcwfitJt2CLJZUHoG6T7Op75u0IyK31TCPcwFqgPk/KCaD3dFOuZBCO7xvCT/j048b3I3c7F2+WuOW7qdgkucFYlcQ4qop3yzTX7WaKfOCccye3Ts1Etq0+a/BHCF1yPgF3tAUkR6OrtGmo6gl94qqcXKh3rDyrOkPa58URoWcov2Mo6M+0QjrqKB+b7++oMa9Sz+ZkM0mie6aAtnGUvhmxaI+TogPOSQedgWioGSHFLn3v4kLh4HRspNmOGv41k+55siLFp2z6xYeJjhljFcbmxJlr4ga06TbevSByz/glQq4BJx46/c+237PbBqEYKxX3HpmKZEnQnr65X20hqJYaNcLoFOLiJk2LuBbyg7Q0OEn+hm0P3honxFD6rdxYorKpeIoi4YSSvyQHQIbM5t4+YNxLj/OxhVOOE4585qGpjnq+wSx6Q9CtNxTjd5klB+g6Mv36r0+b9cZFi44WYkHdG2ZWb3TtOUOXyVAlKlpGvJIAJ3eBMyfYS5C0qRZGtC85j+4sOasDe9xznPYezhhO/2Q6eP2fSOvYHOjtuQ1a9Q1VKynVDaMc8E0tptdxUsTFpFIYjcZKcbnoaQTNdiqCwNlL4G7oziSqGnT1ALf34vhk4R5zU3qYV9ONp9K88RtouShE68JwaU8dFw5W617shWa9ykeaBIn2hcsvPgL00k45QdTCZuSVcTRNs+8fnyLvooQfR5iujAnR9bxfY2xOVOxFS8SK3Le0l48VyYu1M8HRe5JD8wKPTjYnifaK3Wfn/GChYQ8ZAi6WRzWgqLV5YrsVLnZaVSoXU1g9gOIDwFySiGi+Zdrnzr7J3r+SMuszlcQCRn8lNGcTuSy2jOI7o9mxjZo+vR3ej3tN+ifRSOyUTS0+VMOid93cCubeiy/6TImS0QxRSCq2vxKr45zV+FQnjWH6D2xg+E9EatLcLAdHTgtGGD80D6jM0+aOl4wJgO/f96R2aJKCQ3yvgftRhdFMOpd6oAAAAASUVORK5CYII=" role="presentation" style="pointer-events: none;" width="16" height="16"></div></div> <div class="toggle-thumb"></div></div> <input type="checkbox" aria-label="Switch between Dark and Default theme" class="toggler-screen-reader-only"></div></div>
        </div>
        <div class="Main">
          <div class="Content" id="content"> 
   
   
        
      <h1 class="title">Pan-Cancer Copy Number Signature Identification and Analysis</h1>
      
      <p class="authors">
           <span class="glyphicon glyphicon-user"></span> Shixiang Wang, Ziyu Tao, Tao Wu, Huimin Li, Xue-Song Liu (Corresponding author)
      </p>
         <p class="date"><span class="glyphicon glyphicon-calendar"></span> 2021-01-22</p>
           

   
      
   
<!-- Don't indent these lines or it will mess pre blocks indentation --> 
<div class="page-content has-page-title">
<p><br></p>
<p>This document is compiled from an RMarkdown file which contains all code or description necessary to reproduce the analysis for the accompanying project. Each section below describes a different component of the analysis and most of numbers and figures are generated directly from the underlying data on compilation.</p>
<div id="license" class="section level1">
<h1>LICENSE</h1>
<p><strong>If you want to reuse the code in this report, please note the license below should be followed</strong>.</p>
<p>The code is made available for non commercial research purposes only under the MIT. However, notwithstanding any provision of the MIT License, the software currently may not be used for commercial purposes without explicit written permission after contacting Shixiang Wang <a href="mailto:wangshx@shanghaitech.edu.cn" class="email">wangshx@shanghaitech.edu.cn</a> or Xue-Song Liu <a href="mailto:liuxs@shanghaitech.edu.cn" class="email">liuxs@shanghaitech.edu.cn</a>.</p>
</div>
<div id="part-0-data-preprocessing" class="section level1">
<h1>PART 0: Data preprocessing</h1>
<p>In this part, raw data are collected from databases or papers and the core pre-processing steps are described in sections below.</p>
<p><em>The pre-processing work has been done by setting root path of the project repository as work directory. Therefore, keep in mind the work directory should be properly set if you are interested in reproducing the pre-processing procedure.</em></p>
<div id="prepare-pcawg-datasets" class="section level2">
<h2>Prepare PCAWG datasets</h2>
<p>We download PCAWG phenotype and copy number data from <a href="https://xenabrowser.net/datapages/">UCSC Xena</a> and save them to local machine with R format.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;Xena&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Phenotype (Specimen Centric) -----------------------------------------------</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(UCSCXenaTools)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>pcawg_phenotype <span class="ot">&lt;-</span> XenaData <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(XenaHostNames <span class="sc">==</span> <span class="st">&quot;pcawgHub&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">XenaScan</span>(<span class="st">&quot;phenotype&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">XenaScan</span>(<span class="st">&quot;specimen centric&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">XenaGenerate</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">XenaQuery</span>()</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>pcawg_phenotype <span class="ot">&lt;-</span> pcawg_phenotype <span class="sc">%&gt;%</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">XenaDownload</span>(<span class="at">destdir =</span> <span class="st">&quot;Xena&quot;</span>, <span class="at">trans_slash =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>phenotype_list <span class="ot">&lt;-</span> <span class="fu">XenaPrepare</span>(pcawg_phenotype)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>pcawg_samp_info_sp <span class="ot">&lt;-</span> phenotype_list[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(pcawg_samp_info_sp, <span class="at">file =</span> <span class="st">&quot;data/pcawg_samp_info_sp.rds&quot;</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># PCAWG (Specimen Centric) ------------------------------------------------</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://pcawg.xenahubs.net/download/20170119_final_consensus_copynumber_sp.gz&quot;</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Xena/pcawg_copynumber_sp.gz&quot;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>pcawg_cn <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;Xena/pcawg_copynumber_sp.gz&quot;</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>pcawg_samp_info_sp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/pcawg_samp_info_sp.rds&quot;</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>sex_dt <span class="ot">&lt;-</span> pcawg_samp_info_sp<span class="sc">$</span>pcawg_donor_clinical_August2016_v9_sp <span class="sc">%&gt;%</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(xena_sample, donor_sex) <span class="sc">%&gt;%</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;sex&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  data.table<span class="sc">::</span><span class="fu">as.data.table</span>()</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sex_dt, <span class="at">file =</span> <span class="st">&quot;data/pcawg_sex_sp.rds&quot;</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>pcawg_cn <span class="ot">&lt;-</span> pcawg_cn[<span class="sc">!</span><span class="fu">is.na</span>(total_cn)]</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>pcawg_cn<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>pcawg_cn <span class="ot">&lt;-</span> pcawg_cn[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">7</span>)]</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pcawg_cn)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;Chromosome&quot;</span>, <span class="st">&quot;Start.bp&quot;</span>, <span class="st">&quot;End.bp&quot;</span>, <span class="st">&quot;modal_cn&quot;</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(pcawg_cn, <span class="at">file =</span> <span class="st">&quot;data/pcawg_copynumber_sp.rds&quot;</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co"># LOH ---------------------------------------------------------------------</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>pcawg_cn <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/pcawg_copynumber_sp.rds&quot;</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>pcawg_loh <span class="ot">&lt;-</span> pcawg_cn <span class="sc">%&gt;%</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Chromosome <span class="sc">%in%</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">len =</span> End.bp <span class="sc">-</span> Start.bp <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(sample) <span class="sc">%&gt;%</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_LOH =</span> <span class="fu">sum</span>(minor_cn <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> modal_cn <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> len <span class="sc">&gt;=</span> <span class="fl">1e4</span>)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;n_LOH&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  data.table<span class="sc">::</span><span class="fu">as.data.table</span>()</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(pcawg_loh, <span class="at">file =</span> <span class="st">&quot;data/pcawg_loh.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="generate-pcawg-sample-by-component-matrix" class="section level2">
<h2>Generate PCAWG sample-by-component matrix</h2>
<p>We then read the copy number data and transform it into a <code>CopyNumber</code> object with R package sigminer. Then <code>sig_tally()</code> is used to generate the matrix for NMF decomposition.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Only focus autosomes, suggested by Prof. Liu</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>pcawg_cn <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/pcawg_copynumber_sp.rds&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pcawg_cn<span class="sc">$</span>Chromosome)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>pcawg_cn <span class="ot">&lt;-</span> pcawg_cn[<span class="sc">!</span>Chromosome <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>)]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>cn_obj <span class="ot">&lt;-</span> <span class="fu">read_copynumber</span>(pcawg_cn,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">add_loh =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">loh_min_len =</span> <span class="fl">1e4</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">loh_min_frac =</span> <span class="fl">0.05</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_copynumber =</span> 1000L,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">genome_build =</span> <span class="st">&quot;hg19&quot;</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">complement =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">genome_measure =</span> <span class="st">&quot;called&quot;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(cn_obj, <span class="at">file =</span> <span class="st">&quot;data/pcawg_cn_obj.rds&quot;</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Tally -------------------------------------------------------------------</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>cn_obj <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/pcawg_cn_obj.rds&quot;</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cn_obj<span class="sc">@</span>data<span class="sc">$</span>chromosome)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>tally_X <span class="ot">&lt;-</span> <span class="fu">sig_tally</span>(cn_obj,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;X&quot;</span>,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">add_loh =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">10</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(tally_X, <span class="at">file =</span> <span class="st">&quot;data/pcawg_cn_tally_X.rds&quot;</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tally_X<span class="sc">$</span>all_matrices, <span class="at">max.level =</span> <span class="dv">1</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_catalogue</span>(tally_X,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;copynumber&quot;</span>, <span class="at">method =</span> <span class="st">&quot;X&quot;</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;cosmic&quot;</span>, <span class="at">y_tr =</span> <span class="cf">function</span>(x) <span class="fu">log10</span>(x <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_lab =</span> <span class="st">&quot;log10(count +1)&quot;</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="st">&quot;output/pcawg_catalogs_tally_X.pdf&quot;</span>, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">16</span>, <span class="at">height =</span> <span class="fl">2.5</span>)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">sort</span>(<span class="fu">colSums</span>(tally_X<span class="sc">$</span>nmf_matrix)), <span class="at">n =</span> <span class="dv">50</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="do">## classes without LOH labels</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>tally_X_noLOH <span class="ot">&lt;-</span> <span class="fu">sig_tally</span>(cn_obj,</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;X&quot;</span>,</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">add_loh =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">10</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(tally_X_noLOH<span class="sc">$</span>all_matrices, <span class="at">file =</span> <span class="st">&quot;data/pcawg_cn_tally_X_noLOH.rds&quot;</span>)</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tally_X_noLOH<span class="sc">$</span>all_matrices, <span class="at">max.level =</span> <span class="dv">1</span>)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_catalogue</span>(tally_X_noLOH,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;copynumber&quot;</span>, <span class="at">method =</span> <span class="st">&quot;X&quot;</span>,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;cosmic&quot;</span>, <span class="at">y_tr =</span> <span class="cf">function</span>(x) <span class="fu">log10</span>(x <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_lab =</span> <span class="st">&quot;log10(count +1)&quot;</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="st">&quot;output/pcawg_catalogs_tally_X_noLOH.pdf&quot;</span>, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">16</span>, <span class="at">height =</span> <span class="fl">2.5</span>)</span></code></pre></div>
<p>The generated catalog profiles for LOH version and non-LOH version component classification can be viewed by the following link:</p>
<ul>
<li><a href="https://github.com/ShixiangWang/CNX/blob/master/output/pcawg_catalogs_tally_X.pdf">pcawg_catalogs_tally_X.pdf</a> - 176 components</li>
<li><a href="https://github.com/ShixiangWang/CNX/blob/master/output/pcawg_catalogs_tally_X_noLOH.pdf">pcawg_catalogs_tally_X_noLOH.pdf</a> - 136 components</li>
</ul>
</div>
<div id="prepare-tcga-datasets" class="section level2">
<h2>Prepare TCGA datasets</h2>
<p>TCGA allele-specific copy number data are downloaded from <a href="https://portal.gdc.cancer.gov/">GDC portal</a> and transformed into R format by Huimin Li.</p>
<p>The data is go further checked and cleaned by Shixiang.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Huimin collected TCGA data from GDC portal</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and generate file with format needed by sigminer</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Here I will firstly further clean up the data</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/TCGA/datamicopy.rds&quot;</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(x)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x)[<span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="st">&quot;minor_cn&quot;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(x)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>x[, sample <span class="sc">:</span><span class="er">=</span> <span class="fu">substr</span>(sample, <span class="dv">1</span>, <span class="dv">15</span>)]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(x, <span class="at">file =</span> <span class="st">&quot;data/TCGA/tcga_cn.rds&quot;</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
<p>TCGA phenotype data is downloaded from UCSC Xena.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;https://pancanatlas.xenahubs.net/download/Survival_SupplementalTable_S1_20171025_xena_sp.gz&quot;</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Xena/Survival_SupplementalTable_S1_20171025_xena_sp.gz&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>tcga_cli <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;Xena/Survival_SupplementalTable_S1_20171025_xena_sp.gz&quot;</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(tcga_cli<span class="sc">$</span><span class="st">`</span><span class="at">cancer type abbreviation</span><span class="st">`</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(tcga_cli, <span class="at">file =</span> <span class="st">&quot;data/TCGA/tcga_cli.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="generate-tcga-sample-by-component-matrix" class="section level2">
<h2>Generate TCGA sample-by-component matrix</h2>
<p>Similar to PCAWG, TCGA matrices are also generated.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Only focus autosomes</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>tcga_cn <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/TCGA/tcga_cn.rds&quot;</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(tcga_cn<span class="sc">$</span>chromosome)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>tcga_cn <span class="ot">&lt;-</span> tcga_cn[<span class="sc">!</span>chromosome <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;chrX&quot;</span>, <span class="st">&quot;chrY&quot;</span>)]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>cn_obj <span class="ot">&lt;-</span> <span class="fu">read_copynumber</span>(</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  tcga_cn,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seg_cols =</span> <span class="fu">c</span>(<span class="st">&quot;chromosome&quot;</span>, <span class="st">&quot;start&quot;</span>, <span class="st">&quot;end&quot;</span>, <span class="st">&quot;segVal&quot;</span>),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">add_loh =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">loh_min_len =</span> <span class="fl">1e4</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">loh_min_frac =</span> <span class="fl">0.05</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_copynumber =</span> 1000L,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">genome_build =</span> <span class="st">&quot;hg38&quot;</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">complement =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">genome_measure =</span> <span class="st">&quot;called&quot;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(cn_obj, <span class="at">file =</span> <span class="st">&quot;data/TCGA/tcga_cn_obj.rds&quot;</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Tally step</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the counting matrices</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Same as what have done for PCAWG dataset</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>cn_obj <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/tcga_cn_obj.rds&quot;</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cn_obj<span class="sc">@</span>data<span class="sc">$</span>chromosome)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>tally_X <span class="ot">&lt;-</span> <span class="fu">sig_tally</span>(cn_obj,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;X&quot;</span>,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">add_loh =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">10</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(tally_X, <span class="at">file =</span> <span class="st">&quot;data/TCGA/tcga_cn_tally_X.rds&quot;</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_catalogue</span>(tally_X,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;copynumber&quot;</span>, <span class="at">method =</span> <span class="st">&quot;X&quot;</span>,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;cosmic&quot;</span>, <span class="at">y_tr =</span> <span class="cf">function</span>(x) <span class="fu">log10</span>(x <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_lab =</span> <span class="st">&quot;log10(count +1)&quot;</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="st">&quot;output/tcga_catalogs_tally_X.pdf&quot;</span>, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">16</span>, <span class="at">height =</span> <span class="fl">2.5</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">sort</span>(<span class="fu">colSums</span>(tally_X<span class="sc">$</span>nmf_matrix)), <span class="at">n =</span> <span class="dv">50</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="do">## classes without LOH labels</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>tally_X_noLOH <span class="ot">&lt;-</span> <span class="fu">sig_tally</span>(cn_obj,</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;X&quot;</span>,</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">add_loh =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">10</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(tally_X_noLOH<span class="sc">$</span>all_matrices, <span class="at">file =</span> <span class="st">&quot;data/TCGA/tcga_cn_tally_X_noLOH.rds&quot;</span>)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tally_X_noLOH<span class="sc">$</span>all_matrices, <span class="at">max.level =</span> <span class="dv">1</span>)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_catalogue</span>(tally_X_noLOH,</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;copynumber&quot;</span>, <span class="at">method =</span> <span class="st">&quot;X&quot;</span>,</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;cosmic&quot;</span>, <span class="at">y_tr =</span> <span class="cf">function</span>(x) <span class="fu">log10</span>(x <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_lab =</span> <span class="st">&quot;log10(count +1)&quot;</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="st">&quot;output/tcga_catalogs_tally_X_noLOH.pdf&quot;</span>, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">16</span>, <span class="at">height =</span> <span class="fl">2.5</span>)</span></code></pre></div>
<p>The generated catalog profiles for LOH version and non-LOH version component classification can be viewed by the following link:</p>
<ul>
<li><a href="https://github.com/ShixiangWang/CNX/blob/master/output/tcga_catalogs_tally_X.pdf">tcga_catalogs_tally_X.pdf</a> - 176 components</li>
<li><a href="https://github.com/ShixiangWang/CNX/blob/master/output/tcga_catalogs_tally_X_noLOH.pdf">tcga_catalogs_tally_X_noLOH.pdf</a> - 136 components</li>
</ul>
</div>
<div id="pcawg-genotypephenotype-data-type-and-source" class="section level2">
<h2>PCAWG genotype/phenotype data type and source</h2>
<p>If no references described, PCAWG genotype/phenotype data used in this study are obtained from UCSC Xena database, the original data source is <a href="https://www.nature.com/collections/afdejfafdb">PCAWG paper collection</a> published in early 2020.</p>
<ul>
<li>Consensus copy number (<a href="https://xenabrowser.net/datapages/?dataset=20170119_final_consensus_copynumber_sp&amp;host=https%3A%2F%2Fpcawg.xenahubs.net&amp;removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443">page in UCSC Xena</a>).</li>
<li>General phenotype information (<a href="https://xenabrowser.net/datapages/?cohort=PCAWG%20(specimen%20centric)&amp;removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443">page in UCSC Xena</a>).</li>
<li>Tumor purity &amp; ploidy &amp; WGD status (<a href="https://xenabrowser.net/datapages/?dataset=consensus.20170217.purity.ploidy_sp&amp;host=https%3A%2F%2Fpcawg.xenahubs.net&amp;removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443">page in UCSC Xena</a>).</li>
<li>Gene level fusion events (<a href="https://xenabrowser.net/datapages/?dataset=pcawg3_fusions_PKU_EBI.gene_centric.sp.xena&amp;host=https%3A%2F%2Fpcawg.xenahubs.net&amp;removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443">page in UCSC Xena</a>).</li>
<li>LOH number, calculated from copy number data, defined as number of copy number segments passing the following criterion:
<ul>
<li>Minor copy number equals to <code>0</code>.</li>
<li>Total copy number is greater than <code>0</code>.</li>
<li>Segment length is greater than <code>10Kb</code>.</li>
</ul></li>
<li>HRD status by CHORD framework, the raw data is available at <span class="citation"><a href="#ref-nguyenPancancerLandscapeHomologous2020" role="doc-biblioref">Nguyen et al.</a> (<a href="#ref-nguyenPancancerLandscapeHomologous2020" role="doc-biblioref">2020</a>)</span>, cleaned by Huimin Li.</li>
<li>Chromothripsis detected by ShatterSeek, the data is obtained from <a href="http://compbio.med.harvard.edu/chromothripsis/" class="uri">http://compbio.med.harvard.edu/chromothripsis/</a>.</li>
<li>Amplicons (including ecDNA) detected by AmpliconArchitect, obtained from <span class="citation"><a href="#ref-kimExtrachromosomalDNAAssociated2020" role="doc-biblioref">Kim et al.</a> (<a href="#ref-kimExtrachromosomalDNAAssociated2020" role="doc-biblioref">2020</a>)</span>.</li>
<li>Telomere content detected by TelomereHunter, obtained from <span class="citation"><a href="#ref-pcawg-structuralvariationworkinggroupGenomicFootprintsActivated2020" role="doc-biblioref">PCAWG-Structural Variation Working Group et al.</a> (<a href="#ref-pcawg-structuralvariationworkinggroupGenomicFootprintsActivated2020" role="doc-biblioref">2020</a>)</span>.</li>
<li>APOBEC mutations (<a href="https://xenabrowser.net/datapages/?dataset=MAF_Aug31_2016_sorted_A3A_A3B_comparePlus.sp&amp;host=https%3A%2F%2Fpcawg.xenahubs.net&amp;removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443">page in UCSC Xena</a>).</li>
</ul>
</div>
</div>
<div id="part-1-copy-number-signature-identification-and-activity-attribution" class="section level1">
<h1>PART 1: Copy number signature identification and activity attribution</h1>
<p>In this part, how the copy number signatures are identified and how the corresponding signature activities (a.k.a. exposures) are attributed are described in sections below. <strong>The 176 component classification for PCAWG data is our main focus.</strong></p>
<p><em>The work of this part has been done by either setting root path of the project repository as work directory or moving data and code to the same path (see below). Therefore, keep in mind the work directory/data path should be properly set if you are interested in reproducing the analysis procedure.</em></p>
<p><em>The signature identification work cannot be done in local machine because high intensity calculations are required, we used HPC of ShanghaiTech University to submit computation jobs to HPC clusters. Input data files, R scripts and PBS job scripts are stored in a same path, the structure can be viewed as:</em></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>├── <span class="ex">call_pcawg_sp.R</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>├── <span class="ex">pcawg_cn_tally_X.rds</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>├── <span class="ex">pcawg.pbs</span></span></code></pre></div>
<div id="copy-number-signature-identification" class="section level2">
<h2>Copy number signature identification</h2>
<p>We use the gold-standard tool <a href="https://github.com/AlexandrovLab/SigProfilerExtractor">SigProfiler v1.0.17</a> to identify Pan-Cancer copy number signatures and their activities in each sample. The SigProfiler has been successfully applied to many studies, especially in <span class="citation"><a href="#ref-pcawgmutationalsignaturesworkinggroupRepertoireMutationalSignatures2020" role="doc-biblioref">PCAWG Mutational Signatures Working Group et al.</a> (<a href="#ref-pcawgmutationalsignaturesworkinggroupRepertoireMutationalSignatures2020" role="doc-biblioref">2020</a>)</span> for multiple types of signatures.</p>
<div id="apply-to-pcawg-catalog-matrix" class="section level3">
<h3>Apply to PCAWG catalog matrix</h3>
<p>PBS file <code>pcawg.pbs</code> content:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -l walltime=1000:00:00</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -l nodes=1:ppn=36</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -S /bin/bash</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -l mem=20gb</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -j oe</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -M w_shixiang@163.com</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#PBS -q pub_fast</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Please set PBS arguments above</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /public/home/wangshx/wangshx/PCAWG-TCGA</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load apps/R/3.6.1</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Following are commands/scripts you want to run</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># If you do not know how to set this, please check README.md file </span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> call_pcawg_sp.R</span></code></pre></div>
<p>We developed a SigProfiler caller in our R package [sigminer] and run SigProfiler with default settings for most of parameters.</p>
<p>R script <code>call_pcawg_sp.R</code> content:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>tally_X <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;pcawg_cn_tally_X.rds&quot;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sigprofiler_extract</span>(tally_X<span class="sc">$</span>nmf_matrix,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">&quot;PCAWG_CN176X&quot;</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">range =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">30</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrun =</span> <span class="dv">100</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">init_method =</span> <span class="st">&quot;random&quot;</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_exome =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">use_conda =</span> <span class="cn">TRUE</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>All metadata info and detail settings reported by SigProfiler are copied below:</p>
<pre><code>THIS FILE CONTAINS THE METADATA ABOUT SYSTEM AND RUNTIME


-------System Info-------
Operating System Name: Linux
Nodename: node34
Release: 3.10.0-693.el7.x86_64
Version: #1 SMP Tue Aug 22 21:09:27 UTC 2017

-------Python and Package Versions------- 
Python Version: 3.8.5
Sigproextractor Version: 1.0.17
SigprofilerPlotting Version: 1.1.8
SigprofilerMatrixGenerator Version: 1.1.20
Pandas version: 1.1.2
Numpy version: 1.19.2
Scipy version: 1.5.2
Scikit-learn version: 0.23.2

--------------EXECUTION PARAMETERS--------------
INPUT DATA
    input_type: matrix
    output: TCGA_CN176X
    input_data: /tmp/RtmphYcBmk/dir852158ab0364/sigprofiler_input.txt
    reference_genome: GRCh37
    context_types: SBS176
    exome: False
NMF REPLICATES
    minimum_signatures: 2
    maximum_signatures: 30
    NMF_replicates: 100
NMF ENGINE
    NMF_init: random
    precision: single
    matrix_normalization: gmm
    resample: True
    seeds: random
    min_NMF_iterations: 10,000
    max_NMF_iterations: 1,000,000
    NMF_test_conv: 10,000
    NMF_tolerance: 1e-15
CLUSTERING
    clustering_distance: cosine
EXECUTION
    cpu: 36; Maximum number of CPU is 36
    gpu: False
Solution Estimation
    stability: 0.8
    min_stability: 0.2
    combined_stability: 1.0
COSMIC MATCH
    opportunity_genome: GRCh37
    nnls_add_penalty: 0.05
    nnls_remove_penalty: 0.01
    initial_remove_penalty: 0.05
    de_novo_fit_penalty: 0.02
    refit_denovo_signatures: False

-------Analysis Progress------- 
[2020-11-29 17:39:12] Analysis started: 

##################################

[2020-11-29 17:39:18] Analysis started for SBS176. Matrix size [176 rows x 10851 columns]

[2020-11-29 17:39:18] Normalization GMM with cutoff value set at 17600

[2020-11-29 19:12:03] SBS176 de novo extraction completed for a total of 2 signatures! 
Execution time:1:32:45

[2020-11-29 23:58:10] SBS176 de novo extraction completed for a total of 3 signatures! 
Execution time:4:46:06

[2020-11-30 08:32:21] SBS176 de novo extraction completed for a total of 4 signatures! 
Execution time:8:34:11

[2020-11-30 19:51:18] SBS176 de novo extraction completed for a total of 5 signatures! 
Execution time:11:18:56

[2020-12-01 07:10:18] SBS176 de novo extraction completed for a total of 6 signatures! 
Execution time:11:18:59

[2020-12-01 21:14:24] SBS176 de novo extraction completed for a total of 7 signatures! 
Execution time:14:04:06

[2020-12-02 15:48:43] SBS176 de novo extraction completed for a total of 8 signatures! 
Execution time:18:34:19

[2020-12-03 12:53:25] SBS176 de novo extraction completed for a total of 9 signatures! 
Execution time:21:04:41

[2020-12-04 11:25:25] SBS176 de novo extraction completed for a total of 10 signatures! 
Execution time:22:31:59

[2020-12-05 10:20:15] SBS176 de novo extraction completed for a total of 11 signatures! 
Execution time:22:54:50

[2020-12-06 11:36:03] SBS176 de novo extraction completed for a total of 12 signatures! 
Execution time:1 day, 1:15:48

[2020-12-07 14:43:31] SBS176 de novo extraction completed for a total of 13 signatures! 
Execution time:1 day, 3:07:28

[2020-12-09 01:15:22] SBS176 de novo extraction completed for a total of 14 signatures! 
Execution time:1 day, 10:31:50

[2020-12-10 08:02:39] SBS176 de novo extraction completed for a total of 15 signatures! 
Execution time:1 day, 6:47:17

[2020-12-11 16:05:31] SBS176 de novo extraction completed for a total of 16 signatures! 
Execution time:1 day, 8:02:51

[2020-12-13 02:19:40] SBS176 de novo extraction completed for a total of 17 signatures! 
Execution time:1 day, 10:14:09

[2020-12-14 14:56:13] SBS176 de novo extraction completed for a total of 18 signatures! 
Execution time:1 day, 12:36:32

[2020-12-16 02:39:41] SBS176 de novo extraction completed for a total of 19 signatures! 
Execution time:1 day, 11:43:27

[2020-12-18 02:54:09] SBS176 de novo extraction completed for a total of 20 signatures! 
Execution time:2 days, 0:14:28

[2020-12-19 20:20:57] SBS176 de novo extraction completed for a total of 21 signatures! 
Execution time:1 day, 17:26:47

[2020-12-21 19:30:07] SBS176 de novo extraction completed for a total of 22 signatures! 
Execution time:1 day, 23:09:10

[2020-12-24 00:44:41] SBS176 de novo extraction completed for a total of 23 signatures! 
Execution time:2 days, 5:14:34

[2020-12-25 19:03:07] SBS176 de novo extraction completed for a total of 24 signatures! 
Execution time:1 day, 18:18:25

[2020-12-27 07:50:06] SBS176 de novo extraction completed for a total of 25 signatures! 
Execution time:1 day, 12:46:58

[2020-12-29 04:40:22] SBS176 de novo extraction completed for a total of 26 signatures! 
Execution time:1 day, 20:50:16

[2020-12-30 12:35:04] SBS176 de novo extraction completed for a total of 27 signatures! 
Execution time:1 day, 7:54:41

[2020-12-31 19:04:04] SBS176 de novo extraction completed for a total of 28 signatures! 
Execution time:1 day, 6:29:00

[2021-01-02 04:50:07] SBS176 de novo extraction completed for a total of 29 signatures! 
Execution time:1 day, 9:46:02

[2021-01-03 14:15:32] SBS176 de novo extraction completed for a total of 30 signatures! 
Execution time:1 day, 9:25:25

[2021-01-03 14:48:21] Analysis ended: 

-------Job Status------- 
Analysis of mutational signatures completed successfully! 
Total execution time: 34 days, 21:09:09 
Results can be found in:  TCGA_CN176X  folder</code></pre>
</div>
<div id="signature-number-determination" class="section level3">
<h3>Signature number determination</h3>
<p>First, load the results.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>SP_PCAWG <span class="ot">&lt;-</span> <span class="fu">sigprofiler_import</span>(<span class="st">&quot;../SP/PCAWG_CN176X/&quot;</span>, <span class="at">order_by_expo =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;all&quot;</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(SP_PCAWG, <span class="at">file =</span> <span class="st">&quot;../data/pcawg_cn_solutions_sp.rds&quot;</span>)</span></code></pre></div>
<p>Then we visualize the signature number survey.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>SP_PCAWG <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_solutions_sp.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_sig_number_survey</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  SP_PCAWG<span class="sc">$</span>all_stats <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">s =</span> <span class="st">`</span><span class="at">Stability (Avg Silhouette)</span><span class="st">`</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">e =</span> <span class="st">`</span><span class="at">Mean Cosine Distance</span><span class="st">`</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">SignatureNumber =</span> <span class="fu">as.integer</span>(<span class="fu">gsub</span>(<span class="st">&quot;[^0-9]&quot;</span>, <span class="st">&quot;&quot;</span>, SignatureNumber))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;SignatureNumber&quot;</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">left_y =</span> <span class="st">&quot;s&quot;</span>, <span class="at">right_y =</span> <span class="st">&quot;e&quot;</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">left_name =</span> <span class="st">&quot;Stability (Avg Silhouette)&quot;</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">right_name =</span> <span class="st">&quot;Mean Cosine Distance&quot;</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">highlight =</span> <span class="dv">14</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" width="2700" style="display: block; margin: auto;" /></p>
<p>We pick up <code>14</code> signatures for PCAWG data due to its relatively high stability and low distance.</p>
<p>The <code>Signature</code> object with 14 signature profiles are stored for further analysis.</p>
<p>To better describe the signatures, we will rename them. The names are ordered by mean activity in samples.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pcawg_sigs <span class="ot">&lt;-</span> SP_PCAWG<span class="sc">$</span>solution_list<span class="sc">$</span>S14</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(pcawg_sigs<span class="sc">$</span>Exposure, <span class="dv">1</span>, mean)</span></code></pre></div>
<pre><code>     Sig1      Sig2      Sig3      Sig4      Sig5      Sig6      Sig7      Sig8 
15.830094 13.944564 12.504680 11.570554 10.709143 10.506479 10.429086  9.727142 
     Sig9     Sig10     Sig11     Sig12     Sig13     Sig14 
 9.621310  9.116271  7.989201  7.122750  6.835853  6.232541 </code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sig_names</span>(pcawg_sigs)</span></code></pre></div>
<pre><code> [1] &quot;Sig1&quot;  &quot;Sig2&quot;  &quot;Sig3&quot;  &quot;Sig4&quot;  &quot;Sig5&quot;  &quot;Sig6&quot;  &quot;Sig7&quot;  &quot;Sig8&quot;  &quot;Sig9&quot; 
[10] &quot;Sig10&quot; &quot;Sig11&quot; &quot;Sig12&quot; &quot;Sig13&quot; &quot;Sig14&quot;</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pcawg_sigs<span class="sc">$</span>Signature) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(pcawg_sigs<span class="sc">$</span>Signature.norm) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(pcawg_sigs<span class="sc">$</span>Exposure) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(pcawg_sigs<span class="sc">$</span>Exposure.norm) <span class="ot">&lt;-</span> pcawg_sigs<span class="sc">$</span>Stats<span class="sc">$</span>signatures<span class="sc">$</span>Signatures <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sig_names</span>(pcawg_sigs)</span></code></pre></div>
<pre><code> [1] &quot;CNS1&quot;  &quot;CNS2&quot;  &quot;CNS3&quot;  &quot;CNS4&quot;  &quot;CNS5&quot;  &quot;CNS6&quot;  &quot;CNS7&quot;  &quot;CNS8&quot;  &quot;CNS9&quot; 
[10] &quot;CNS10&quot; &quot;CNS11&quot; &quot;CNS12&quot; &quot;CNS13&quot; &quot;CNS14&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(pcawg_sigs, <span class="at">file =</span> <span class="st">&quot;../data/pcawg_cn_sigs_CN176_signature.rds&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="sample-copy-number-catalog-reconstruction" class="section level2">
<h2>Sample copy number catalog reconstruction</h2>
<p>Here we try know how well each sample catalog profile can be constructed from the signature combination.</p>
<p>Firstly we get the activity data.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pcawg_sigs <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_sigs_CN176_signature.rds&quot;</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>pcawg_act <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">absolute =</span> <span class="fu">get_sig_exposure</span>(SP_PCAWG<span class="sc">$</span>solution_list<span class="sc">$</span>S14, <span class="at">type =</span> <span class="st">&quot;absolute&quot;</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">relative =</span> <span class="fu">get_sig_exposure</span>(SP_PCAWG<span class="sc">$</span>solution_list<span class="sc">$</span>S14, <span class="at">type =</span> <span class="st">&quot;relative&quot;</span>, <span class="at">rel_threshold =</span> <span class="dv">0</span>),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">similarity =</span> pcawg_sigs<span class="sc">$</span>Stats<span class="sc">$</span>samples[, .(Samples, <span class="st">`</span><span class="at">Cosine Similarity</span><span class="st">`</span>)]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pcawg_act<span class="sc">$</span>absolute)[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">colnames</span>(pcawg_act<span class="sc">$</span>relative)[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pcawg_act<span class="sc">$</span>similarity) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;similarity&quot;</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(pcawg_act, <span class="at">file =</span> <span class="st">&quot;../data/pcawg_cn_sigs_CN176_activity.rds&quot;</span>)</span></code></pre></div>
<p>Check the stat summary of reconstructed Cosine similarity.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pcawg_act<span class="sc">$</span>similarity<span class="sc">$</span>similarity)</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5130  0.8980  0.9490  0.9326  0.9850  1.0000 </code></pre>
<p>Visualize with plot</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(pcawg_act<span class="sc">$</span>similarity<span class="sc">$</span>similarity, <span class="at">breaks =</span> <span class="dv">100</span>, <span class="at">xlab =</span> <span class="st">&quot;Reconstructed similarity&quot;</span>, <span class="at">main =</span> <span class="cn">NA</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-23-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>Most of samples are well constructed. Next we will use a similarity threshold <code>0.75</code> to filter out some samples for removing their effects on the following analysis.</p>
</div>
</div>
<div id="part-2-signature-profile-visualization-and-analysis" class="section level1">
<h1>PART 2: Signature profile visualization and analysis</h1>
<p>In this part, we would like to visualize and analyze all tumor samples as a whole.</p>
<div id="signature-profile-visualization" class="section level2">
<h2>Signature profile visualization</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>pcawg_sigs <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">&quot;../data/pcawg_cn_sigs_CN176_signature.rds&quot;</span>)</span></code></pre></div>
<p>Show signature profile with relative contribution value for each component.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_sig_profile</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  pcawg_sigs,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;copynumber&quot;</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;X&quot;</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;cosmic&quot;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-26-1.png" width="4200" style="display: block; margin: auto;" /></p>
<p>Show signature profile with absolute contribution value (estimated segment count) for each component.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_sig_profile</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  pcawg_sigs,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">&quot;copynumber&quot;</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;X&quot;</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;cosmic&quot;</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">normalize =</span> <span class="st">&quot;raw&quot;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-27-1.png" width="4200" style="display: block; margin: auto;" /></p>
<p>Show signature activity profile.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_sig_exposure</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  pcawg_sigs,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;cosmic&quot;</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">rm_space =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> sigminer<span class="sc">:::</span>letter_colors</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-28-1.png" width="4200" style="display: block; margin: auto;" /></p>
</div>
<div id="signature-analysis" class="section level2">
<h2>Signature analysis</h2>
<div id="signature-similarity" class="section level3">
<h3>Signature similarity</h3>
<p>Here we explore the similarity between copy number signatures identified in PCAWG data. High cosine similarity will cause some issues in signature assignment and activity attribution <span class="citation">(<a href="#ref-mauraPracticalGuideMutational2019" role="doc-biblioref">Maura et al. 2019</a>)</span>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">get_sig_similarity</span>(pcawg_sigs, pcawg_sigs)</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(sim<span class="sc">$</span>similarity, <span class="at">cluster_cols =</span> F, <span class="at">cluster_rows =</span> F, <span class="at">display_numbers =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-30-1.png" width="1650" style="display: block; margin: auto;" /></p>
<p>Most of signature-pairs have similarity around <code>0.1</code>.</p>
</div>
<div id="signature-activity-distribution" class="section level3">
<h3>Signature activity distribution</h3>
<p>Transform data to long format.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df_abs <span class="ot">&lt;-</span> <span class="fu">get_sig_exposure</span>(pcawg_sigs) <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;CNS&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;sig&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;activity&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">activity =</span> <span class="fu">log10</span>(activity <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig =</span> <span class="fu">factor</span>(sig, <span class="at">levels =</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>))</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>df_rel <span class="ot">&lt;-</span> <span class="fu">get_sig_exposure</span>(pcawg_sigs, <span class="at">type =</span> <span class="st">&quot;relative&quot;</span>, <span class="at">rel_threshold =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;CNS&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;sig&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;activity&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig =</span> <span class="fu">factor</span>(sig, <span class="at">levels =</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>))</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Plot with function in <code>sigminer</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_group_distribution</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  df_abs,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvar =</span> <span class="st">&quot;sig&quot;</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvar =</span> <span class="st">&quot;activity&quot;</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_angle =</span> <span class="dv">90</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;log10(activity+1)&quot;</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-32-1.png" width="2400" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_group_distribution</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  df_rel,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvar =</span> <span class="st">&quot;sig&quot;</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvar =</span> <span class="st">&quot;activity&quot;</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_angle =</span> <span class="dv">90</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;relative activity&quot;</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-33-1.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="copy-number-profile-and-signature-activity" class="section level2">
<h2>Copy number profile and signature activity</h2>
<div id="copy-number-profile-for-representative-samples" class="section level3">
<h3>Copy number profile for representative samples</h3>
<p>Here we will draw copy number profile of 2 representative samples for each signature.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>get_sample_from_sig <span class="ot">&lt;-</span> <span class="cf">function</span>(dt, sig) {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">head</span>(dt[<span class="fu">order</span>(dt[[sig]], dt[[<span class="fu">paste0</span>(<span class="st">&quot;ABS_&quot;</span>, sig)]], <span class="at">decreasing =</span> <span class="cn">TRUE</span>)], 2L)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  res</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Read <code>CopyNumber</code> object for PCAWG data.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>pcawg_cn_obj <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_obj.rds&quot;</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>samp_summary <span class="ot">&lt;-</span> pcawg_cn_obj<span class="sc">@</span>summary.per.sample</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>rel_activity <span class="ot">&lt;-</span> <span class="fu">get_sig_exposure</span>(pcawg_sigs, <span class="at">type =</span> <span class="st">&quot;relative&quot;</span>, <span class="at">rel_threshold =</span> <span class="dv">0</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>abs_activity <span class="ot">&lt;-</span> <span class="fu">get_sig_exposure</span>(pcawg_sigs, <span class="at">type =</span> <span class="st">&quot;absolute&quot;</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>rel_activity <span class="ot">&lt;-</span> rel_activity[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) {</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) <span class="fu">round</span>(x, <span class="dv">2</span>) <span class="cf">else</span> x</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>})]</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># all(rownames(abs_activity) == rownames(rel_activity))</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(abs_activity) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;ABS_CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>))</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>act <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  rel_activity, abs_activity,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;../output/enrich_samples/&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)) {</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">&quot;Most enriched in &quot;</span>, i, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">get_sample_from_sig</span>(act, i)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(s)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  plist <span class="ot">&lt;-</span> <span class="fu">show_cn_profile</span>(pcawg_cn_obj,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">samples =</span> s<span class="sc">$</span>sample,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">show_title =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">return_plotlist =</span> <span class="cn">TRUE</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  plist <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map2</span>(plist, s<span class="sc">$</span>sample, <span class="cf">function</span>(p, x) {</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> samp_summary[sample <span class="sc">==</span> x]</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    text <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n_of_seg:&quot;</span>, s<span class="sc">$</span>n_of_seg, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n_of_amp:&quot;</span>, s<span class="sc">$</span>n_of_amp, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;n_of_del:&quot;</span>, s<span class="sc">$</span>n_of_del, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;rel:&quot;</span>, act[sample <span class="sc">==</span> x][[i]], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;abs:&quot;</span>, act[sample <span class="sc">==</span> x][[<span class="fu">paste0</span>(<span class="st">&quot;ABS_&quot;</span>, i)]], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>,</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>,</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> text, <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    p</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plist, <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="fu">file.path</span>(<span class="st">&quot;../output/enrich_samples/&quot;</span>, <span class="fu">paste0</span>(i, <span class="st">&quot;.pdf&quot;</span>)),</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>Most enriched in CNS1
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1: SP117655 0.86    0 0.01    0 0.00 0.02 0.04    0 0.02  0.01  0.01  0.02
2: SP112248 0.79    0 0.00    0 0.06 0.05 0.01    0 0.07  0.00  0.00  0.01
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:     0     0      403        0        7        0        0        9       17
2:     0     0      183        0        1        0       15       11        2
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:        0       10         6         6        11         0         0
2:        0       16         0         0         3         0         0</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-1.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS2
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1:   SP8564 0.03 0.70 0.01 0.09 0.14 0.00 0.02    0 0.00     0     0     0
2: SP123894 0.00 0.55 0.00 0.00 0.00 0.11 0.21    0 0.09     0     0     0
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:     0  0.00       16      338        5       43       67        0       11
2:     0  0.04        0      163        0        0        0       34       62
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:        0        0         0         0         0         0         0
2:        0       26         0         0         0         0        13</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-2.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS3
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1: SP105708    0    0    1    0    0    0    0    0    0     0     0     0
2: SP107381    0    0    1    0    0    0    0    0    0     0     0     0
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:     0     0        0        0       22        0        0        0        0
2:     0     0        0        0       22        0        0        0        0
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:        0        0         0         0         0         0         0
2:        0        0         0         0         0         0         0</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-3.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS4
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1: SP116525 0.07 0.01 0.00 0.79    0 0.08 0.00    0 0.04     0     0     0
2: SP121824 0.00 0.00 0.02 0.79    0 0.00 0.01    0 0.00     0     0     0
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:  0.00  0.00       63       13        0      740        0       75        0
2:  0.18  0.01        0        0       14      446        0        0        3
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:        0       35         0         0         0         4         2
2:        0        0         0         0         0       100         5</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-4.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS5
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1:  SP56303 0.00    0    0 0.07 0.90 0.02    0    0 0.00     0     0     0
2: SP117309 0.03    0    0 0.00 0.86 0.00    0    0 0.11     0     0     0
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:  0.01     0        0        0        0       21      278        6        0
2:  0.00     0        2        0        0        0       62        0        0
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:        0        0         0         1         0         2         0
2:        0        8         0         0         0         0         0</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-5.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS6
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1:  SP77443 0.00 0.00 0.02    0 0.00 0.58 0.02    0 0.27     0  0.02  0.10
2: SP124197 0.15 0.02 0.00    0 0.06 0.57 0.00    0 0.11     0  0.02  0.05
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:     0  0.00        0        0        1        0        0       30        1
2:     0  0.02       32        5        0        0       12      123        0
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:        0       14         0         1         5         0         0
2:        0       23         0         5        10         0         4</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-6.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS7
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1:  SP49114 0.04 0.00 0.23    0    0 0.01 0.63    0 0.01  0.05  0.03  0.00
2: SP114903 0.04 0.15 0.17    0    0 0.00 0.60    0 0.00  0.01  0.02  0.01
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:     0     0       15        0       78        0        0        4      212
2:     0     0       28      100      118        0        0        0      413
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:        0        2        18         9         0         0         0
2:        0        0         7        17         5         0         0</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-7.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS8
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1: SP116539    0    0 0.08    0 0.00 0.00    0 0.86 0.00  0.00  0.00     0
2: SP116706    0    0 0.06    0 0.01 0.01    0 0.78 0.01  0.11  0.04     0
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:     0  0.06        0        0       16        0        0        0        0
2:     0  0.00        0        0       10        0        1        1        0
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:      164        0         0         0         0         0        11
2:      135        1        19         7         0         0         0</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-8.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS9
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1: SP118048    0    0    0    0    0    0    0    0    1     0     0     0
2: SP123964    0    0    0    0    0    0    0    0    1     0     0     0
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:     0     0        0        0        0        0        0        0        0
2:     0     0        0        0        0        0        0        0        0
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:        0       47         0         0         0         0         0
2:        0       34         0         0         0         0         0</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-9.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS10
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1: SP112887    0    0 0.10    0    0    0    0 0.00    0  0.89  0.02     0
2: SP112917    0    0 0.06    0    0    0    0 0.04    0  0.82  0.08     0
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:     0     0        0        0        6        0        0        0        0
2:     0     0        0        0        5        0        0        0        0
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:        0        0        56         1         0         0         0
2:        3        0        63         6         0         0         0</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-10.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS11
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1: SP106797    0    0 0.12    0    0    0 0.03 0.03    0     0  0.81     0
2: SP135354    0    0 0.22    0    0    0 0.00 0.00    0     0  0.78     0
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:     0     0        0        0        4        0        0        0        1
2:     0     0        0        0        6        0        0        0        0
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:        1        0         0        26         0         0         0
2:        0        0         0        21         0         0         0</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-11.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS12
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1: SP106734    0 0.00 0.09    0    0    0    0    0 0.18     0     0  0.73
2:  SP37636    0 0.06 0.03    0    0    0    0    0 0.19     0     0  0.72
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:     0     0        0        0        2        0        0        0        0
2:     0     0        0        2        1        0        0        0        0
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:        0        4         0         0        16         0         0
2:        0        6         0         0        23         0         0</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-12.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS13
    sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12 CNS13
1: SP90269 0.00 0.17 0.07 0.01 0.04    0 0.16 0.02    0  0.03  0.08     0  0.42
2: SP43664 0.11 0.00 0.11 0.11 0.18    0 0.00 0.00    0  0.01  0.08     0  0.41
   CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:     0        0       51       20        2       13        0       47
2:     0       13        0       13       14       22        0        0
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:        6        0        10        25         0       124         0
2:        0        0         1        10         0        50         0</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-13.png" width="3600" style="display: block; margin: auto;" /></p>
<pre><code>Most enriched in CNS14
     sample CNS1 CNS2 CNS3 CNS4 CNS5 CNS6 CNS7 CNS8 CNS9 CNS10 CNS11 CNS12
1:  SP96163    0 0.08 0.09    0    0    0 0.09 0.03 0.01  0.02  0.12  0.01
2: SP116365    0 0.01 0.10    0    0    0 0.11 0.01 0.00  0.00  0.21  0.01
   CNS13 CNS14 ABS_CNS1 ABS_CNS2 ABS_CNS3 ABS_CNS4 ABS_CNS5 ABS_CNS6 ABS_CNS7
1:     0  0.56        0       44       48        0        0        0       50
2:     0  0.55        0        5       35        0        0        0       41
   ABS_CNS8 ABS_CNS9 ABS_CNS10 ABS_CNS11 ABS_CNS12 ABS_CNS13 ABS_CNS14
1:       18        4        12        64         5         0       309
2:        4        0         0        78         2         0       203</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-36-14.png" width="3600" style="display: block; margin: auto;" /></p>
</div>
<div id="ideograph-for-copy-number-profile-reconstruction" class="section level3">
<h3>Ideograph for copy number profile reconstruction</h3>
<blockquote>
<p>TODO: select one/two samples and draw copy number profile -&gt; catalog profile -&gt; signature relative activity. <strong>Similar to Nature paper</strong>.</p>
</blockquote>
</div>
</div>
</div>
<div id="part-3-pan-cancer-signature-analysis" class="section level1">
<h1>PART 3: Pan-Cancer signature analysis</h1>
<p>In this part, we will analyze copy number signatures across cancer types and show the landscape.</p>
<div id="signature-number-and-contribution-in-each-cancer-type" class="section level2">
<h2>Signature number and contribution in each cancer type</h2>
<p>Load tidy cancer type annotation data.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>pcawg_types <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_type_info.rds&quot;</span>)</span></code></pre></div>
<p>Load signature activity data.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>pcawg_activity <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_sigs_CN176_activity.rds&quot;</span>)</span></code></pre></div>
<p>Combine the cancer type annotation and activity data and only keep samples with good reconstruction (<code>&gt;0.75</code> cosine similarity).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>keep_samps <span class="ot">&lt;-</span> pcawg_activity<span class="sc">$</span>similarity[similarity <span class="sc">&gt;</span> <span class="fl">0.75</span>]<span class="sc">$</span>sample</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>df_abs <span class="ot">&lt;-</span> <span class="fu">merge</span>(pcawg_activity<span class="sc">$</span>absolute[sample <span class="sc">%in%</span> keep_samps], pcawg_types, <span class="at">by =</span> <span class="st">&quot;sample&quot;</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>df_rel <span class="ot">&lt;-</span> <span class="fu">merge</span>(pcawg_activity<span class="sc">$</span>relative[sample <span class="sc">%in%</span> keep_samps], pcawg_types, <span class="at">by =</span> <span class="st">&quot;sample&quot;</span>)</span></code></pre></div>
<div id="signature-activity-in-each-cancer-type" class="section level3">
<h3>Signature activity in each cancer type</h3>
<p>Here we draw distribution of a signature across cancer types.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_group_distribution</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  df_abs,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvar =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvar =</span> <span class="st">&quot;CNS1&quot;</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_angle =</span> <span class="dv">90</span>,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_size =</span> <span class="fl">0.3</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-41-1.png" width="3600" style="display: block; margin: auto;" /></p>
<p>We have many signatures here, so we output them to PDF files.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;../output/cancer-type-dist&quot;</span>, <span class="at">showWarnings =</span> F)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>signames <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> signames) {</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  pxx <span class="ot">&lt;-</span> <span class="fu">show_group_distribution</span>(df_abs,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvar =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dvar =</span> i, <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> i,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">g_angle =</span> <span class="dv">90</span>, <span class="at">point_size =</span> <span class="fl">0.3</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="fu">file.path</span>(<span class="st">&quot;../output/cancer-type-dist/&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;Absolute_activity_&quot;</span>, i, <span class="st">&quot;.pdf&quot;</span>)),</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot =</span> pxx, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  pxx <span class="ot">&lt;-</span> <span class="fu">show_group_distribution</span>(df_rel,</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvar =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">dvar =</span> i, <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> i,</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">g_angle =</span> <span class="dv">90</span>, <span class="at">point_size =</span> <span class="fl">0.3</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="fu">file.path</span>(<span class="st">&quot;../output/cancer-type-dist/&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;Relative_activity_&quot;</span>, i, <span class="st">&quot;.pdf&quot;</span>)),</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot =</span> pxx, <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pxx)</span></code></pre></div>
</div>
<div id="signature-landscape" class="section level3">
<h3>Signature landscape</h3>
<p>Define a signature which is detectable if this signature contribute <code>&gt;5%</code> exposures in a sample.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_rel <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_at</span>(dplyr<span class="sc">::</span><span class="fu">vars</span>(dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;CNS&quot;</span>)), <span class="sc">~</span> <span class="fu">ifelse</span>(. <span class="sc">&gt;</span> <span class="fl">0.05</span>, 1L, 0L)) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;CNS&quot;</span>),</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;sig&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;detectable&quot;</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> df_rel <span class="sc">%&gt;%</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;CNS&quot;</span>),</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;sig&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;expo&quot;</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(df, df2,</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;cancer_type&quot;</span>, <span class="st">&quot;sig&quot;</span>)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>df_type <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(cancer_type, sig) <span class="sc">%&gt;%</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">freq =</span> <span class="fu">sum</span>(detectable), <span class="co"># directly use count</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">expo =</span> <span class="fu">median</span>(expo[detectable <span class="sc">==</span> <span class="dv">1</span>]),</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">unique</span>(cancer_type), <span class="st">&quot; (n=&quot;</span>, n, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>mps <span class="ot">&lt;-</span> <span class="fu">unique</span>(df_type[, <span class="fu">c</span>(<span class="st">&quot;cancer_type&quot;</span>, <span class="st">&quot;label&quot;</span>)])</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>mpss <span class="ot">&lt;-</span> mps<span class="sc">$</span>label</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mpss) <span class="ot">&lt;-</span> mps<span class="sc">$</span>cancer_type</span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_type<span class="sc">$</span>freq)</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    6.00   15.00   28.37   35.00  246.00 </code></pre>
<p>Show copy number signature landscape.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  df_type,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> cancer_type, <span class="at">y =</span> <span class="fu">factor</span>(sig, <span class="at">levels =</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)))</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> freq, <span class="at">color =</span> expo)) <span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">rotate_x_text</span>(<span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> mps<span class="sc">$</span>cancer_type, <span class="at">labels =</span> mps<span class="sc">$</span>label) <span class="sc">+</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">250</span>),</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>)</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_stepsn</span>(</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">5</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;Copy number signatures&quot;</span>,</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Median activity</span><span class="sc">\n</span><span class="st">due to signature&quot;</span>,</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="st">&quot;Tumors with</span><span class="sc">\n</span><span class="st">the signature&quot;</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-45-1.png" width="3600" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../output/CNS_PCAWG_landscape.pdf&quot;</span>,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> p,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">12</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="signature-number-distribution" class="section level3">
<h3>Signature number distribution</h3>
<p>For most of cancer types, they have similar signature constitution (most of copy number signatures available in them). However, we need to further check that if many tumors have so many signatures activated.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df_detc <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(cancer_type, sample) <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">signumber =</span> <span class="fu">sum</span>(detectable),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Pan-Cancer signature number distribution.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(df_detc<span class="sc">$</span>signumber, <span class="at">ylab =</span> <span class="st">&quot;Signature number&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-47-1.png" width="600" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_detc<span class="sc">$</span>signumber)</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.000   3.000   5.000   4.643   6.000  11.000 </code></pre>
<p>Most tumors have 3-6 signatures.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df_detc, <span class="fu">aes</span>(<span class="at">x =</span> cancer_type, <span class="at">y =</span> signumber, <span class="at">fill =</span> cancer_type)) <span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;Signature number&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-48-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>From the landscape and distribution data, we know that many signatures activate in most of cancer types, but for a specified tumor, in general there are 3-6 signatures are detectable.</p>
</div>
</div>
<div id="cancer-type-associated-enrichment" class="section level2">
<h2>Cancer type associated enrichment</h2>
<p>Run enrichment analysis.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>enrich_result <span class="ot">&lt;-</span> <span class="fu">group_enrichment</span>(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  df_abs,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">grp_vars =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">enrich_vars =</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>),</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">co_method =</span> <span class="st">&quot;wilcox.test&quot;</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Show enrichment landscape.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>enrich_result<span class="sc">$</span>enrich_var <span class="ot">&lt;-</span> <span class="fu">factor</span>(enrich_result<span class="sc">$</span>enrich_var, <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_group_enrichment</span>(enrich_result, <span class="at">fill_by_p_value =</span> <span class="cn">TRUE</span>, <span class="at">return_list =</span> T)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">$</span>cancer_type <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-50-1.png" width="2550" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../output/CNS_PCAWG_enrichment_landscape.pdf&quot;</span>,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> p,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="fl">8.5</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>To better visualize the enrichment results, we use binned color regions.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_group_enrichment</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  enrich_result,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill_by_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cut_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_list =</span> T</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">$</span>cancer_type <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-51-1.png" width="2550" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;../output/CNS_PCAWG_enrichment_landscape2.pdf&quot;</span>,</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot =</span> p,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="fl">8.5</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We see cancer type <code>SoftTissue-Liposarc</code> has pretty high enrichment on <code>CNS4</code>. Let’s check the enrichment result.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>enrich_result[grp1 <span class="sc">==</span> <span class="st">&quot;SoftTissue-Liposarc&quot;</span>]</span></code></pre></div>
<pre><code>        grp_var enrich_var                grp1 grp2 grp1_size grp1_pos_measure
 1: cancer_type       CNS1 SoftTissue-Liposarc Rest        19        96.315789
 2: cancer_type       CNS2 SoftTissue-Liposarc Rest        19        68.736842
 3: cancer_type       CNS3 SoftTissue-Liposarc Rest        19        11.947368
 4: cancer_type       CNS4 SoftTissue-Liposarc Rest        19       435.526316
 5: cancer_type       CNS5 SoftTissue-Liposarc Rest        19        17.684211
    grp2_size grp2_pos_measure measure_observed measure_tested      p_value
 1:      2718        15.318985        6.2873482             NA 7.503689e-07
 2:      2718        13.663355        5.0307439             NA 1.832154e-02
 3:      2718        12.660412        0.9436793             NA 8.258332e-01
 4:      2718         8.231052       52.9125928             NA 1.535689e-22
 5:      2718        10.408389        1.6990344             NA 6.439534e-02
          type      method
 1: continuous wilcox.test
 2: continuous wilcox.test
 3: continuous wilcox.test
 4: continuous wilcox.test
 5: continuous wilcox.test
 [ reached getOption(&quot;max.print&quot;) -- omitted 9 rows ]</code></pre>
<p>Let’s go further plot the distribution for the two groups.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df_check <span class="ot">&lt;-</span> df_abs[, <span class="fu">c</span>(<span class="st">&quot;CNS4&quot;</span>, <span class="st">&quot;cancer_type&quot;</span>)][</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  , .(</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cancer_type =</span> <span class="fu">ifelse</span>(cancer_type <span class="sc">==</span> <span class="st">&quot;SoftTissue-Liposarc&quot;</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;SoftTissue-Liposarc&quot;</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Others&quot;</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">CNS4 =</span> CNS4</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggboxplot</span>(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  df_check,</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;cancer_type&quot;</span>, <span class="at">y =</span> <span class="st">&quot;CNS4&quot;</span>,</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="cn">FALSE</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">legend =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-54-1.png" width="1200" style="display: block; margin: auto;" /> Check copy number distribution for the <code>"SoftTissue-Liposarc"</code> samples.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> df_abs[cancer_type <span class="sc">==</span> <span class="st">&quot;SoftTissue-Liposarc&quot;</span>]<span class="sc">$</span>sample</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>pcawg_cn_obj <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_obj.rds&quot;</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>cn_dt <span class="ot">&lt;-</span> <span class="fu">subset</span>(pcawg_cn_obj<span class="sc">@</span>data, sample <span class="sc">%in%</span> samples)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>cn_dt<span class="sc">$</span>segLen <span class="ot">&lt;-</span> cn_dt<span class="sc">$</span>end <span class="sc">-</span> cn_dt<span class="sc">$</span>start <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<p>Copy number value:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(cn_dt<span class="sc">$</span>segVal, <span class="at">ylab =</span> <span class="st">&quot;Copy number value&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-56-1.png" width="900" style="display: block; margin: auto;" /></p>
<p>Segment length:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(cn_dt<span class="sc">$</span>segLen, <span class="at">ylab =</span> <span class="st">&quot;Segment length&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-57-1.png" width="900" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>cn_dt_samp <span class="ot">&lt;-</span> cn_dt[, .(<span class="at">nAMP =</span> <span class="fu">sum</span>(segVal <span class="sc">&gt;</span> <span class="dv">2</span>)), by <span class="ot">=</span> sample]</span></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(cn_dt_samp<span class="sc">$</span>nAMP, <span class="at">ylab =</span> <span class="st">&quot;Number of amplifications&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-59-1.png" width="900" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="part-4-cancer-subtyping-and-prognosis-analysis" class="section level1">
<h1>PART 4: Cancer subtyping and prognosis analysis</h1>
<p>In this part, we would like to cluster all tumors based on CN signatures and use the clusters to explore Pan-Cancer heterogeneity.</p>
<div id="data-integration" class="section level2">
<h2>Data integration</h2>
<p>Many raw data have been processed by tools (or collected) and cleaned. This part I mainly describe how to combine them to construct the integrated dataset.</p>
<blockquote>
<p>If you care about the data (source) shown below, please check the last section of <strong>PART 0</strong>.</p>
</blockquote>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  tidyverse,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  data.table,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  sigminer,</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  IDConverter</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Load pre-processed data.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>pcawg_cn_obj <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_obj.rds&quot;</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>pcawg_cn_sig <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_sigs_CN176_signature.rds&quot;</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>pcawg_samp_info_sp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_samp_info_sp.rds&quot;</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>samp_summary <span class="ot">&lt;-</span> pcawg_cn_obj<span class="sc">@</span>summary.per.sample</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>samp_summary<span class="sc">$</span>n_loh <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>Check if all samples are recorded.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(pcawg_cn_obj<span class="sc">@</span>summary.per.sample<span class="sc">$</span>sample <span class="sc">%in%</span> pcawg_samp_info_sp<span class="sc">$</span>pcawg_specimen_histology_August2016_v9<span class="sc">$</span>icgc_specimen_id)</span></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>pcawg_samp_info_sp <span class="ot">&lt;-</span> <span class="fu">lapply</span>(pcawg_samp_info_sp, <span class="cf">function</span>(x) {</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>pcawg_samp_info <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">reduce</span>(pcawg_samp_info_sp, dplyr<span class="sc">::</span>full_join, <span class="at">by =</span> <span class="st">&quot;sample&quot;</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>pcawg_samp_info <span class="ot">&lt;-</span> pcawg_samp_info <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(sample <span class="sc">%in%</span> pcawg_cn_obj<span class="sc">@</span>summary.per.sample<span class="sc">$</span>sample)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pcawg_samp_info_sp)</span></code></pre></div>
<p>Refer to <span class="citation"><a href="#ref-pcawgmutationalsignaturesworkinggroupRepertoireMutationalSignatures2020" role="doc-biblioref">PCAWG Mutational Signatures Working Group et al.</a> (<a href="#ref-pcawgmutationalsignaturesworkinggroupRepertoireMutationalSignatures2020" role="doc-biblioref">2020</a>)</span>, some cancer types with small sample size should be combined.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pcawg_samp_info<span class="sc">$</span>histology_abbreviation)</span></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>pcawg_samp_info <span class="ot">&lt;-</span> pcawg_samp_info <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cancer_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">startsWith</span>(histology_abbreviation, <span class="st">&quot;Breast&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Breast&quot;</span>,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">startsWith</span>(histology_abbreviation, <span class="st">&quot;Biliary-AdenoCA&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Biliary-AdenoCA&quot;</span>,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>      histology_abbreviation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Bone-Epith&quot;</span>, <span class="st">&quot;Bone-Benign&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Bone-Other&quot;</span>,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">startsWith</span>(histology_abbreviation, <span class="st">&quot;Cervix&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Cervix&quot;</span>,</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>      histology_abbreviation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Myeloid-AML, Myeloid-MDS&quot;</span>, <span class="st">&quot;Myeloid-AML, Myeloid-MPN&quot;</span>, <span class="st">&quot;Myeloid-MDS&quot;</span>, <span class="st">&quot;Myeloid-MPN&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Myeloid-MDS/MPN&quot;</span>,</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> histology_abbreviation</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Select important features.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>pcawg_samp_info <span class="ot">&lt;-</span> pcawg_samp_info <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sample&quot;</span>, <span class="st">&quot;_PATIENT&quot;</span>, <span class="st">&quot;donor_sex&quot;</span>, <span class="st">&quot;donor_age_at_diagnosis&quot;</span>,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;donor_survival_time&quot;</span>, <span class="st">&quot;donor_vital_status&quot;</span>, <span class="st">&quot;first_therapy_type&quot;</span>,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;tobacco_smoking_history_indicator&quot;</span>, <span class="st">&quot;alcohol_history&quot;</span>,</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;dcc_project_code&quot;</span>, <span class="st">&quot;dcc_specimen_type&quot;</span>,</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;histology_abbreviation&quot;</span>, <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;tumour_stage&quot;</span>,</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;level_of_cellularity&quot;</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pcawg_samp_info)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;donor_id&quot;</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicated samples</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>pcawg_samp_info <span class="ot">&lt;-</span> pcawg_samp_info[<span class="sc">!</span><span class="fu">duplicated</span>(pcawg_samp_info<span class="sc">$</span>sample), ]</span></code></pre></div>
<p>Get signature activities.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>pcawg_activity <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_sigs_CN176_activity.rds&quot;</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>expo_abs <span class="ot">&lt;-</span> pcawg_activity<span class="sc">$</span>absolute[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) <span class="fu">round</span>(x, <span class="at">digits =</span> <span class="dv">3</span>) <span class="cf">else</span> x)]</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(expo_abs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;Abs_&quot;</span>, <span class="fu">colnames</span>(expo_abs)[<span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>expo_rel <span class="ot">&lt;-</span> pcawg_activity<span class="sc">$</span>relative[, <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) <span class="fu">round</span>(x, <span class="at">digits =</span> <span class="dv">3</span>) <span class="cf">else</span> x)]</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(expo_rel) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;Rel_&quot;</span>, <span class="fu">colnames</span>(expo_rel)[<span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>pcawg_activity2 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(expo_abs, expo_rel, <span class="at">by =</span> <span class="st">&quot;sample&quot;</span>)</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>pcawg_activity2 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(pcawg_activity2, pcawg_activity<span class="sc">$</span>similarity, <span class="at">by =</span> <span class="st">&quot;sample&quot;</span>)</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>pcawg_activity2<span class="sc">$</span>keep <span class="ot">&lt;-</span> pcawg_activity2<span class="sc">$</span>similarity <span class="sc">&gt;</span> <span class="fl">0.75</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>pcawg_activity <span class="ot">&lt;-</span> pcawg_activity2</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pcawg_activity2, expo_abs, expo_rel)</span></code></pre></div>
<p>Read tumor purity &amp; ploidy &amp; WGD status.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>dt_pp <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;../data/PCAWG/consensus.20170217.purity.ploidy_sp&quot;</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>dt_pp <span class="ot">&lt;-</span> dt_pp[, <span class="fu">c</span>(<span class="st">&quot;samplename&quot;</span>, <span class="st">&quot;purity&quot;</span>, <span class="st">&quot;ploidy&quot;</span>, <span class="st">&quot;wgd_status&quot;</span>)]</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dt_pp)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sample&quot;</span></span></code></pre></div>
<p>Calculate fusion events in all samples.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>fusion <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;../data/PCAWG/pcawg3_fusions_PKU_EBI.gene_centric.sp.xena&quot;</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>fusion <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(fusion[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>fusion <span class="ot">&lt;-</span> <span class="fu">apply</span>(fusion, <span class="dv">2</span>, sum)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>fusion <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample =</span> <span class="fu">names</span>(fusion),</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_fusion =</span> <span class="fu">as.numeric</span>(fusion)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Load HRD status in all samples.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>HRD <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/PCAWG/pcawg_CHORD.rds&quot;</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>HRD <span class="ot">&lt;-</span> HRD <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(icgc_specimen_id, is_hrd, genotype_monoall) <span class="sc">%&gt;%</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;hrd_status&quot;</span>, <span class="st">&quot;hrd_genotype&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code></pre></div>
<p>Read LOH data.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>LOH <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_loh.rds&quot;</span>)</span></code></pre></div>
<p>Read Chromothripsis data and clean it.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># http://compbio.med.harvard.edu/chromothripsis/</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>chromothripsis <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;../data/PCAWG/PCAWG-ShatterSeek.txt.gz&quot;</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>chromothripsis <span class="ot">&lt;-</span> chromothripsis[, <span class="fu">c</span>(<span class="st">&quot;icgc_donor_id&quot;</span>, <span class="st">&quot;type_chromothripsis&quot;</span>, <span class="st">&quot;chromo_label&quot;</span>)]</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check label</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(chromothripsis<span class="sc">$</span>chromo_label)</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(chromothripsis<span class="sc">$</span>chromo_label))</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>chromothripsis_summary <span class="ot">&lt;-</span> chromothripsis[</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  , .(</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_chromo =</span> <span class="fu">sum</span>(chromo_label <span class="sc">!=</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">chromo_type =</span> <span class="fu">paste0</span>(<span class="fu">na.omit</span>(type_chromothripsis), <span class="at">collapse =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> icgc_donor_id</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>chromothripsis_summary <span class="ot">&lt;-</span> <span class="fu">merge</span>(chromothripsis_summary, pcawg_full[, <span class="fu">c</span>(<span class="st">&quot;icgc_donor_id&quot;</span>, <span class="st">&quot;icgc_specimen_id&quot;</span>)],</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;icgc_donor_id&quot;</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>chromothripsis_summary<span class="sc">$</span>icgc_donor_id <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(chromothripsis_summary)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(chromothripsis)</span></code></pre></div>
<p>Read AmpliconArchitect results.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>aa1 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;../data/PCAWG/ecDNA.xlsx&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>aa2 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;../data/PCAWG/ecDNA.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="dv">3</span>)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(aa1<span class="sc">$</span>amplicon_classification)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(aa2<span class="sc">$</span>sample_classification)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(aa1<span class="sc">$</span>sample_barcode <span class="sc">%in%</span> aa2<span class="sc">$</span>sample_barcode)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>aa_summary <span class="ot">&lt;-</span> aa1 <span class="sc">%&gt;%</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(sample_barcode) <span class="sc">%&gt;%</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_amplicon_BFB =</span> <span class="fu">sum</span>(amplicon_classification <span class="sc">==</span> <span class="st">&quot;BFB&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_amplicon_ecDNA =</span> <span class="fu">sum</span>(amplicon_classification <span class="sc">==</span> <span class="st">&quot;Circular&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_amplicon_HR =</span> <span class="fu">sum</span>(amplicon_classification <span class="sc">==</span> <span class="st">&quot;Heavily-rearranged&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_amplicon_Linear =</span> <span class="fu">sum</span>(amplicon_classification <span class="sc">==</span> <span class="st">&quot;Linear&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(aa_summary)</span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>custom_dt <span class="ot">&lt;-</span> IDConverter<span class="sc">::</span>pcawg_simple[, <span class="fu">c</span>(<span class="st">&quot;submitted_specimen_id&quot;</span>, <span class="st">&quot;icgc_specimen_id&quot;</span>)]</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>custom_dt <span class="ot">&lt;-</span> custom_dt[<span class="fu">startsWith</span>(submitted_specimen_id, <span class="st">&quot;TCGA&quot;</span>)]</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>custom_dt[, submitted_specimen_id <span class="sc">:</span><span class="er">=</span> <span class="fu">substr</span>(submitted_specimen_id, <span class="dv">1</span>, <span class="dv">15</span>)]</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>aa_summary[</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>  , sample <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">startsWith</span>(sample_barcode, <span class="st">&quot;SA&quot;</span>),</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">convert_pcawg</span>(sample_barcode, <span class="at">from =</span> <span class="st">&quot;icgc_sample_id&quot;</span>, <span class="at">to =</span> <span class="st">&quot;icgc_specimen_id&quot;</span>),</span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">convert_custom</span>(sample_barcode, <span class="at">from =</span> <span class="st">&quot;submitted_specimen_id&quot;</span>, <span class="at">to =</span> <span class="st">&quot;icgc_specimen_id&quot;</span>, <span class="at">dt =</span> custom_dt)</span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Filter out samples not in PCAWG</span></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>aa_summary <span class="ot">&lt;-</span> aa_summary[<span class="sc">!</span><span class="fu">is.na</span>(sample)][, sample_barcode <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(aa1, aa2, custom_dt)</span></code></pre></div>
<p>Read TelomereHunter results.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>TC <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;../data/PCAWG/TelomereContent.xlsx&quot;</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>TC <span class="ot">&lt;-</span> TC <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;icgc_specimen_id&quot;</span>, <span class="st">&quot;tel_content_log2&quot;</span>))</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(TC)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>data.table<span class="sc">::</span><span class="fu">setDT</span>(TC)</span></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>apobec <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">&quot;../data/PCAWG/MAF_Aug31_2016_sorted_A3A_A3B_comparePlus.txt&quot;</span>, <span class="at">col_types =</span> <span class="fu">cols</span>())</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>apobec <span class="ot">&lt;-</span> apobec <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  data.table<span class="sc">::</span><span class="fu">as.data.table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;APOBEC_mutations&quot;</span>))</span></code></pre></div>
<p>Combine and save result combined data.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>pcawg_samp_info <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">reduce</span>(<span class="fu">list</span>(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  pcawg_samp_info,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  pcawg_activity,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  samp_summary,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  dt_pp,</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  fusion,</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  HRD,</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  LOH,</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  chromothripsis_summary,</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>  aa_summary,</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  TC,</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>  apobec</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span>left_join,</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a><span class="at">by =</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(pcawg_samp_info, <span class="at">file =</span> <span class="st">&quot;../data/pcawg_sample_tidy_info.rds&quot;</span>)</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Remove all objects</span></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
</div>
<div id="clustering-with-signature-activity" class="section level2">
<h2>Clustering with signature activity</h2>
<p>Here, we use recent consensus clustering toolkit <a href="https://github.com/jokergoo/cola">cola</a>.</p>
<p>We take 2 steps to obtain a robust clustering result:</p>
<ol style="list-style-type: decimal">
<li>We sort all samples by their total signature activities and randomly select <code>500</code> samples for running multiple methods provided by <code>cola</code> at the same time, then pick up the optimal method combination.</li>
<li>We run clustering for all samples by the method combination above and check the cola report to determine the suitable cluster number.</li>
</ol>
<div id="step-1-select-suitable-method-combination" class="section level3">
<h3>Step 1: select suitable method combination</h3>
<p>There are 2 key arguments in <code>cola</code> clustering function:</p>
<ol style="list-style-type: decimal">
<li><code>top_value_method</code>: used to extract rows (i.e. signatures here) with top values.</li>
<li><code>partition_method</code>: used to select partition method.</li>
</ol>
<p>We try all combinations with randomly selected <code>500</code> samples to explore the suitable setting.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cola)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>act <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_sigs_CN176_activity.rds&quot;</span>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">reduce</span>(</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    act<span class="sc">$</span>absolute,</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    act<span class="sc">$</span>similarity</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span>left_join,</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(similarity <span class="sc">&gt;</span> <span class="fl">0.75</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sample, <span class="fu">starts_with</span>(<span class="st">&quot;CNS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">&quot;sample&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>mat_adj <span class="ot">&lt;-</span> <span class="fu">adjust_matrix</span>(mat)</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 rows have been removed with too low variance (sd &lt; 0.05 quantile)</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mat_adj)</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Select suitable parameters ----------------------------------------------</span></span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>ds <span class="ot">&lt;-</span> <span class="fu">colSums</span>(mat_adj)</span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(ds)</span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>select_samps <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">names</span>(<span class="fu">sort</span>(ds)), <span class="dv">500</span>)</span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(ds[select_samps])</span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>rl_samp <span class="ot">&lt;-</span> <span class="fu">run_all_consensus_partition_methods</span>(mat_adj[, select_samps], <span class="at">top_n =</span> <span class="dv">13</span>, <span class="at">mc.cores =</span> <span class="dv">8</span>, <span class="at">max_k =</span> <span class="dv">10</span>)</span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a><span class="fu">cola_report</span>(rl_samp, <span class="at">output_dir =</span> <span class="st">&quot;../output/cola_report/pcawg_sigs_500_sampls&quot;</span>, <span class="at">mc.cores =</span> <span class="dv">8</span>)</span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(rl_samp)</span></code></pre></div>
<p>The <code>cola</code> output report is very big and isn’t suitable to show, here I only include key figures to determine the parameter setting.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster number 2</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;cola-test-figs/tab-collect-stats-from-consensus-partition-list-1-1.png&quot;</span>)</span></code></pre></div>
<p><img src="cola-test-figs/tab-collect-stats-from-consensus-partition-list-1-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster number 3</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;cola-test-figs/tab-collect-stats-from-consensus-partition-list-2-1.png&quot;</span>)</span></code></pre></div>
<p><img src="cola-test-figs/tab-collect-stats-from-consensus-partition-list-2-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster number 4</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;cola-test-figs/tab-collect-stats-from-consensus-partition-list-3-1.png&quot;</span>)</span></code></pre></div>
<p><img src="cola-test-figs/tab-collect-stats-from-consensus-partition-list-3-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster number 5</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;cola-test-figs/tab-collect-stats-from-consensus-partition-list-4-1.png&quot;</span>)</span></code></pre></div>
<p><img src="cola-test-figs/tab-collect-stats-from-consensus-partition-list-4-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster number 6</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;cola-test-figs/tab-collect-stats-from-consensus-partition-list-5-1.png&quot;</span>)</span></code></pre></div>
<p><img src="cola-test-figs/tab-collect-stats-from-consensus-partition-list-5-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster number 7</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;cola-test-figs/tab-collect-stats-from-consensus-partition-list-6-1.png&quot;</span>)</span></code></pre></div>
<p><img src="cola-test-figs/tab-collect-stats-from-consensus-partition-list-6-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster number 8</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;cola-test-figs/tab-collect-stats-from-consensus-partition-list-7-1.png&quot;</span>)</span></code></pre></div>
<p><img src="cola-test-figs/tab-collect-stats-from-consensus-partition-list-7-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster number 9</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;cola-test-figs/tab-collect-stats-from-consensus-partition-list-8-1.png&quot;</span>)</span></code></pre></div>
<p><img src="cola-test-figs/tab-collect-stats-from-consensus-partition-list-8-1.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster number 10</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;cola-test-figs/tab-collect-stats-from-consensus-partition-list-9-1.png&quot;</span>)</span></code></pre></div>
<p><img src="cola-test-figs/tab-collect-stats-from-consensus-partition-list-9-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div id="step-2-select-suitable-cluster-number" class="section level3">
<h3>Step 2: select suitable cluster number</h3>
<p>From figures above we do clearly see that the <code>skmeans</code> partition method fits our data and any <code>top_value_method</code> is okay (because all signatures are used). Finally, we choose combine <code>skmeans</code> (partition method) and <code>ATC</code> (top value method introduced firstly by <code>cola</code>) to run clustering for all samples.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>final <span class="ot">&lt;-</span> <span class="fu">run_all_consensus_partition_methods</span>(</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  mat_adj,</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_value_method =</span> <span class="st">&quot;ATC&quot;</span>,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">partition_method =</span> <span class="st">&quot;skmeans&quot;</span>,</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_n =</span> <span class="dv">13</span>, <span class="at">mc.cores =</span> <span class="dv">8</span>, <span class="at">max_k =</span> <span class="dv">10</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cola_report</span>(final, <span class="at">output_dir =</span> <span class="st">&quot;../output/cola_report/pcawg_sigs_all_sampls&quot;</span>, <span class="at">mc.cores =</span> <span class="dv">8</span>)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(final, <span class="at">file =</span> <span class="st">&quot;../data/pcawg_cola_result.rds&quot;</span>)</span></code></pre></div>
<p>The report can be viewed at <a href="./pcawg_sigs_all_sampls/cola_report.html">here</a>.</p>
<p>Next, we will load the data and visualize to select suitable cluster number.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cola)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ComplexHeatmap)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>cluster_res <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cola_result.rds&quot;</span>)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>cluster_res <span class="ot">&lt;-</span> cluster_res[<span class="st">&quot;ATC&quot;</span>, <span class="st">&quot;skmeans&quot;</span>]</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>cluster_res</span></code></pre></div>
<pre><code>A &#39;ConsensusPartition&#39; object with k = 2, 3, 4, 5, 6, 7, 8, 9, 10.
  On a matrix with 13 rows and 2737 columns.
  Top rows (13) are extracted by &#39;ATC&#39; method.
  Subgroups are detected by &#39;skmeans&#39; method.
  Performed in total 450 partitions by row resampling.
  Best k for subgroups seems to be 2.

Following methods can be applied to this &#39;ConsensusPartition&#39; object:
 [1] &quot;cola_report&quot;             &quot;collect_classes&quot;        
 [3] &quot;collect_plots&quot;           &quot;collect_stats&quot;          
 [5] &quot;colnames&quot;                &quot;compare_signatures&quot;     
 [7] &quot;consensus_heatmap&quot;       &quot;dimension_reduction&quot;    
 [9] &quot;functional_enrichment&quot;   &quot;get_anno_col&quot;           
[11] &quot;get_anno&quot;                &quot;get_classes&quot;            
[13] &quot;get_consensus&quot;           &quot;get_matrix&quot;             
[15] &quot;get_membership&quot;          &quot;get_param&quot;              
[17] &quot;get_signatures&quot;          &quot;get_stats&quot;              
[19] &quot;is_best_k&quot;               &quot;is_stable_k&quot;            
[21] &quot;membership_heatmap&quot;      &quot;ncol&quot;                   
[23] &quot;nrow&quot;                    &quot;plot_ecdf&quot;              
[25] &quot;predict_classes&quot;         &quot;rownames&quot;               
[27] &quot;select_partition_number&quot; &quot;show&quot;                   
[29] &quot;suggest_best_k&quot;          &quot;test_to_known_factors&quot;  </code></pre>
<p>Show different statistics along with different cluster number <code>k</code>, which helps to determine the “best k.”</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select_partition_number</span>(cluster_res)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-83-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>There are many details about all statistical measures shown above at <a href="http://bioconductor.org/packages/devel/bioc/vignettes/cola/inst/doc/cola.html#toc_13">cola vignette</a>. The best k <code>2</code> is suggested by <code>cola</code> package due to its better statistical measures. However, in this practice, I think <code>5</code> is more suitable.</p>
<p>I have the following reasons:</p>
<ol style="list-style-type: decimal">
<li>Measure <code>1 - PAC</code> reaches convergence at <code>k = 5</code>.</li>
<li>Measure <code>Silhouette</code> reaches local optimum at <code>k = 5</code>.</li>
<li>Measure <code>Concordance</code> reaches local optimum at <code>k = 5</code>.</li>
</ol>
<p>I will draw another plot to show why the two <code>k</code>s are suitable.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_classes</span>(cluster_res)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-84-1.png" width="3900" style="display: block; margin: auto;" /></p>
<p>We can see that the probability constitution of class assignment for subgroups for <code>k = 6, 7, 8</code> are similar to <code>k = 5</code>.</p>
<p>Draw all plots into one single page.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="st">&quot;../output/cola_all_plots.pdf&quot;</span>, <span class="at">width =</span> <span class="dv">16</span>, <span class="at">height =</span> <span class="dv">10</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_plots</span>(cluster_res)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p>Now we get the cluster labels of samples for downstream analysis.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>pcawg_clusters <span class="ot">&lt;-</span> <span class="fu">get_classes</span>(cluster_res, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(pcawg_clusters, <span class="at">file =</span> <span class="st">&quot;../data/pcawg_clusters.rds&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="heatmap-for-clustering-and-genotypephenotype-features" class="section level2">
<h2>Heatmap for clustering and genotype/phenotype features</h2>
<p>Load tidy sample info.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>tidy_info <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_sample_tidy_info.rds&quot;</span>)</span></code></pre></div>
<p>Clean some info.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>detect_any <span class="ot">&lt;-</span> <span class="cf">function</span>(x, p) {</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(p) <span class="sc">==</span> 1L) {</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_detect</span>(x, p)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(p, <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_detect</span>(x, .))</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">reduce</span>(y, <span class="st">`</span><span class="at">|</span><span class="st">`</span>)</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>  y[<span class="fu">is.na</span>(y)] <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>  y</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>tidy_info <span class="ot">&lt;-</span> tidy_info <span class="sc">%&gt;%</span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Roughly reassign the staging to TNM stages</span></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Basically follow 7th TNM staging version, see plot &lt;https://bkimg.cdn.bcebos.com/pic/a8014c086e061d952019ec8773f40ad162d9ca36?x-bce-process=image/watermark,image_d2F0ZXIvYmFpa2U4MA==,g_7,xp_5,yp_5&gt;</span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Other references:</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># https://www.cancer.org/treatment/understanding-your-diagnosis/staging.html</span></span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># https://www.cancer.gov/publications/dictionaries/cancer-terms/def/abcd-rating</span></span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># https://web.archive.org/web/20081004121942/http://www.oncologychannel.com/prostatecancer/stagingsystems.shtml</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># https://baike.baidu.com/item/TNM%E5%88%86%E6%9C%9F%E7%B3%BB%E7%BB%9F/10700513</span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">tumour_stage =</span> <span class="fu">case_when</span>(</span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>      tumour_stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;1a&quot;</span>, <span class="st">&quot;1b&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;I&quot;</span>, <span class="st">&quot;IA&quot;</span>, <span class="st">&quot;IB&quot;</span>, <span class="st">&quot;T1c&quot;</span>, <span class="st">&quot;T1N0&quot;</span>) <span class="sc">|</span> <span class="fu">detect_any</span>(tumour_stage, <span class="fu">c</span>(<span class="st">&quot;T1N0M0&quot;</span>, <span class="st">&quot;T1aN0M0&quot;</span>, <span class="st">&quot;T1bN0M0&quot;</span>, <span class="st">&quot;T2aN0M0&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;I&quot;</span>,</span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>      tumour_stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;2a&quot;</span>, <span class="st">&quot;2b&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;IIA&quot;</span>, <span class="st">&quot;IIB&quot;</span>, <span class="st">&quot;T3a&quot;</span>, <span class="st">&quot;T3aN0&quot;</span>) <span class="sc">|</span> <span class="fu">detect_any</span>(tumour_stage, <span class="fu">c</span>(<span class="st">&quot;T2bN0M0&quot;</span>, <span class="st">&quot;T3N0M0&quot;</span>, <span class="st">&quot;T[^34]N1.*M0&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;II&quot;</span>,</span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a>      tumour_stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;3&quot;</span>, <span class="st">&quot;3a&quot;</span>, <span class="st">&quot;3b&quot;</span>, <span class="st">&quot;3c&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;III&quot;</span>, <span class="st">&quot;IIIA&quot;</span>, <span class="st">&quot;IIIB&quot;</span>, <span class="st">&quot;IIIC&quot;</span>) <span class="sc">|</span> <span class="fu">detect_any</span>(tumour_stage, <span class="fu">c</span>(<span class="st">&quot;N[23].*M0&quot;</span>, <span class="st">&quot;T3N1.*M0&quot;</span>, <span class="st">&quot;T4.*M0&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;III&quot;</span>,</span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a>      tumour_stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;4&quot;</span>, <span class="st">&quot;IV&quot;</span>, <span class="st">&quot;IVA&quot;</span>) <span class="sc">|</span> <span class="fu">detect_any</span>(tumour_stage, <span class="st">&quot;M[^0X]&quot;</span>) <span class="sc">~</span> <span class="st">&quot;IV&quot;</span>,</span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span></span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">first_therapy_type =</span> <span class="fu">ifelse</span>(first_therapy_type <span class="sc">==</span> <span class="st">&quot;monoclonal antibodies (for liquid tumours)&quot;</span>,</span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;other therapy&quot;</span>, first_therapy_type</span>
<span id="cb114-31"><a href="#cb114-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb114-32"><a href="#cb114-32" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Generate annotation data for plotting.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>anno_df <span class="ot">&lt;-</span> tidy_info <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(keep) <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    sample,</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>    donor_age_at_diagnosis, n_of_amp, n_of_del, n_of_vchr, cna_burden, purity, ploidy,</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>    n_LOH, n_fusion, n_chromo, n_amplicon_BFB, n_amplicon_ecDNA, n_amplicon_HR, n_amplicon_Linear,</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>    tel_content_log2,</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>    donor_sex, tumour_stage, wgd_status, hrd_status</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_at</span>(</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vars</span>(n_fusion, n_chromo, n_amplicon_BFB, n_amplicon_ecDNA, n_amplicon_HR, n_amplicon_Linear),</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .)</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">hrd_status =</span> <span class="fu">ifelse</span>(hrd_status, <span class="st">&quot;hrd&quot;</span>, <span class="st">&quot;no_hrd&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Age =</span> donor_age_at_diagnosis,</span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">AMPs =</span> n_of_amp,</span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">DELs =</span> n_of_del,</span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Affected_Chrs =</span> n_of_vchr,</span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">CNA_Burden =</span> cna_burden,</span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Purity =</span> purity,</span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">Ploidy =</span> ploidy,</span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">LOHs =</span> n_LOH,</span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">Fusions =</span> n_fusion,</span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Chromothripsis =</span> n_chromo,</span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">BFBs =</span> n_amplicon_BFB,</span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">ecDNAs =</span> n_amplicon_ecDNA,</span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">HRs =</span> n_amplicon_HR,</span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">Linear_Amplicons =</span> n_amplicon_Linear,</span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Telomere_Content(log2)</span><span class="st">`</span> <span class="ot">=</span> tel_content_log2,</span>
<span id="cb115-31"><a href="#cb115-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sex =</span> donor_sex,</span>
<span id="cb115-32"><a href="#cb115-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">Tumor_Stage =</span> tumour_stage,</span>
<span id="cb115-33"><a href="#cb115-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">WGD_Status =</span> wgd_status,</span>
<span id="cb115-34"><a href="#cb115-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">HRD_Status =</span> hrd_status</span>
<span id="cb115-35"><a href="#cb115-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb115-36"><a href="#cb115-36" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="st">&quot;sample&quot;</span>)</span>
<span id="cb115-37"><a href="#cb115-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-38"><a href="#cb115-38" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(anno_df, <span class="at">file =</span> <span class="st">&quot;../data/pcawg_tidy_anno_df.rds&quot;</span>)</span>
<span id="cb115-39"><a href="#cb115-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-40"><a href="#cb115-40" aria-hidden="true" tabindex="-1"></a>left_annotation <span class="ot">&lt;-</span> <span class="fu">rowAnnotation</span>(<span class="at">foo =</span> <span class="fu">anno_text</span>(<span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>)))</span></code></pre></div>
<p>Show heatmap for clusters based on signature activities.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_signatures</span>(cluster_res,</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">5</span>, <span class="at">silhouette_cutoff =</span> <span class="fl">0.2</span>, <span class="at">anno =</span> anno_df,</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">left_annotation =</span> left_annotation</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>* 2674/2737 samples (in 5 classes) remain after filtering by silhouette (&gt;= 0.2).
* cache hash: 7114ace1f849ae9cfc08017afb5e1a81 (seed 888).
* calculating row difference between subgroups by Ftest.
* split rows into 4 groups by k-means clustering.
* 13 signatures (100.0%) under fdr &lt; 0.05, group_diff &gt; 0.
* making heatmaps for signatures.</code></pre>
<pre><code>Error in getFromNamespace(device_info[3], ns = device_info[2])(temp_image): file is not in PNG format</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-90-1.png" width="6600" style="display: block; margin: auto;" /></p>
<p>Save to file.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="st">&quot;../output/pcawg_cluster_heatmap.pdf&quot;</span>, <span class="at">width =</span> <span class="dv">22</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">onefile =</span> <span class="cn">FALSE</span>)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_signatures</span>(cluster_res, <span class="at">k =</span> <span class="dv">5</span>, <span class="at">silhouette_cutoff =</span> <span class="fl">0.2</span>, <span class="at">anno =</span> anno_df, <span class="at">left_annotation =</span> left_annotation)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="exploration-of-patients-prognosis-difference-across-clusters" class="section level2">
<h2>Exploration of patients’ prognosis difference across clusters</h2>
<div id="clean-data-for-survival-analysis" class="section level3">
<h3>Clean data for survival analysis</h3>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ezcox)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>cluster_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_clusters.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;sample&quot;</span>)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>tidy_info <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_sample_tidy_info.rds&quot;</span>)</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>df_os <span class="ot">&lt;-</span> tidy_info <span class="sc">%&gt;%</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(keep) <span class="sc">%&gt;%</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample, donor_vital_status, donor_survival_time) <span class="sc">%&gt;%</span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;os&quot;</span>, <span class="st">&quot;time&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">os =</span> <span class="fu">ifelse</span>(os <span class="sc">==</span> <span class="st">&quot;deceased&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> time <span class="sc">/</span> <span class="dv">365</span></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cluster_df, <span class="at">by =</span> <span class="st">&quot;sample&quot;</span>)</span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_os)[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">&quot;cluster&quot;</span></span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the group with minimal CNV level as reference group</span></span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a>df_os<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;subgroup&quot;</span>, df_os<span class="sc">$</span>cluster)</span></code></pre></div>
<p>Available sample number with OS data:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(df_os)</span></code></pre></div>
<pre><code>[1] 1729</code></pre>
</div>
<div id="forest-plot" class="section level3">
<h3>Forest plot</h3>
<p>It’s pretty easy to visualize the relationship between subgroups and patient’s prognosis with forest plot by R package <code>ezcox</code> developed by me before.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_forest</span>(df_os, <span class="at">covariates =</span> <span class="st">&quot;cluster&quot;</span>, <span class="at">status =</span> <span class="st">&quot;os&quot;</span>, <span class="at">add_caption =</span> <span class="cn">FALSE</span>, <span class="at">merge_models =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-94-1.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
<div id="k-m-plot" class="section level3">
<h3>K-M plot</h3>
<p>We can also check the OS difference with K-M plot.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span></code></pre></div>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>sfit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, os) <span class="sc">~</span> cluster, <span class="at">data =</span> df_os)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(sfit,</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pval =</span> <span class="cn">TRUE</span>,</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> <span class="st">&quot;pct&quot;</span>,</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Time (in years)&quot;</span>,</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># palette = &quot;jco&quot;,</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.labs =</span> <span class="fu">paste0</span>(<span class="st">&quot;subgroup&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">break.time.by =</span> <span class="dv">5</span>,</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">risk.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">tables.height =</span> <span class="fl">0.4</span></span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-96-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>The result has similar meaning as forest plot.</p>
</div>
</div>
<div id="the-difference-of-genotypephenotype-measures-across-clusters" class="section level2">
<h2>The difference of genotype/phenotype measures across clusters</h2>
<div id="signatures" class="section level3">
<h3>Signatures</h3>
<p>Load SBS/DBS/ID signature activities generated from PCAWG Nature Study.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>pcawg_sbs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../data/PCAWG/PCAWG_sigProfiler_SBS_signatures_in_samples.csv&quot;</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>pcawg_dbs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../data/PCAWG/PCAWG_sigProfiler_DBS_signatures_in_samples.csv&quot;</span>)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>pcawg_id <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../data/PCAWG/PCAWG_SigProfiler_ID_signatures_in_samples.csv&quot;</span>)</span></code></pre></div>
<p>Merge data.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>df_merged <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">reduce</span>(</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    tidy_info,</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>    pcawg_sbs[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">sample =</span> <span class="st">`</span><span class="at">Sample Names</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Drop Possible sequencing artefact associated signatures</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>SBS43, <span class="sc">-</span><span class="fu">c</span>(SBS45<span class="sc">:</span>SBS60)),</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>    pcawg_dbs[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">sample =</span> <span class="st">`</span><span class="at">Sample Names</span><span class="st">`</span>),</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>    pcawg_id[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">sample =</span> <span class="st">`</span><span class="at">Sample Names</span><span class="st">`</span>),</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>    cluster_df[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;cluster&quot;</span>))</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span>left_join,</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cluster)) <span class="sc">%&gt;%</span></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">paste0</span>(<span class="st">&quot;subgroup&quot;</span>, cluster))</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_merged) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;Abs_&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="fu">colnames</span>(df_merged))</span></code></pre></div>
<div id="enrichment-analysis-for-copy-number-signatures" class="section level4">
<h4>Enrichment analysis for copy number signatures</h4>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>enrich_result_cn <span class="ot">&lt;-</span> <span class="fu">group_enrichment</span>(</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  df_merged,</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">grp_vars =</span> <span class="st">&quot;cluster&quot;</span>,</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">enrich_vars =</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>),</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">co_method =</span> <span class="st">&quot;wilcox.test&quot;</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>enrich_result_cn<span class="sc">$</span>enrich_var <span class="ot">&lt;-</span> <span class="fu">factor</span>(enrich_result_cn<span class="sc">$</span>enrich_var, <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>))</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_group_enrichment</span>(</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  enrich_result_cn,</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill_by_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cut_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_list =</span> T</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">$</span>cluster <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-100-1.png" width="1950" style="display: block; margin: auto;" /></p>
</div>
<div id="enrichment-analysis-for-sbs-signatures" class="section level4">
<h4>Enrichment analysis for SBS signatures</h4>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>nm_sbs <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df_merged)[<span class="fu">grepl</span>(<span class="st">&quot;SBS&quot;</span>, <span class="fu">colnames</span>(df_merged))]</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>enrich_result_sbs <span class="ot">&lt;-</span> <span class="fu">group_enrichment</span>(</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  df_merged,</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">grp_vars =</span> <span class="st">&quot;cluster&quot;</span>,</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">enrich_vars =</span> nm_sbs,</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">co_method =</span> <span class="st">&quot;wilcox.test&quot;</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>enrich_result_sbs<span class="sc">$</span>enrich_var <span class="ot">&lt;-</span> <span class="fu">factor</span>(enrich_result_sbs<span class="sc">$</span>enrich_var, nm_sbs)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_group_enrichment</span>(</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  enrich_result_sbs,</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill_by_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cut_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_list =</span> T</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">$</span>cluster <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-102-1.png" width="1950" style="display: block; margin: auto;" /></p>
</div>
<div id="enrichment-analysis-for-dbs-signatures" class="section level4">
<h4>Enrichment analysis for DBS signatures</h4>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>nm_dbs <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df_merged)[<span class="fu">grepl</span>(<span class="st">&quot;DBS&quot;</span>, <span class="fu">colnames</span>(df_merged))]</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>enrich_result_dbs <span class="ot">&lt;-</span> <span class="fu">group_enrichment</span>(</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>  df_merged,</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">grp_vars =</span> <span class="st">&quot;cluster&quot;</span>,</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">enrich_vars =</span> nm_dbs,</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">co_method =</span> <span class="st">&quot;wilcox.test&quot;</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>enrich_result_dbs<span class="sc">$</span>enrich_var <span class="ot">&lt;-</span> <span class="fu">factor</span>(enrich_result_dbs<span class="sc">$</span>enrich_var, nm_dbs)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_group_enrichment</span>(</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  enrich_result_dbs,</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill_by_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cut_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_list =</span> T</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">$</span>cluster <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-104-1.png" width="1950" style="display: block; margin: auto;" /></p>
</div>
<div id="enrichment-analysis-for-id-signatures" class="section level4">
<h4>Enrichment analysis for ID signatures</h4>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>nm_id <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df_merged)[<span class="fu">grepl</span>(<span class="st">&quot;^ID[0-9]+&quot;</span>, <span class="fu">colnames</span>(df_merged))]</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>enrich_result_id <span class="ot">&lt;-</span> <span class="fu">group_enrichment</span>(</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  df_merged,</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">grp_vars =</span> <span class="st">&quot;cluster&quot;</span>,</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">enrich_vars =</span> nm_id,</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">co_method =</span> <span class="st">&quot;wilcox.test&quot;</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>enrich_result_id<span class="sc">$</span>enrich_var <span class="ot">&lt;-</span> <span class="fu">factor</span>(enrich_result_id<span class="sc">$</span>enrich_var, nm_id)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_group_enrichment</span>(</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  enrich_result_id,</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill_by_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cut_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_list =</span> T</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">$</span>cluster <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-106-1.png" width="1950" style="display: block; margin: auto;" /></p>
</div>
<div id="combined-cosmic-signature-result" class="section level4">
<h4>Combined COSMIC signature result</h4>
<p>Merge all COSMIC signature results.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>enrich_result_cosmic <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">reduce</span>(</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(enrich_result_sbs, enrich_result_dbs, enrich_result_id),</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  rbind</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<blockquote>
<p>移除带 NA 和 Inf 的 signatures 结果，然后绘制一个汇总图，对 signatures 进行聚类，以确定 signature 排序。</p>
</blockquote>
</div>
<div id="word-cloud-plot-for-cosmic-signature-etiologies" class="section level4">
<h4>Word cloud plot for COSMIC signature etiologies</h4>
<p>There are so many COSMIC signatures above, it is not easy to summarize the data. Considering all COSMIC signatures are labeled and many of them have been assigned to a specific etiology, here we try to use word cloud plot to summarize the result above.</p>
<p>Load etiologies of COSMIC signatures.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>cosmic_ets <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">reduce</span>(</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>    sigminer<span class="sc">::</span><span class="fu">get_sig_db</span>(<span class="st">&quot;SBS&quot;</span>)<span class="sc">$</span>aetiology <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;sig_name&quot;</span>),</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>    sigminer<span class="sc">::</span><span class="fu">get_sig_db</span>(<span class="st">&quot;DBS&quot;</span>)<span class="sc">$</span>aetiology <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;sig_name&quot;</span>),</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>    sigminer<span class="sc">::</span><span class="fu">get_sig_db</span>(<span class="st">&quot;ID&quot;</span>)<span class="sc">$</span>aetiology <span class="sc">%&gt;%</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;sig_name&quot;</span>)</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>  rbind</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(cosmic_ets)</span></code></pre></div>
<div id="htmlwidget-18f151ff8c7d6fa42bf4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-18f151ff8c7d6fa42bf4">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101"],["SBS1","SBS2","SBS3","SBS4","SBS5","SBS6","SBS7a","SBS7b","SBS7c","SBS7d","SBS8","SBS9","SBS10a","SBS10b","SBS11","SBS12","SBS13","SBS14","SBS15","SBS16","SBS17a","SBS17b","SBS18","SBS19","SBS20","SBS21","SBS22","SBS23","SBS24","SBS25","SBS26","SBS27","SBS28","SBS29","SBS30","SBS31","SBS32","SBS33","SBS34","SBS35","SBS36","SBS37","SBS38","SBS39","SBS40","SBS41","SBS42","SBS43","SBS44","SBS45","SBS46","SBS47","SBS48","SBS49","SBS50","SBS51","SBS52","SBS53","SBS54","SBS55","SBS56","SBS57","SBS58","SBS59","SBS60","SBS84","SBS85","SBS86","SBS87","SBS88","SBS89","SBS90","DBS1","DBS2","DBS3","DBS4","DBS5","DBS6","DBS7","DBS8","DBS9","DBS10","DBS11","ID1","ID2","ID3","ID4","ID5","ID6","ID7","ID8","ID9","ID10","ID11","ID12","ID13","ID14","ID15","ID16","ID17","ID18"],["Spontaneous deamination of 5-methylcytosine (clock-like signature)","Activity of APOBEC family of cytidine deaminases","Defective homologous recombination DNA damage repair","Tobacco smoking","Unknown (clock-like signature)","Defective DNA mismatch repair","Ultraviolet light exposure","Ultraviolet light exposure","Ultraviolet light exposure","Ultraviolet light exposure","Unknown","Polimerase eta somatic hypermutation activity","Polymerase epsilon exonuclease domain mutations","Polymerase epsilon exonuclease domain mutations","Temozolomide treatment","Unknown","Activity of APOBEC family of cytidine deaminases","Concurrent polymerase epsilon mutation and defective DNA mismatch repair","Defective DNA mismatch repair","Unknown","Unknown","Unknown","Damage by reactive oxygen species","Unknown","Concurrent POLD1 mutations and defective DNA mismatch repair","Defective DNA mismatch repair","Aristolochic acid exposure","Unknown","Aflatoxin exposure","Chemotherapy treatment","Defective DNA mismatch repair","Possible sequencing artefact","Unknown","Tobacco chewing","Defective DNA base excision repair due to NTHL1 mutations","Platinum chemotherapy treatment","Azathioprine treatment","Unknown","Unknown","Platinum chemotherapy treatment","Defective DNA base excision repair due to MUTYH mutations","Unknown","Indirect effect of ultraviolet light","Unknown","Unknown","Unknown","Haloalkane exposure","Possible sequencing artefact","Defective DNA mismatch repair","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Possible sequencing artefact","Activity of activation-induced cytidine deaminase (AID)","Indirect effects of activation-induced cytidine deaminase (AID)","Unknown chemotherapy treatment","Thiopurine chemotherapy treatment","Colibactin exposure (E.coli bacteria carrying pks pathogenicity island)","Unknown","Duocarmycin exposure","Ultraviolet light exposure","Tobacco smoking and other mutagens","Polymerase epsilon exonuclease domain mutations","Unknown","Platinum chemotherapy treatment","Unknown","Defective DNA mismatch repair","Unknown","Unknown","Defective DNA mismatch repair","Unknown (possibly related to APOBEC mutagenesis)","Slippage during DNA replication of the replicated DNA strand","Slippage during DNA replication of the template DNA strand","Tobacco smoking","Unknown","Unknown","Defective homologous recombination DNA damage repair","Defective DNA mismatch repair","Repair of DNA double strand breaks by NHEJ mechanisms or mutations in topoisomerase TOP2A","Unknown","Unknown","Unknown","Unknown","Ultraviolet light exposure","Unknown","Unknown","Unknown","Mutations in topoisomerase TOP2A","Colibactin exposure (E.coli bacteria carrying pks pathogenicity island)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>sig_name<\/th>\n      <th>aetiology<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
<p>Generate a <code>data.frame</code> for plotting. We only keep significantly and positively enriched signatures in each subgroup. We note that descriptions for many signatures are too long, thus we use short names.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>df_ets <span class="ot">&lt;-</span> enrich_result_cosmic <span class="sc">%&gt;%</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> measure_observed <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(grp1, enrich_var) <span class="sc">%&gt;%</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(cosmic_ets, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;enrich_var&quot;</span> <span class="ot">=</span> <span class="st">&quot;sig_name&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">aetiology =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;APOBEC&quot;</span>, aetiology) <span class="sc">~</span> <span class="st">&quot;APOBEC&quot;</span>,</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;Tobacco&quot;</span>, aetiology) <span class="sc">~</span> <span class="st">&quot;Tobacco&quot;</span>,</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;clock&quot;</span>, aetiology) <span class="sc">~</span> <span class="st">&quot;Clock&quot;</span>,</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;Ultraviolet&quot;</span>, aetiology, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">&quot;UV&quot;</span>,</span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;homologous recombination&quot;</span>, aetiology) <span class="sc">~</span> <span class="st">&quot;HRD&quot;</span>,</span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;mismatch repair&quot;</span>, aetiology) <span class="sc">~</span> <span class="st">&quot;dMMR&quot;</span>,</span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;Slippage&quot;</span>, aetiology) <span class="sc">~</span> <span class="st">&quot;Slippage&quot;</span>,</span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;base excision repair&quot;</span>, aetiology) <span class="sc">~</span> <span class="st">&quot;dBER&quot;</span>,</span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;NHEJ&quot;</span>, aetiology) <span class="sc">~</span> <span class="st">&quot;NHEJ repair&quot;</span>,</span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;reactive oxygen&quot;</span>, aetiology) <span class="sc">~</span> <span class="st">&quot;ROS&quot;</span>,</span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;Polymerase epsilon exonuclease&quot;</span>, aetiology) <span class="sc">~</span> <span class="st">&quot;Polymerase epsilon mutation&quot;</span>,</span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">&quot;eta somatic hypermutation&quot;</span>, aetiology) <span class="sc">~</span> <span class="st">&quot;Polimerase eta hypermutation&quot;</span>,</span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> aetiology</span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(grp1, aetiology) <span class="sc">%&gt;%</span></span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>aetiology <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Unknown&quot;</span>, <span class="st">&quot;Possible sequencing artefact&quot;</span>))</span></code></pre></div>
<p>Plotting.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggwordcloud)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_ets, <span class="fu">aes</span>(<span class="at">label =</span> aetiology, <span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_wordcloud_area</span>(<span class="at">eccentricity =</span> .<span class="dv">35</span>, <span class="at">shape =</span> <span class="st">&quot;square&quot;</span>) <span class="sc">+</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_area</span>(<span class="at">max_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>grp1) <span class="sc">+</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-111-1.png" width="3000" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="other-integrated-variables" class="section level3">
<h3>Other integrated variables</h3>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>df_others <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_tidy_anno_df.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;sample&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>    cluster_df[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;cluster&quot;</span>)),</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Tumor_Stage =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>      Tumor_Stage <span class="sc">==</span> <span class="st">&quot;I&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>      Tumor_Stage <span class="sc">==</span> <span class="st">&quot;II&quot;</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>      Tumor_Stage <span class="sc">==</span> <span class="st">&quot;III&quot;</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>      Tumor_Stage <span class="sc">==</span> <span class="st">&quot;IV&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">isFemale =</span> Sex <span class="sc">==</span> <span class="st">&quot;female&quot;</span>,</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">isWGD =</span> WGD_Status <span class="sc">==</span> <span class="st">&quot;wgd&quot;</span>,</span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">isHRD =</span> HRD_Status <span class="sc">==</span> <span class="st">&quot;hrd&quot;</span>,</span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster =</span> <span class="fu">paste0</span>(<span class="st">&quot;subgroup&quot;</span>, cluster)</span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Sex, WGD_Status, HRD_Status))</span></code></pre></div>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>nm_others <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">colnames</span>(df_others), <span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;cluster&quot;</span>))</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>enrich_result_others <span class="ot">&lt;-</span> <span class="fu">group_enrichment</span>(</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  df_others,</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">grp_vars =</span> <span class="st">&quot;cluster&quot;</span>,</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">enrich_vars =</span> nm_others,</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">co_method =</span> <span class="st">&quot;wilcox.test&quot;</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>enrich_result_others<span class="sc">$</span>enrich_var <span class="ot">&lt;-</span> <span class="fu">factor</span>(enrich_result_others<span class="sc">$</span>enrich_var, nm_others)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_group_enrichment</span>(</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  enrich_result_others,</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill_by_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cut_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_list =</span> T</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">$</span>cluster <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-114-1.png" width="1950" style="display: block; margin: auto;" /></p>
<blockquote>
<p>The <code>HR</code> here represents <code>Heavily rearrangement</code>, don’t mix it with <code>HRD</code> which means <code>Defective homologous recombination DNA damage repair</code>.</p>
</blockquote>
</div>
<div id="driver-genes" class="section level3">
<h3>Driver genes</h3>
<p>We have already observed that there are different mutational processes across different groups. Here we try to go further study if different driver genes activate in different groups.</p>
<p>We obtained coding driver mutations from <a href="https://xena.hiplot.com.cn/datapages/?dataset=pcawg_whitelist_coding_drivers_v1_sep302016.sp.xena&amp;host=https%3A%2F%2Fxena-pcawg.hiplot.com.cn">UCSC Xena database</a>. For known driver genes, we focus on driver gene list obtained from <span class="citation"><a href="#ref-martinez-jimenezCompendiumMutationalCancer2020" role="doc-biblioref">Martínez-Jiménez et al.</a> (<a href="#ref-martinez-jimenezCompendiumMutationalCancer2020" role="doc-biblioref">2020</a>)</span>.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;../data/pcawg_driver_info.RData&quot;</span>)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>df_mut <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(df_others[, <span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;cluster&quot;</span>)],</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  pcawg_driver_number,</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_mut)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Driver_variants&quot;</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>df_mut<span class="sc">$</span>Driver_variants <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(df_mut<span class="sc">$</span>Driver_variants), <span class="dv">0</span>, df_mut<span class="sc">$</span>Driver_variants)</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>driver_gene_num <span class="ot">&lt;-</span> pcawg_driver_gene <span class="sc">%&gt;%</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(sample, ROLE) <span class="sc">%&gt;%</span></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">driver_genes =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;ROLE&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;driver_genes&quot;</span>, <span class="at">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>df_mut <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(df_mut, driver_gene_num, <span class="at">by =</span> <span class="st">&quot;sample&quot;</span>)</span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_mut)[<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Act_genes&quot;</span>, <span class="st">&quot;LoF_genes&quot;</span>)</span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>df_mut<span class="sc">$</span>Act_genes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(df_mut<span class="sc">$</span>Act_genes), <span class="dv">0</span>, df_mut<span class="sc">$</span>Act_genes)</span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a>df_mut<span class="sc">$</span>LoF_genes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(df_mut<span class="sc">$</span>LoF_genes), <span class="dv">0</span>, df_mut<span class="sc">$</span>LoF_genes)</span></code></pre></div>
<p>Also merge into info of each driver gene.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>df_mut2 <span class="ot">&lt;-</span> df_mut <span class="sc">%&gt;%</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>    pcawg_driver_gene <span class="sc">%&gt;%</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;gene&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;ROLE&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="sc">-</span>sample), <span class="sc">~</span> <span class="sc">!</span><span class="fu">is.na</span>(.)),</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Filter out driver genes with &lt; 10 mutation</span></span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>gene_sum <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">colSums</span>(df_mut2[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)], <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 基因按突变数量排序</span></span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a>df_mut2 <span class="ot">&lt;-</span> df_mut2 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select_at</span>(<span class="fu">c</span>(<span class="fu">colnames</span>(df_mut2)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="fu">names</span>(gene_sum[gene_sum <span class="sc">&gt;=</span> <span class="dv">10</span>])))</span></code></pre></div>
<p>Save the data.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(df_mut2, <span class="at">file =</span> <span class="st">&quot;../data/pcawg_mut_df.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>nm_mut <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">colnames</span>(df_mut2), <span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;cluster&quot;</span>))</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>enrich_result_mut <span class="ot">&lt;-</span> <span class="fu">group_enrichment</span>(</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  df_mut2,</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">grp_vars =</span> <span class="st">&quot;cluster&quot;</span>,</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">enrich_vars =</span> nm_mut,</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">co_method =</span> <span class="st">&quot;wilcox.test&quot;</span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Filter out genes insignificant in all subgroups.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>keep_df <span class="ot">&lt;-</span> enrich_result_mut[, .(<span class="at">count =</span> <span class="fu">sum</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>)), by <span class="ot">=</span> enrich_var]</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>drop_vars <span class="ot">&lt;-</span> keep_df[count <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>enrich_var</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>enrich_result_mut2 <span class="ot">&lt;-</span> enrich_result_mut[<span class="sc">!</span>enrich_var <span class="sc">%in%</span> drop_vars]</span></code></pre></div>
<p>Plotting.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>enrich_result_mut2<span class="sc">$</span>enrich_var <span class="ot">&lt;-</span> <span class="fu">factor</span>(enrich_result_mut2<span class="sc">$</span>enrich_var, <span class="fu">setdiff</span>(nm_mut, drop_vars))</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>keep_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(nm_mut, drop_vars)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)]</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(nm_mut[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="fu">paste0</span>(keep_vars, <span class="st">&quot; (&quot;</span>, gene_sum[keep_vars], <span class="st">&quot;)&quot;</span>))</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_group_enrichment</span>(</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>  enrich_result_mut2,</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill_by_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">cut_p_value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_list =</span> T</span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">$</span>cluster <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> labels)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-121-1.png" width="1950" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
</div>
</div>
</div>
<div id="part-5-inference-of-copy-number-signature-etiologies" class="section level1">
<h1>PART 5: Inference of copy number signature etiologies</h1>
<p>In this part, we would like to explore CN signatures in more details with association analysis and summarize what we get to infer their etiologies.</p>
<p>Let’s merge load all data we got and combine them.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>tidy_info <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_sample_tidy_info.rds&quot;</span>)</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>tidy_anno <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_tidy_anno_df.rds&quot;</span>)</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>tidy_mut <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_mut_df.rds&quot;</span>)</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>pcawg_sbs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../data/PCAWG/PCAWG_sigProfiler_SBS_signatures_in_samples.csv&quot;</span>)</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>pcawg_dbs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../data/PCAWG/PCAWG_sigProfiler_DBS_signatures_in_samples.csv&quot;</span>)</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>pcawg_id <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;../data/PCAWG/PCAWG_SigProfiler_ID_signatures_in_samples.csv&quot;</span>)</span></code></pre></div>
<p>Merge data.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>df_merged <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">reduce</span>(</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>    tidy_info <span class="sc">%&gt;%</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(keep) <span class="sc">%&gt;%</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(sample, <span class="fu">starts_with</span>(<span class="st">&quot;Abs&quot;</span>), <span class="fu">starts_with</span>(<span class="st">&quot;Rel&quot;</span>)),</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>    tidy_anno <span class="sc">%&gt;%</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>      tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;sample&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">Tumor_Stage =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>          Tumor_Stage <span class="sc">==</span> <span class="st">&quot;I&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>          Tumor_Stage <span class="sc">==</span> <span class="st">&quot;II&quot;</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>          Tumor_Stage <span class="sc">==</span> <span class="st">&quot;III&quot;</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>          Tumor_Stage <span class="sc">==</span> <span class="st">&quot;IV&quot;</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">isFemale =</span> Sex <span class="sc">==</span> <span class="st">&quot;female&quot;</span>,</span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">isWGD =</span> WGD_Status <span class="sc">==</span> <span class="st">&quot;wgd&quot;</span>,</span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">isHRD =</span> HRD_Status <span class="sc">==</span> <span class="st">&quot;hrd&quot;</span></span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Sex, WGD_Status, HRD_Status)),</span>
<span id="cb152-20"><a href="#cb152-20" aria-hidden="true" tabindex="-1"></a>    pcawg_sbs[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">sample =</span> <span class="st">`</span><span class="at">Sample Names</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb152-21"><a href="#cb152-21" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Drop Possible sequencing artefact associated signatures</span></span>
<span id="cb152-22"><a href="#cb152-22" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>SBS43, <span class="sc">-</span><span class="fu">c</span>(SBS45<span class="sc">:</span>SBS60)),</span>
<span id="cb152-23"><a href="#cb152-23" aria-hidden="true" tabindex="-1"></a>    pcawg_dbs[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">sample =</span> <span class="st">`</span><span class="at">Sample Names</span><span class="st">`</span>),</span>
<span id="cb152-24"><a href="#cb152-24" aria-hidden="true" tabindex="-1"></a>    pcawg_id[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">sample =</span> <span class="st">`</span><span class="at">Sample Names</span><span class="st">`</span>),</span>
<span id="cb152-25"><a href="#cb152-25" aria-hidden="true" tabindex="-1"></a>    tidy_mut <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>cluster)</span>
<span id="cb152-26"><a href="#cb152-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb152-27"><a href="#cb152-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span>left_join,</span>
<span id="cb152-28"><a href="#cb152-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb152-29"><a href="#cb152-29" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb152-30"><a href="#cb152-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_if</span>(</span>
<span id="cb152-31"><a href="#cb152-31" aria-hidden="true" tabindex="-1"></a>    is.logical,</span>
<span id="cb152-32"><a href="#cb152-32" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="cn">FALSE</span>, .)</span>
<span id="cb152-33"><a href="#cb152-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb152-34"><a href="#cb152-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-35"><a href="#cb152-35" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_merged) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;Abs_&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="fu">colnames</span>(df_merged))</span>
<span id="cb152-36"><a href="#cb152-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-37"><a href="#cb152-37" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(df_merged, <span class="at">file =</span> <span class="st">&quot;../data/pcawg_merged_df.rds&quot;</span>)</span></code></pre></div>
<div id="association-analysis-for-copy-number-signatures" class="section level2">
<h2>Association analysis for copy number signatures</h2>
<div id="copy-number-signature-activity-self-association" class="section level3">
<h3>Copy number signature activity self-association</h3>
<p>For absolute signature activity.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_cor</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(df_merged, <span class="fu">starts_with</span>(<span class="st">&quot;CNS&quot;</span>)))</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-128-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>For relative signature activity.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_cor</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(df_merged, <span class="fu">starts_with</span>(<span class="st">&quot;Rel_CNS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_all</span>(<span class="sc">~</span> <span class="fu">sub</span>(<span class="st">&quot;Rel_&quot;</span>, <span class="st">&quot;&quot;</span>, .)))</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-129-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>We can find that most the signatures are correlated. Therefore, it will add difficulty in understanding etiologies by association analysis.</p>
<div id="visualize-with-partial-correlation-network" class="section level4">
<h4>Visualize with partial correlation network</h4>
<p>For absolute signature activity.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(see)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(correlation)</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(df_merged, <span class="fu">starts_with</span>(<span class="st">&quot;CNS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlation</span>(<span class="at">partial =</span> <span class="cn">TRUE</span>, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">r =</span> rho)</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cc)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-130-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>The relative activity cannot use partial correlation.</p>
</div>
<div id="visualize-with-full-correlation-network" class="section level4">
<h4>Visualize with full correlation network</h4>
<p>Absolute:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(df_merged, <span class="fu">starts_with</span>(<span class="st">&quot;CNS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlation</span>(<span class="at">partial =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">r =</span> rho)</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cc)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-131-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>Relative:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(df_merged, <span class="fu">starts_with</span>(<span class="st">&quot;Rel_CNS&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_all</span>(<span class="sc">~</span> <span class="fu">sub</span>(<span class="st">&quot;Rel_&quot;</span>, <span class="st">&quot;&quot;</span>, .)) <span class="sc">%&gt;%</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlation</span>(<span class="at">partial =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">r =</span> rho)</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cc)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-132-1.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="copy-number-signatures-and-cosmic-signatures" class="section level3">
<h3>Copy number signatures and COSMIC signatures</h3>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>p_cosmic <span class="ot">&lt;-</span> <span class="fu">show_cor</span>(</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_merged,</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_vars =</span> <span class="fu">colnames</span>(df_merged)[<span class="fu">grepl</span>(<span class="st">&quot;^CNS&quot;</span>, <span class="fu">colnames</span>(df_merged))],</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_vars =</span> <span class="fu">colnames</span>(df_merged)[<span class="fu">grepl</span>(<span class="st">&quot;^SBS|^DBS|^ID[0-9]+&quot;</span>, <span class="fu">colnames</span>(df_merged))],</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">hc_order =</span> <span class="cn">FALSE</span>,</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">test =</span> <span class="cn">FALSE</span>,</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lab_size =</span> <span class="dv">2</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>p_cosmic</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-133-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>Just show specified signatures:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>p_cosmic2 <span class="ot">&lt;-</span> <span class="fu">show_cor</span>(</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_merged,</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_vars =</span> <span class="fu">colnames</span>(df_merged)[<span class="fu">grepl</span>(<span class="st">&quot;^CNS&quot;</span>, <span class="fu">colnames</span>(df_merged))],</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_vars =</span> <span class="fu">c</span>(</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;SBS1&quot;</span>, <span class="st">&quot;SBS2&quot;</span>, <span class="st">&quot;SBS3&quot;</span>, <span class="st">&quot;SBS5&quot;</span>, <span class="st">&quot;SBS13&quot;</span>, <span class="st">&quot;SBS17a&quot;</span>, <span class="st">&quot;SBS17b&quot;</span>,</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;SBS18&quot;</span>, <span class="st">&quot;DBS2&quot;</span>, <span class="st">&quot;DBS4&quot;</span>, <span class="st">&quot;DBS6&quot;</span>, <span class="st">&quot;ID1&quot;</span>, <span class="st">&quot;ID2&quot;</span>, <span class="st">&quot;ID6&quot;</span>, <span class="st">&quot;ID8&quot;</span>,</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ID12&quot;</span>, <span class="st">&quot;ID14&quot;</span></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">hc_order =</span> <span class="cn">FALSE</span>,</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">test =</span> <span class="cn">FALSE</span>,</span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">lab_size =</span> <span class="dv">2</span></span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>p_cosmic2</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-134-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>Visualize signature with similar trends with network.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>siglist <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;SBS1&quot;</span>, <span class="st">&quot;SBS5&quot;</span>),</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;SBS2&quot;</span>, <span class="st">&quot;SBS13&quot;</span>),</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;SBS3&quot;</span>, <span class="st">&quot;ID6&quot;</span>),</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;SBS18&quot;</span>),</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;DBS2&quot;</span>),</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;ID1&quot;</span>, <span class="st">&quot;ID2&quot;</span>),</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;ID8&quot;</span>),</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;SBS17a&quot;</span>, <span class="st">&quot;SBS17b&quot;</span>),</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;DBS4&quot;</span>),</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;DBS6&quot;</span>),</span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;ID12&quot;</span>),</span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;ID14&quot;</span>)</span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> siglist) {</span>
<span id="cb160-17"><a href="#cb160-17" aria-hidden="true" tabindex="-1"></a>  cc <span class="ot">&lt;-</span> <span class="fu">correlation</span>(</span>
<span id="cb160-18"><a href="#cb160-18" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(df_merged, <span class="fu">starts_with</span>(<span class="st">&quot;CNS&quot;</span>)),</span>
<span id="cb160-19"><a href="#cb160-19" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select_at</span>(df_merged, i),</span>
<span id="cb160-20"><a href="#cb160-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">partial =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span></span>
<span id="cb160-21"><a href="#cb160-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb160-22"><a href="#cb160-22" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">r =</span> rho) <span class="sc">%&gt;%</span></span>
<span id="cb160-23"><a href="#cb160-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>()</span>
<span id="cb160-24"><a href="#cb160-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(cc)</span>
<span id="cb160-25"><a href="#cb160-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-135-1.png" width="2400" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-135-2.png" width="2400" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-135-3.png" width="2400" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-135-4.png" width="2400" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-135-5.png" width="2400" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-135-6.png" width="2400" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-135-7.png" width="2400" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-135-8.png" width="2400" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-135-9.png" width="2400" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-135-10.png" width="2400" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-135-11.png" width="2400" style="display: block; margin: auto;" /><img src="index_files/figure-html/unnamed-chunk-135-12.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
<div id="signature-clustering" class="section level3">
<h3>Signature clustering</h3>
<p>We can take a try to cluster signatures based on their activity association.</p>
<p>First get the correlation data.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>p_all <span class="ot">&lt;-</span> <span class="fu">show_cor</span>(</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_merged,</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_vars =</span> <span class="fu">colnames</span>(df_merged)[<span class="fu">grepl</span>(<span class="st">&quot;^CNS|^SBS|^DBS|^ID[0-9]+&quot;</span>, <span class="fu">colnames</span>(df_merged))],</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_vars =</span> <span class="fu">colnames</span>(df_merged)[<span class="fu">grepl</span>(<span class="st">&quot;^CNS|^SBS|^DBS|^ID[0-9]+&quot;</span>, <span class="fu">colnames</span>(df_merged))],</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">hc_order =</span> <span class="cn">FALSE</span>,</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">test =</span> <span class="cn">FALSE</span>,</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">lab_size =</span> <span class="dv">3</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Get the correlation matrix and convert it into distance matrix.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>p_all_cor <span class="ot">&lt;-</span> p_all<span class="sc">$</span>cor<span class="sc">$</span>cor_mat</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>all_dist <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> p_all_cor</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the NA value to 2</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>all_dist[<span class="fu">is.na</span>(all_dist)] <span class="ot">&lt;-</span> <span class="dv">2</span></span></code></pre></div>
<div id="only-include-copy-number-signatures" class="section level4">
<h4>Only include copy number signatures</h4>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>dist_cn <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(all_dist[<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>])</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>hc_cn <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_cn)</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_cn)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-138-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>Roughly there is 3 clusters.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(hc_cn, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">rect =</span> T)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-139-1.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
<div id="all-signatures" class="section level4">
<h4>All signatures</h4>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>dist_all <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(all_dist)</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>hc_all <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_all)</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_all)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-140-1.png" width="3600" style="display: block; margin: auto;" /> Here we manually set 10 clusters for better visualization.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  hc_all,</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">10</span>,</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">rect =</span> F,</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;circular&quot;</span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_blank</span>()</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-141-1.png" width="2400" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># theme(</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   panel.background = element_rect(fill = &quot;transparent&quot;, colour = NA),</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot.background = element_rect(fill = &quot;transparent&quot;, colour = NA),</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   panel.grid = element_blank(),</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   panel.border = element_blank(),</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot.margin = unit(c(0, 0, 0, 0), &quot;null&quot;),</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   panel.margin = unit(c(0, 0, 0, 0), &quot;null&quot;),</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   axis.ticks = element_blank(),</span></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   axis.text = element_blank(),</span></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   axis.title = element_blank(),</span></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   axis.line = element_blank(),</span></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   legend.position = &quot;none&quot;,</span></span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   axis.ticks.length = unit(0, &quot;null&quot;),</span></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   axis.ticks.margin = unit(0, &quot;null&quot;),</span></span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   legend.margin = unit(0, &quot;null&quot;)</span></span>
<span id="cb167-16"><a href="#cb167-16" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code></pre></div>
</div>
</div>
<div id="association-between-cns-and-genotypephenotype-features" class="section level3">
<h3>Association between CNS and genotype/phenotype features</h3>
<div id="association-between-cns-and-continuous-variables" class="section level4">
<h4>Association between CNS and continuous variables</h4>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>p_cn_others <span class="ot">&lt;-</span> <span class="fu">show_cor</span>(</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_merged,</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_vars =</span> <span class="fu">colnames</span>(df_merged)[<span class="dv">2</span><span class="sc">:</span><span class="dv">15</span>],</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_vars =</span> <span class="fu">colnames</span>(df_merged)[<span class="fu">c</span>(<span class="dv">30</span><span class="sc">:</span><span class="dv">44</span>, <span class="dv">125</span><span class="sc">:</span><span class="dv">127</span>)],</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lab_size =</span> <span class="dv">3</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>p_cn_others</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-142-1.png" width="2700" style="display: block; margin: auto;" /></p>
<p>Visualize it with correlation network one by one.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df_merged)[<span class="fu">c</span>(<span class="dv">30</span><span class="sc">:</span><span class="dv">44</span>, <span class="dv">125</span><span class="sc">:</span><span class="dv">127</span>)]</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>df_mut <span class="ot">&lt;-</span> df_merged[, var_names] <span class="sc">%&gt;%</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Telomere_Content =</span> <span class="st">`</span><span class="at">Telomere_Content(log2)</span><span class="st">`</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df_mut)</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a><span class="co"># dir.create(&quot;../output/cor_network&quot;)</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> var_names) {</span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pdf(file.path(&quot;../output/cor_network&quot;, paste0(i, &quot;.pdf&quot;)), width = 6, height = 5)</span></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlation</span>(</span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>    df_mut[, i, <span class="at">drop =</span> <span class="cn">FALSE</span>],</span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>    df_merged[, <span class="fu">colnames</span>(df_merged)[<span class="dv">2</span><span class="sc">:</span><span class="dv">15</span>]],</span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">partial =</span> <span class="cn">FALSE</span>, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span></span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">r =</span> rho) <span class="sc">%&gt;%</span></span>
<span id="cb169-19"><a href="#cb169-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>() <span class="ot">-&gt;</span> p</span>
<span id="cb169-20"><a href="#cb169-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb169-21"><a href="#cb169-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dev.off()</span></span>
<span id="cb169-22"><a href="#cb169-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>[1] &quot;Age&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-1.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;AMPs&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-2.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;DELs&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-3.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;Affected_Chrs&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-4.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;CNA_Burden&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-5.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;Purity&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-6.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;Ploidy&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-7.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;LOHs&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-8.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;Fusions&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-9.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;Chromothripsis&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-10.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;BFBs&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-11.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;ecDNAs&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-12.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;HRs&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-13.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;Linear_Amplicons&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-14.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;Telomere_Content&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-15.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;Driver_variants&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-16.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;Act_genes&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-17.png" width="1800" style="display: block; margin: auto;" /></p>
<pre><code>[1] &quot;LoF_genes&quot;</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-143-18.png" width="1800" style="display: block; margin: auto;" /></p>
</div>
<div id="association-between-cns-and-discrete-variables" class="section level4">
<h4>Association between CNS and discrete variables</h4>
<p>Here we directly compare the CNS activity between different discrete variable groups.</p>
<p>Here 3 variables including <code>WGD_Status</code>, <code>HRD_Status</code> and <code>Tumor_Stage</code> are included.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>df_ds2 <span class="ot">&lt;-</span> tidy_info <span class="sc">%&gt;%</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(keep) <span class="sc">%&gt;%</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample, <span class="fu">starts_with</span>(<span class="st">&quot;Abs&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span> <span class="fu">log2</span>(. <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>    tidy_anno <span class="sc">%&gt;%</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>      tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;sample&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(sample, WGD_Status, HRD_Status, Tumor_Stage),</span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Tumor_Stage =</span> <span class="fu">ifelse</span>(Tumor_Stage <span class="sc">==</span> <span class="st">&quot;Unknown&quot;</span>, <span class="cn">NA</span>, Tumor_Stage))</span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a>df_ds <span class="ot">&lt;-</span> df_ds2 <span class="sc">%&gt;%</span></span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">&quot;CNS&quot;</span>),</span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;sig_name&quot;</span>,</span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;activity&quot;</span></span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code></pre></div>
<p>For WGD.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggboxplot</span>(</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>  df_ds,</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;sig_name&quot;</span>, <span class="at">y =</span> <span class="st">&quot;activity&quot;</span>,</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;WGD_Status&quot;</span>,</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">&quot;jco&quot;</span>, <span class="at">width =</span> .<span class="dv">3</span>,</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="cn">FALSE</span>, <span class="at">ylab =</span> <span class="st">&quot;log2(Activity)&quot;</span>,</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outlier.size =</span> <span class="fl">0.05</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">group =</span> WGD_Status), <span class="at">label =</span> <span class="st">&quot;p.signif&quot;</span>) <span class="sc">+</span></span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rotate_x_text</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-147-1.png" width="2400" style="display: block; margin: auto;" /> CNS3 and CNS9 are highly associated with WGD.</p>
<p>For HRD.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggboxplot</span>(</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>  df_ds <span class="sc">%&gt;%</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">HRD_Status =</span> <span class="fu">factor</span>(HRD_Status, <span class="fu">c</span>(<span class="st">&quot;no_hrd&quot;</span>, <span class="st">&quot;hrd&quot;</span>))),</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;sig_name&quot;</span>, <span class="at">y =</span> <span class="st">&quot;activity&quot;</span>,</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;HRD_Status&quot;</span>,</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">&quot;jco&quot;</span>, <span class="at">width =</span> .<span class="dv">3</span>,</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="cn">FALSE</span>, <span class="at">ylab =</span> <span class="st">&quot;log2(Activity)&quot;</span>,</span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">outlier.size =</span> <span class="fl">0.05</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">group =</span> HRD_Status), <span class="at">label =</span> <span class="st">&quot;p.signif&quot;</span>) <span class="sc">+</span></span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rotate_x_text</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-148-1.png" width="2400" style="display: block; margin: auto;" /> CNS14 is highly associated with HRD status.</p>
<p>See supplementary analysis for HRD and WGD prediction analysis.</p>
<p>For tumor stage.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggboxplot</span>(</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  df_ds <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Tumor_Stage)),</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;sig_name&quot;</span>, <span class="at">y =</span> <span class="st">&quot;activity&quot;</span>,</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;Tumor_Stage&quot;</span>,</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">&quot;jco&quot;</span>, <span class="at">width =</span> .<span class="dv">3</span>,</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="cn">FALSE</span>, <span class="at">ylab =</span> <span class="st">&quot;log2(Activity)&quot;</span>,</span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outlier.size =</span> <span class="fl">0.05</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="fu">aes</span>(<span class="at">group =</span> Tumor_Stage),</span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">&quot;p.signif&quot;</span>,</span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;anova&quot;</span></span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rotate_x_text</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-149-1.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
<div id="association-between-cns-and-driver-gene-mutation" class="section level4">
<h4>Association between CNS and driver gene mutation</h4>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>asso_res <span class="ot">&lt;-</span> <span class="fu">get_sig_feature_association</span>(</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>  df_merged,</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols_to_sigs =</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>),</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols_to_features =</span> <span class="fu">colnames</span>(df_merged)[<span class="dv">128</span><span class="sc">:</span><span class="dv">291</span>],</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method_ca =</span> wilcox.test,</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_n =</span> <span class="dv">0</span></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>asso_res_tidy <span class="ot">&lt;-</span> <span class="fu">get_tidy_association</span>(asso_res)</span></code></pre></div>
<p>Plotting.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_sig_feature_corrplot</span>(</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>  asso_res_tidy,</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sig_orders =</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>),</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_val =</span> <span class="fl">0.05</span>,</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks_count =</span> <span class="cn">NA</span>,</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="cn">NULL</span>,</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="cn">NULL</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">rotate_x_text</span>(<span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;Difference</span><span class="sc">\n</span><span class="st">in means of</span><span class="sc">\n</span><span class="st">activity&quot;</span>) <span class="sc">+</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">rotate_x_text</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-151-1.png" width="2700" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="association-between-cns-and-patients-prognosis" class="section level3">
<h3>Association between CNS and patients’ prognosis</h3>
<p>Get tidy data fro survival analysis.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ezcox)</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>cluster_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_clusters.rds&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;sample&quot;</span>)</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>df_surv <span class="ot">&lt;-</span> tidy_info <span class="sc">%&gt;%</span></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(keep) <span class="sc">%&gt;%</span></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a>    sample, cancer_type, donor_survival_time, donor_vital_status,</span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;Abs_&quot;</span>)</span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb195-13"><a href="#cb195-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb195-14"><a href="#cb195-14" aria-hidden="true" tabindex="-1"></a>    cluster_df,</span>
<span id="cb195-15"><a href="#cb195-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb195-16"><a href="#cb195-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb195-17"><a href="#cb195-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb195-18"><a href="#cb195-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb195-19"><a href="#cb195-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> donor_survival_time,</span>
<span id="cb195-20"><a href="#cb195-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> donor_vital_status,</span>
<span id="cb195-21"><a href="#cb195-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster =</span> class</span>
<span id="cb195-22"><a href="#cb195-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb195-23"><a href="#cb195-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb195-24"><a href="#cb195-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">ifelse</span>(status <span class="sc">==</span> <span class="st">&quot;deceased&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb195-25"><a href="#cb195-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb195-26"><a href="#cb195-26" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;Abs_&quot;</span>)), <span class="sc">~</span> <span class="fu">sub</span>(<span class="st">&quot;Abs_&quot;</span>, <span class="st">&quot;&quot;</span>, .)) <span class="sc">%&gt;%</span></span>
<span id="cb195-27"><a href="#cb195-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;CNS&quot;</span>)), <span class="sc">~</span> . <span class="sc">/</span> <span class="dv">10</span>)</span></code></pre></div>
<p>We divide all signature activity by 10 to explore the HR change per 10 records contributed by a signature.</p>
<div id="unicox-analysis-for-cns" class="section level4">
<h4>Unicox analysis for CNS</h4>
<p>Here we focus on the association between each CNS and patients’ overall survival time.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">show_forest</span>(df_surv,</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">covariates =</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>),</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">merge_models =</span> <span class="cn">TRUE</span>, <span class="at">add_caption =</span> <span class="cn">FALSE</span>, <span class="at">point_size =</span> <span class="dv">2</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-153-1.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
<div id="multivariate-cox-analysis-for-cns" class="section level4">
<h4>Multivariate cox analysis for CNS</h4>
<p>We also build a multivariate cox model to explore if all CNSs are included, which is more important?</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">show_forest</span>(df_surv,</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">covariates =</span> <span class="st">&quot;CNS1&quot;</span>, <span class="at">controls =</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">14</span>),</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">merge_models =</span> <span class="cn">TRUE</span>, <span class="at">add_caption =</span> <span class="cn">FALSE</span>, <span class="at">point_size =</span> <span class="dv">2</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>p2</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-154-1.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="signature-similarity-comparison-between-different-types-of-signatures" class="section level2">
<h2>Signature similarity comparison between different types of signatures</h2>
<p>The similarity between signatures is a key parameter, it determines how hard it is to distinguish between signatures and the precision to assign the contribution to a signature. If you have read the paper <span class="citation"><a href="#ref-mauraPracticalGuideMutational2019" role="doc-biblioref">Maura et al.</a> (<a href="#ref-mauraPracticalGuideMutational2019" role="doc-biblioref">2019</a>)</span>, you may know that 2 of 3 main issues proposed by the authors are actually because of high similarity between mutational signatures:</p>
<ul>
<li><strong>the ambiguous signature assignment</strong> that occurs when different combinations of signatures can explain equally well the same mutational catalog.</li>
<li><strong>bleeding of signatures</strong> that signatures present in only part of the set are also erroneously assigned to the entire set.</li>
</ul>
<p>In this section, we explore the similarity of CNSs discovered in this study and known COSMIC signatures.</p>
<p>Load data.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>CNS <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_sigs_CN176_signature.rds&quot;</span>)</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>SBSv2 <span class="ot">&lt;-</span> <span class="fu">get_sig_db</span>()</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>SBS <span class="ot">&lt;-</span> <span class="fu">get_sig_db</span>(<span class="st">&quot;SBS&quot;</span>)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>DBS <span class="ot">&lt;-</span> <span class="fu">get_sig_db</span>(<span class="st">&quot;DBS&quot;</span>)</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>ID <span class="ot">&lt;-</span> <span class="fu">get_sig_db</span>(<span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<p>Get signature similarity in each signature type.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>sim_CNS <span class="ot">&lt;-</span> <span class="fu">get_sig_similarity</span>(CNS, CNS)<span class="sc">$</span>similarity</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>sim_SBSv2 <span class="ot">&lt;-</span> <span class="fu">get_sig_similarity</span>(SBSv2<span class="sc">$</span>db, SBSv2<span class="sc">$</span>db)<span class="sc">$</span>similarity</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>sim_SBS <span class="ot">&lt;-</span> <span class="fu">get_sig_similarity</span>(SBS<span class="sc">$</span>db, SBS<span class="sc">$</span>db)<span class="sc">$</span>similarity</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>sim_DBS <span class="ot">&lt;-</span> <span class="fu">get_sig_similarity</span>(DBS<span class="sc">$</span>db, DBS<span class="sc">$</span>db)<span class="sc">$</span>similarity</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>sim_ID <span class="ot">&lt;-</span> <span class="fu">get_sig_similarity</span>(ID<span class="sc">$</span>db, ID<span class="sc">$</span>db)<span class="sc">$</span>similarity</span></code></pre></div>
<p>Only use upper matrix to get similarity between one signature and non-self signatures.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> sim_CNS[<span class="fu">upper.tri</span>(sim_CNS)]</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> sim_SBSv2[<span class="fu">upper.tri</span>(sim_SBSv2)]</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> sim_SBS[<span class="fu">upper.tri</span>(sim_SBS)]</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> sim_DBS[<span class="fu">upper.tri</span>(sim_DBS)]</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> sim_ID[<span class="fu">upper.tri</span>(sim_ID)]</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>df_sim <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">sig_type =</span> <span class="fu">rep</span>(</span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;CNS&quot;</span>, <span class="st">&quot;SBSv2&quot;</span>, <span class="st">&quot;SBS&quot;</span>, <span class="st">&quot;DBS&quot;</span>, <span class="st">&quot;ID&quot;</span>),</span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="fu">length</span>(a), <span class="fu">length</span>(b), <span class="fu">length</span>(c), <span class="fu">length</span>(d), <span class="fu">length</span>(e))</span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">similarity =</span> <span class="fu">c</span>(a, b, c, d, e)</span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>See header rows:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_sim)</span></code></pre></div>
<pre><code># A tibble: 6 x 2
  sig_type similarity
  &lt;chr&gt;         &lt;dbl&gt;
1 CNS           0.34 
2 CNS           0    
3 CNS           0    
4 CNS           0.112
5 CNS           0.018
6 CNS           0    </code></pre>
<p>Let’s visualize it and use ‘CNS’ as reference group to run statistical test (‘wilcox.test’ method).</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggboxplot</span>(df_sim,</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;sig_type&quot;</span>, <span class="at">y =</span> <span class="st">&quot;similarity&quot;</span>,</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;sig_type&quot;</span>,</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="cn">FALSE</span>,</span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Similarity between signatures&quot;</span>,</span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="st">&quot;jco&quot;</span>,</span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">0.3</span>,</span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">outlier.size =</span> <span class="fl">0.05</span></span>
<span id="cb203-12"><a href="#cb203-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb203-13"><a href="#cb203-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># stat_compare_means(method = &quot;anova&quot;) +</span></span>
<span id="cb203-14"><a href="#cb203-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(</span>
<span id="cb203-15"><a href="#cb203-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">&quot;p.signif&quot;</span>, <span class="at">method =</span> <span class="st">&quot;wilcox.test&quot;</span>,</span>
<span id="cb203-16"><a href="#cb203-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref.group =</span> <span class="st">&quot;CNS&quot;</span></span>
<span id="cb203-17"><a href="#cb203-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-159-1.png" width="1200" style="display: block; margin: auto;" /> We can see that signature type CNS has lowest similarity level and CNS signatures are not likely similar to others. CNS has much lower similarity level than all other signature types except DBS.</p>
</div>
<div id="data-summary-and-inference-of-signature-etiologies" class="section level2">
<h2>Data summary and inference of signature etiologies</h2>
<p>This is a summary section, we utilize all data we got from analyses in this study and infer how should we explore each copy number signature.</p>
<p>We will list all CNSs, and their features, associations and our inferences here.</p>
<blockquote>
<p>TODO</p>
</blockquote>
</div>
</div>
<div id="supplementary-analyses" class="section level1">
<h1>Supplementary Analyses</h1>
<p>In this part, we will add some supplementary analyses.</p>
<div id="cns-validation" class="section level2">
<h2>CNS validation</h2>
<div id="tcga-cns" class="section level3">
<h3>TCGA CNS</h3>
<p>TCGA has ~10, 000 tumors and we can obtain allele specific copy number data from GDC portal, so it is the good resource to validate the CNS discovered in PCAWG.</p>
<p>Call signatures.</p>
<p><code>PBS</code> file content:</p>
<pre><code>#PBS -l walltime=1000:00:00
#PBS -l nodes=1:ppn=12
#PBS -S /bin/bash
#PBS -l mem=100gb
#PBS -j oe
#PBS -M w_shixiang@163.com
#PBS -q pub_fast

# Please set PBS arguments above
cd /public/home/wangshx/wangshx/PCAWG-TCGA
module load apps/R/3.6.1

echo Extracting TCGA signatures...

# Following are commands/scripts you want to run
# If you do not know how to set this, please check README.md file 
Rscript call_tcga.R</code></pre>
<p>R script content:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>tally_X <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;tcga_cn_tally_X.rds&quot;</span>)</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sigprofiler_extract</span>(tally_X<span class="sc">$</span>nmf_matrix, </span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">output =</span> <span class="st">&quot;TCGA_CN176X&quot;</span>, </span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">30</span>, </span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nrun =</span> <span class="dv">100</span>,</span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cores =</span> <span class="dv">36</span>,</span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">init_method =</span> <span class="st">&quot;random&quot;</span>,</span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">is_exome =</span> <span class="cn">FALSE</span>,</span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">use_conda =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Metadata:</p>
<pre><code>THIS FILE CONTAINS THE METADATA ABOUT SYSTEM AND RUNTIME


-------System Info-------
Operating System Name: Linux
Nodename: node34
Release: 3.10.0-693.el7.x86_64
Version: #1 SMP Tue Aug 22 21:09:27 UTC 2017

-------Python and Package Versions------- 
Python Version: 3.8.5
Sigproextractor Version: 1.0.17
SigprofilerPlotting Version: 1.1.8
SigprofilerMatrixGenerator Version: 1.1.20
Pandas version: 1.1.2
Numpy version: 1.19.2
Scipy version: 1.5.2
Scikit-learn version: 0.23.2

--------------EXECUTION PARAMETERS--------------
INPUT DATA
    input_type: matrix
    output: TCGA_CN176X
    input_data: /tmp/RtmphYcBmk/dir852158ab0364/sigprofiler_input.txt
    reference_genome: GRCh37
    context_types: SBS176
    exome: False
NMF REPLICATES
    minimum_signatures: 2
    maximum_signatures: 30
    NMF_replicates: 100
NMF ENGINE
    NMF_init: random
    precision: single
    matrix_normalization: gmm
    resample: True
    seeds: random
    min_NMF_iterations: 10,000
    max_NMF_iterations: 1,000,000
    NMF_test_conv: 10,000
    NMF_tolerance: 1e-15
CLUSTERING
    clustering_distance: cosine
EXECUTION
    cpu: 36; Maximum number of CPU is 36
    gpu: False
Solution Estimation
    stability: 0.8
    min_stability: 0.2
    combined_stability: 1.0
COSMIC MATCH
    opportunity_genome: GRCh37
    nnls_add_penalty: 0.05
    nnls_remove_penalty: 0.01
    initial_remove_penalty: 0.05
    de_novo_fit_penalty: 0.02
    refit_denovo_signatures: False

-------Analysis Progress------- 
[2020-11-29 17:39:12] Analysis started: 

##################################

[2020-11-29 17:39:18] Analysis started for SBS176. Matrix size [176 rows x 10851 columns]

[2020-11-29 17:39:18] Normalization GMM with cutoff value set at 17600

[2020-11-29 19:12:03] SBS176 de novo extraction completed for a total of 2 signatures! 
Execution time:1:32:45

[2020-11-29 23:58:10] SBS176 de novo extraction completed for a total of 3 signatures! 
Execution time:4:46:06

[2020-11-30 08:32:21] SBS176 de novo extraction completed for a total of 4 signatures! 
Execution time:8:34:11

[2020-11-30 19:51:18] SBS176 de novo extraction completed for a total of 5 signatures! 
Execution time:11:18:56

[2020-12-01 07:10:18] SBS176 de novo extraction completed for a total of 6 signatures! 
Execution time:11:18:59

[2020-12-01 21:14:24] SBS176 de novo extraction completed for a total of 7 signatures! 
Execution time:14:04:06

[2020-12-02 15:48:43] SBS176 de novo extraction completed for a total of 8 signatures! 
Execution time:18:34:19

[2020-12-03 12:53:25] SBS176 de novo extraction completed for a total of 9 signatures! 
Execution time:21:04:41

[2020-12-04 11:25:25] SBS176 de novo extraction completed for a total of 10 signatures! 
Execution time:22:31:59

[2020-12-05 10:20:15] SBS176 de novo extraction completed for a total of 11 signatures! 
Execution time:22:54:50

[2020-12-06 11:36:03] SBS176 de novo extraction completed for a total of 12 signatures! 
Execution time:1 day, 1:15:48

[2020-12-07 14:43:31] SBS176 de novo extraction completed for a total of 13 signatures! 
Execution time:1 day, 3:07:28

[2020-12-09 01:15:22] SBS176 de novo extraction completed for a total of 14 signatures! 
Execution time:1 day, 10:31:50

[2020-12-10 08:02:39] SBS176 de novo extraction completed for a total of 15 signatures! 
Execution time:1 day, 6:47:17

[2020-12-11 16:05:31] SBS176 de novo extraction completed for a total of 16 signatures! 
Execution time:1 day, 8:02:51

[2020-12-13 02:19:40] SBS176 de novo extraction completed for a total of 17 signatures! 
Execution time:1 day, 10:14:09

[2020-12-14 14:56:13] SBS176 de novo extraction completed for a total of 18 signatures! 
Execution time:1 day, 12:36:32

[2020-12-16 02:39:41] SBS176 de novo extraction completed for a total of 19 signatures! 
Execution time:1 day, 11:43:27

[2020-12-18 02:54:09] SBS176 de novo extraction completed for a total of 20 signatures! 
Execution time:2 days, 0:14:28

[2020-12-19 20:20:57] SBS176 de novo extraction completed for a total of 21 signatures! 
Execution time:1 day, 17:26:47

[2020-12-21 19:30:07] SBS176 de novo extraction completed for a total of 22 signatures! 
Execution time:1 day, 23:09:10

[2020-12-24 00:44:41] SBS176 de novo extraction completed for a total of 23 signatures! 
Execution time:2 days, 5:14:34

[2020-12-25 19:03:07] SBS176 de novo extraction completed for a total of 24 signatures! 
Execution time:1 day, 18:18:25

[2020-12-27 07:50:06] SBS176 de novo extraction completed for a total of 25 signatures! 
Execution time:1 day, 12:46:58

[2020-12-29 04:40:22] SBS176 de novo extraction completed for a total of 26 signatures! 
Execution time:1 day, 20:50:16

[2020-12-30 12:35:04] SBS176 de novo extraction completed for a total of 27 signatures! 
Execution time:1 day, 7:54:41

[2020-12-31 19:04:04] SBS176 de novo extraction completed for a total of 28 signatures! 
Execution time:1 day, 6:29:00

[2021-01-02 04:50:07] SBS176 de novo extraction completed for a total of 29 signatures! 
Execution time:1 day, 9:46:02

[2021-01-03 14:15:32] SBS176 de novo extraction completed for a total of 30 signatures! 
Execution time:1 day, 9:25:25

[2021-01-03 14:48:21] Analysis ended: 

-------Job Status------- 
Analysis of mutational signatures completed successfully! 
Total execution time: 34 days, 21:09:09 
Results can be found in:  TCGA_CN176X  folder</code></pre>
<p>Next we determine the signature number.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>SP_TCGA <span class="ot">&lt;-</span> <span class="fu">sigprofiler_import</span>(<span class="st">&quot;../SP/TCGA_CN176X/&quot;</span>, <span class="at">order_by_expo =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;all&quot;</span>)</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(SP_TCGA, <span class="at">file =</span> <span class="st">&quot;../data/TCGA/tcga_cn_solutions_sp.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>SP_TCGA <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/TCGA/tcga_cn_solutions_sp.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_sig_number_survey</span>(</span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>  SP_TCGA<span class="sc">$</span>all_stats <span class="sc">%&gt;%</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">s =</span> <span class="st">`</span><span class="at">Stability (Avg Silhouette)</span><span class="st">`</span>,</span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">e =</span> <span class="st">`</span><span class="at">Mean Cosine Distance</span><span class="st">`</span></span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">SignatureNumber =</span> <span class="fu">as.integer</span>(<span class="fu">gsub</span>(<span class="st">&quot;[^0-9]&quot;</span>, <span class="st">&quot;&quot;</span>, SignatureNumber))</span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;SignatureNumber&quot;</span>,</span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">left_y =</span> <span class="st">&quot;s&quot;</span>, <span class="at">right_y =</span> <span class="st">&quot;e&quot;</span>,</span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">left_name =</span> <span class="st">&quot;Stability (Avg Silhouette)&quot;</span>,</span>
<span id="cb209-13"><a href="#cb209-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">right_name =</span> <span class="st">&quot;Mean Cosine Distance&quot;</span>,</span>
<span id="cb209-14"><a href="#cb209-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">highlight =</span> <span class="dv">20</span></span>
<span id="cb209-15"><a href="#cb209-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-162-1.png" width="2700" style="display: block; margin: auto;" /> We pick up 20 signatures for TCGA data due to its relatively high stability and low distance.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>tcga_sigs <span class="ot">&lt;-</span> SP_TCGA<span class="sc">$</span>solution_list<span class="sc">$</span>S20</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(tcga_sigs, <span class="at">file =</span> <span class="st">&quot;../data/TCGA/tcga_cn_sigs_CN176_signature.rds&quot;</span>)</span></code></pre></div>
<p>Let’s go further check the similarities between PCAWG CNS and TCGA CNS.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>pcawg_sigs <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_sigs_CN176_signature.rds&quot;</span>)</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>tcga_sigs <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/TCGA/tcga_cn_sigs_CN176_signature.rds&quot;</span>)</span></code></pre></div>
<p>Run similarity analysis.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">get_sig_similarity</span>(pcawg_sigs, tcga_sigs)</span></code></pre></div>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(sim<span class="sc">$</span>similarity, <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>, <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>, <span class="at">display_numbers =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-166-1.png" width="2400" style="display: block; margin: auto;" /> From the pheatmap, we can see that:</p>
<ul>
<li>Most of PCAWG copy number signatures can be matched to TCGA copy number signatures with <code>&gt;0.8</code> similarity.</li>
<li>CNS4, CNS5, CNS6 and CNS14 from PCAWG has lower similarity to TCGA CNS. This indicates either they are not shared signatures or they have relatively different patterns in this two dataset.</li>
</ul>
<p>It is not surprising to see that TCGA has more copy number signatures than PCAWG due to about 4 times more sample number.</p>
<p>This data remind us it is not easy to get perfect matched copy number signatures between different datasets due to the following reasons:</p>
<ul>
<li>TCGA copy number data are generated from SNP array and PCAWG copy number data are generated from WGS.</li>
<li>They also use different copy number calling softwares. Considering PCAWG data are consensus copy number data from many known calling software, the quality of PCAWG data is much higher than that of TCGA data.</li>
</ul>
<p>Let’s get the summary of match similarity.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">apply</span>(sim<span class="sc">$</span>similarity, <span class="dv">1</span>, max))</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.4670  0.6625  0.8380  0.7727  0.8705  0.9620 </code></pre>
</div>
<div id="merged-cns-from-clustering-of-cancer-type-associated-cns" class="section level3">
<h3>Merged CNS from clustering of cancer-type associated CNS</h3>
<p>To further validate the CNS (stability) identified in PCAWG whole dataset. We also tried the cancer-type-wise signature identification pipeline from <span class="citation"><a href="#ref-degasperiPracticalFrameworkOnline2020" role="doc-biblioref">Degasperi et al.</a> (<a href="#ref-degasperiPracticalFrameworkOnline2020" role="doc-biblioref">2020</a>)</span>, we implemented the procedure in our package <code>sigminer</code> by following the method description. <a href="https://github.com/ShixiangWang/sigminer#key-interfaces-and-their-performances">A benchmark</a> has been done to make sure our implementation works properly.</p>
<p>1000 NMF runs (20 bootstrap catalogs and 50 NMF runs for each bootstrap catalog) was applied for data from each cancer type, which is similar to <span class="citation"><a href="#ref-degasperiPracticalFrameworkOnline2020" role="doc-biblioref">Degasperi et al.</a> (<a href="#ref-degasperiPracticalFrameworkOnline2020" role="doc-biblioref">2020</a>)</span>.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This script is running on HPC</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>tally_X <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;pcawg_cn_tally_X.rds&quot;</span>)</span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>pcawg_types <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;pcawg_type_info.rds&quot;</span>)</span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(pcawg_types<span class="sc">$</span>cancer_type)) {</span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;handling type: &quot;</span>, i)</span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a>  fn <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;BP&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;PCAWG_CN176_&quot;</span>, <span class="fu">gsub</span>(<span class="st">&quot;/&quot;</span>, <span class="st">&quot;-&quot;</span>, i), <span class="st">&quot;.rds&quot;</span>))</span>
<span id="cb216-11"><a href="#cb216-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-12"><a href="#cb216-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fn)) {</span>
<span id="cb216-13"><a href="#cb216-13" aria-hidden="true" tabindex="-1"></a>    type_samples <span class="ot">&lt;-</span> pcawg_types <span class="sc">%&gt;%</span></span>
<span id="cb216-14"><a href="#cb216-14" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(cancer_type <span class="sc">==</span> i) <span class="sc">%&gt;%</span></span>
<span id="cb216-15"><a href="#cb216-15" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">pull</span>(sample)</span>
<span id="cb216-16"><a href="#cb216-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;Sample number: &quot;</span>, <span class="fu">length</span>(type_samples))</span>
<span id="cb216-17"><a href="#cb216-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-18"><a href="#cb216-18" aria-hidden="true" tabindex="-1"></a>    sigs <span class="ot">&lt;-</span> <span class="fu">bp_extract_signatures</span>(</span>
<span id="cb216-19"><a href="#cb216-19" aria-hidden="true" tabindex="-1"></a>      tally_X<span class="sc">$</span>nmf_matrix[type_samples, , <span class="at">drop =</span> <span class="cn">FALSE</span>],</span>
<span id="cb216-20"><a href="#cb216-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">20</span>, <span class="fu">length</span>(type_samples) <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb216-21"><a href="#cb216-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">30</span>,</span>
<span id="cb216-22"><a href="#cb216-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores_solution =</span> <span class="dv">20</span>,</span>
<span id="cb216-23"><a href="#cb216-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">cache_dir =</span> <span class="st">&quot;BP/BP_PCAWG_types&quot;</span>,</span>
<span id="cb216-24"><a href="#cb216-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">keep_cache =</span> <span class="cn">TRUE</span>,</span>
<span id="cb216-25"><a href="#cb216-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">only_core_stats =</span> <span class="cn">TRUE</span></span>
<span id="cb216-26"><a href="#cb216-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb216-27"><a href="#cb216-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveRDS</span>(sigs, <span class="at">file =</span> fn)</span>
<span id="cb216-28"><a href="#cb216-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb216-29"><a href="#cb216-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We then load the result and do manual inspection to determine the proper signature number for each cancer type.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>cancer_type_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;../data/cancer_types/&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;PCAWG_CN176&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>pcawg <span class="ot">&lt;-</span> <span class="fu">lapply</span>(cancer_type_files, readRDS)</span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">1</span>]]) <span class="co"># 11</span></span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">2</span>]]) <span class="co"># 14</span></span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">3</span>]]) <span class="co"># 13</span></span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">4</span>]]) <span class="co"># 8</span></span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">5</span>]]) <span class="co"># 14</span></span>
<span id="cb217-11"><a href="#cb217-11" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">6</span>]]) <span class="co"># 11</span></span>
<span id="cb217-12"><a href="#cb217-12" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">7</span>]]) <span class="co"># 12</span></span>
<span id="cb217-13"><a href="#cb217-13" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">8</span>]]) <span class="co"># 8</span></span>
<span id="cb217-14"><a href="#cb217-14" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">9</span>]]) <span class="co"># 7</span></span>
<span id="cb217-15"><a href="#cb217-15" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">10</span>]]) <span class="co"># 5</span></span>
<span id="cb217-16"><a href="#cb217-16" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">11</span>]]) <span class="co"># 13</span></span>
<span id="cb217-17"><a href="#cb217-17" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">12</span>]]) <span class="co"># 9</span></span>
<span id="cb217-18"><a href="#cb217-18" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">13</span>]]) <span class="co"># 15</span></span>
<span id="cb217-19"><a href="#cb217-19" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">14</span>]]) <span class="co"># 7</span></span>
<span id="cb217-20"><a href="#cb217-20" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">15</span>]]) <span class="co"># 11</span></span>
<span id="cb217-21"><a href="#cb217-21" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">16</span>]]) <span class="co"># 12</span></span>
<span id="cb217-22"><a href="#cb217-22" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">17</span>]]) <span class="co"># 12</span></span>
<span id="cb217-23"><a href="#cb217-23" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">18</span>]]) <span class="co"># 17</span></span>
<span id="cb217-24"><a href="#cb217-24" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">19</span>]]) <span class="co"># 12</span></span>
<span id="cb217-25"><a href="#cb217-25" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">20</span>]]) <span class="co"># 6</span></span>
<span id="cb217-26"><a href="#cb217-26" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">21</span>]]) <span class="co"># 3</span></span>
<span id="cb217-27"><a href="#cb217-27" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">22</span>]]) <span class="co"># 7</span></span>
<span id="cb217-28"><a href="#cb217-28" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">23</span>]]) <span class="co"># 11</span></span>
<span id="cb217-29"><a href="#cb217-29" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">24</span>]]) <span class="co"># 19</span></span>
<span id="cb217-30"><a href="#cb217-30" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">25</span>]]) <span class="co"># 8</span></span>
<span id="cb217-31"><a href="#cb217-31" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">26</span>]]) <span class="co"># 10</span></span>
<span id="cb217-32"><a href="#cb217-32" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">27</span>]]) <span class="co"># 11</span></span>
<span id="cb217-33"><a href="#cb217-33" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">28</span>]]) <span class="co"># 9</span></span>
<span id="cb217-34"><a href="#cb217-34" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">29</span>]]) <span class="co"># 9</span></span>
<span id="cb217-35"><a href="#cb217-35" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">30</span>]]) <span class="co"># 15</span></span>
<span id="cb217-36"><a href="#cb217-36" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">31</span>]]) <span class="co"># 6</span></span>
<span id="cb217-37"><a href="#cb217-37" aria-hidden="true" tabindex="-1"></a><span class="fu">bp_show_survey2</span>(pcawg[[<span class="dv">32</span>]]) <span class="co"># 17</span></span>
<span id="cb217-38"><a href="#cb217-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-39"><a href="#cb217-39" aria-hidden="true" tabindex="-1"></a>type_sig <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb217-40"><a href="#cb217-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">cancer_type =</span> <span class="fu">sub</span>(<span class="st">&quot;.*_CN176_([^_]+).rds&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, <span class="fu">basename</span>(cancer_type_files)),</span>
<span id="cb217-41"><a href="#cb217-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">signum =</span> <span class="fu">c</span>(</span>
<span id="cb217-42"><a href="#cb217-42" aria-hidden="true" tabindex="-1"></a>    <span class="dv">11</span>, <span class="dv">14</span>, <span class="dv">13</span>, <span class="dv">8</span>, <span class="dv">14</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">8</span>,</span>
<span id="cb217-43"><a href="#cb217-43" aria-hidden="true" tabindex="-1"></a>    <span class="dv">7</span>, <span class="dv">5</span>, <span class="dv">13</span>, <span class="dv">9</span>, <span class="dv">15</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">12</span>,</span>
<span id="cb217-44"><a href="#cb217-44" aria-hidden="true" tabindex="-1"></a>    <span class="dv">12</span>, <span class="dv">17</span>, <span class="dv">12</span>, <span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">19</span>,</span>
<span id="cb217-45"><a href="#cb217-45" aria-hidden="true" tabindex="-1"></a>    <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">15</span>, <span class="dv">6</span>, <span class="dv">17</span></span>
<span id="cb217-46"><a href="#cb217-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb217-47"><a href="#cb217-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb217-48"><a href="#cb217-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-49"><a href="#cb217-49" aria-hidden="true" tabindex="-1"></a>pcawg_sig_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb217-50"><a href="#cb217-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seq_along</span>(pcawg),</span>
<span id="cb217-51"><a href="#cb217-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(i) {</span>
<span id="cb217-52"><a href="#cb217-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bp_get_sig_obj</span>(pcawg[[i]], <span class="at">signum =</span> type_sig<span class="sc">$</span>signum[i])</span>
<span id="cb217-53"><a href="#cb217-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb217-54"><a href="#cb217-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb217-55"><a href="#cb217-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-56"><a href="#cb217-56" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pcawg_sig_list) <span class="ot">&lt;-</span> type_sig<span class="sc">$</span>cancer_type</span>
<span id="cb217-57"><a href="#cb217-57" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(pcawg_sig_list, <span class="at">file =</span> <span class="st">&quot;data/pcawg_type_CNS.rds&quot;</span>)</span></code></pre></div>
<p>The signature number ranges from <code>3</code> to <code>19</code>.</p>
<p>Next we need to collapse all shared signatures from cancer types. To do this, we cluster all signatures based their cosine dissimilarity.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>pcawg_sig_list <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_type_CNS.rds&quot;</span>)</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>pcawg_sig_list<span class="sc">$</span><span class="st">`</span><span class="at">Biliary-AdenoCA</span><span class="st">`</span></span></code></pre></div>
<pre><code>$Signature
                      Sig1         Sig2         Sig3         Sig4         Sig5
E:HH:0:AA     1.919365e-17 1.836909e-17 1.862198e-17 1.876080e-17 1.826403e-17
E:HH:0:BB     1.919365e-17 4.166667e-02 1.862198e-17 1.876080e-17 3.333333e-01
E:HH:1:AA     1.439106e+00 2.676199e+01 5.001386e+01 1.133406e+01 3.832072e+01
E:HH:1:BB     2.501214e+00 1.968315e+00 3.348985e+00 1.262798e+00 4.322378e+00
E:HH:2:AA     4.466717e+00 1.547829e+02 2.642123e+01 5.648644e+00 1.748853e+01
E:HH:2:BB     1.919365e-17 1.220585e+01 5.863062e-01 1.876080e-17 3.057059e+00
                      Sig6         Sig7         Sig8         Sig9        Sig10
E:HH:0:AA     1.782894e-17 1.822001e-17 1.780042e-17 1.780276e-17 1.754057e-17
E:HH:0:BB     1.782894e-17 1.666667e-01 2.500000e-01 1.780276e-17 1.754057e-17
E:HH:1:AA     1.965323e+01 2.988848e+01 3.066430e+01 1.351001e+01 1.994798e+01
E:HH:1:BB     9.366926e-01 1.306594e+00 4.723706e+00 2.207346e+00 1.315582e+00
E:HH:2:AA     8.329851e+01 1.482409e+01 3.108890e+01 1.371453e+01 1.312290e+01
E:HH:2:BB     5.839599e+00 6.961702e-01 4.629335e+00 6.959860e-01 3.094529e-02
                     Sig11
E:HH:0:AA     1.718942e-17
E:HH:0:BB     4.166667e-02
E:HH:1:AA     4.299592e+00
E:HH:1:BB     1.189723e+00
E:HH:2:AA     4.768073e+00
E:HH:2:BB     1.337466e-01
 [ reached getOption(&quot;max.print&quot;) -- omitted 170 rows ]

$Signature.norm
                      Sig1         Sig2         Sig3         Sig4         Sig5
E:HH:0:AA     4.170979e-20 4.025733e-20 4.219701e-20 4.560529e-20 4.546751e-20
E:HH:0:BB     4.170979e-20 9.131585e-05 4.219701e-20 4.560529e-20 8.298187e-04
E:HH:1:AA     3.127326e-03 5.865106e-02 1.133303e-01 2.755176e-02 9.539775e-02
E:HH:1:BB     5.435396e-03 4.313720e-03 7.588728e-03 3.069712e-03 1.076037e-02
E:HH:2:AA     9.706637e-03 3.392191e-01 5.986994e-02 1.373119e-02 4.353692e-02
E:HH:2:BB     4.170979e-20 2.675010e-02 1.328557e-03 4.560529e-20 7.610416e-03
                      Sig6         Sig7         Sig8         Sig9        Sig10
E:HH:0:AA     4.505784e-20 4.702870e-20 4.662014e-20 4.735328e-20 4.690863e-20
E:HH:0:BB     4.505784e-20 4.301928e-04 6.547619e-04 4.735328e-20 4.690863e-20
E:HH:1:AA     4.966824e-02 7.714685e-02 8.031126e-02 3.593507e-02 5.334673e-02
E:HH:1:BB     2.367237e-03 3.372525e-03 1.237161e-02 5.871284e-03 3.518252e-03
E:HH:2:AA     2.105145e-01 3.826331e-02 8.142329e-02 3.647905e-02 3.509449e-02
E:HH:2:BB     1.475801e-02 1.796925e-03 1.212445e-02 1.851242e-03 8.275678e-05
                     Sig11
E:HH:0:AA     4.743997e-20
E:HH:0:BB     1.149931e-04
E:HH:1:AA     1.186616e-02
E:HH:1:BB     3.283438e-03
E:HH:2:AA     1.315909e-02
E:HH:2:BB     3.691185e-04
 [ reached getOption(&quot;max.print&quot;) -- omitted 170 rows ]

$Exposure
        SP117017     SP117031     SP117332     SP117425     SP117556
Sig1   0.1672924 1.197175e-12 1.197175e-12 6.971195e+01 1.197175e-12
Sig2  16.5815545 5.832088e+00 3.089812e+01 9.958335e+00 1.191513e+01
          SP117621     SP117627  SP117712     SP117759     SP117930
Sig1  2.280120e+01 1.197175e-12 0.9674283 1.197175e-12 3.162089e+01
Sig2  1.576648e-10 8.451208e+00 9.7202684 1.218155e+01 1.228684e-12
           SP99113      SP99185   SP99209      SP99213      SP99221
Sig1  1.197175e-12 1.859668e-01  1.036956 1.197175e-12 1.197175e-12
Sig2  1.374978e+01 4.361682e+01 27.334544 1.639245e+00 1.437495e+01
           SP99225      SP99241      SP99287      SP99297      SP99301
Sig1  1.197175e-12 1.197175e-12 7.040598e-01 1.197175e-12 1.197175e-12
Sig2  1.287393e+01 2.741258e+00 8.065416e+00 1.107821e+01 1.441029e+01
           SP99305      SP99309      SP99313      SP99317      SP99321
Sig1  1.197175e-12 1.197175e-12 1.582058e-11 1.197175e-12 1.197175e-12
Sig2  4.729177e+00 3.679884e+01 5.166667e+00 2.669124e+01 1.138996e+01
           SP99325    SP99329      SP99333      SP99337      SP99341
Sig1  1.197175e-12  1.8473495 1.197175e-12 1.197175e-12 1.197175e-12
Sig2  6.065915e+01  3.4707960 4.141006e+00 1.200774e+01 1.381966e+01
           SP99345     SP117655    SP117775      SP99293
Sig1  1.197175e-12 3.092667e+02  18.3954369 3.466154e+00
Sig2  1.919694e+01 7.187344e-01   2.0791266 2.457368e-12
 [ reached getOption(&quot;max.print&quot;) -- omitted 9 rows ]

$Exposure.norm
         SP117017     SP117031     SP117332     SP117425     SP117556
Sig1  0.001779718 1.786838e-14 2.029149e-14 2.916822e-01 9.976572e-15
Sig2  0.176400657 8.704661e-02 5.237070e-01 4.166673e-02 9.929391e-02
          SP117621     SP117627    SP117712     SP117759     SP117930
Sig1  1.398845e-01 6.107916e-15 0.017275519 4.450592e-15 1.681940e-01
Sig2  9.672676e-13 4.311758e-02 0.173576348 4.528589e-02 6.535468e-15
           SP99113      SP99185    SP99209      SP99213      SP99221
Sig1  5.441786e-14 2.582919e-03 0.01329435 6.046194e-15 8.675074e-15
Sig2  6.249994e-01 6.058002e-01 0.35044411 8.278819e-03 1.041650e-01
           SP99225      SP99241      SP99287      SP99297      SP99301
Sig1  2.720856e-14 1.686136e-14 6.579953e-03 1.900301e-14 3.990636e-14
Sig2  2.925898e-01 3.860870e-02 7.537720e-02 1.758469e-01 4.803496e-01
           SP99305      SP99309      SP99313      SP99317      SP99321
Sig1  2.029128e-14 1.496494e-14 1.275835e-13 2.302295e-14 8.430798e-15
Sig2  8.015629e-02 4.599934e-01 4.166609e-02 5.133011e-01 8.021093e-02
           SP99325     SP99329      SP99333      SP99337      SP99341
Sig1  4.926634e-15 0.014661689 1.930950e-14 2.137816e-14 1.059437e-14
Sig2  2.496256e-01 0.027546348 6.679120e-02 2.144244e-01 1.222968e-01
           SP99345     SP117655    SP117775      SP99293
Sig1  3.861913e-14 6.608248e-01 0.054747947 1.229137e-02
Sig2  6.192655e-01 1.535754e-03 0.006187834 8.714100e-15
 [ reached getOption(&quot;max.print&quot;) -- omitted 9 rows ]

$K
[1] 11

attr(,&quot;class&quot;)
[1] &quot;Signature&quot;
attr(,&quot;used_runs&quot;)
[1] 24
attr(,&quot;method&quot;)
[1] &quot;brunet&quot;
attr(,&quot;call_method&quot;)
[1] &quot;NMF with best practice&quot;
attr(,&quot;nrun&quot;)
[1] 1000
attr(,&quot;seed&quot;)
[1] 123456</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>cls <span class="ot">&lt;-</span> <span class="fu">bp_cluster_iter_list</span>(pcawg_sig_list, <span class="at">k =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">30</span>)</span></code></pre></div>
<p>We try <code>2</code> to <code>30</code> signatures here to check how the silhouette changes in different cluster number <code>k</code>.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>cls<span class="sc">$</span>sil_summary</span></code></pre></div>
<pre><code>    k        min      mean       max        sd
1   2 -0.4144666 0.2910101 0.5572367 0.1744367
2   3 -0.7191056 0.2049187 0.8931134 0.2275587
3   4 -0.7191056 0.1850721 0.8931134 0.2503893
4   5 -0.6641900 0.2973617 0.8884523 0.2848243
5   6 -0.6616768 0.2762899 0.8880718 0.2842627
6   7 -0.6600962 0.2767034 0.8797653 0.2863463
7   8 -0.6600962 0.2678768 0.8797653 0.2920637
8   9 -0.6990881 0.2568783 0.8797653 0.3143687
9  10 -0.6990881 0.2452582 0.8797653 0.3194973
10 11 -0.6800734 0.2446516 0.8797653 0.3149417
11 12 -0.6789815 0.2340692 0.8797653 0.3160896
12 13 -0.6789815 0.2310671 0.8710570 0.3172617
13 14 -0.6788359 0.2124811 0.8710570 0.3206350
14 15 -0.6788359 0.2043917 0.8710570 0.3230532
15 16 -0.6788359 0.1930057 0.8710570 0.3189946
 [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 14 rows ]</code></pre>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cls<span class="sc">$</span>sil_summary<span class="sc">$</span>k, cls<span class="sc">$</span>sil_summary<span class="sc">$</span>mean, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Total signatures&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Mean silhouette&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-171-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>In general, the mean silhouette is not high. But we can still see that <code>20</code> or <code>22</code> may be suitable. <code>k=5</code> is not considered because it is too small to explain our data.</p>
<p>Signature similarity is the key parameter in our study. Here we use an average cosine distance <code>0.4</code> (i.e. signatures with similarity <code>&gt;=0.6</code> could be clustered as one) as a cutoff:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(cls<span class="sc">$</span>cluster,</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fl">0.4</span>, <span class="at">cex =</span> <span class="fl">0.15</span>,</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;1 - cosine similarity, average linkage&quot;</span></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-172-1.png" width="4500" style="display: block; margin: auto;" /></p>
<p>Check the cluster number:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>cls_tree <span class="ot">&lt;-</span> <span class="fu">cutree</span>(cls<span class="sc">$</span>cluster, <span class="at">h =</span> <span class="fl">0.4</span>)</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cls_tree)</span></code></pre></div>
<pre><code>cls_tree
  1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20 
 16  57  71 108  20   3   1  29   2   4   7   1   6   1   3   4   2   1   1   1 
 21  22  23  24 
  1   1   1   1 </code></pre>
<p>This is close to <code>22</code>. We observe there are a few isolated clusters with only one signature, they may be artifacts or should be assigned to other clusters but cannot due to low similarity to others.</p>
<p>Next we obtain clustered (grouped) signatures by averaging signatures in a cluster.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>grp_sigs <span class="ot">&lt;-</span> <span class="fu">bp_get_clustered_sigs</span>(cls, cls_tree)</span></code></pre></div>
<p>Next we load PCAWG global CNS and check their similarity.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>pcawg_sigs <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_sigs_CN176_signature.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>sim1 <span class="ot">&lt;-</span> <span class="fu">get_sig_similarity</span>(pcawg_sigs, grp_sigs<span class="sc">$</span>grp_sigs)</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>sim_mat <span class="ot">&lt;-</span> sim1<span class="sc">$</span>similarity</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sim_mat) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;Sig&quot;</span>, <span class="st">&quot;Group-Sig&quot;</span>, <span class="fu">colnames</span>(sim_mat))</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(sim_mat, <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>, <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>, <span class="at">display_numbers =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-176-1.png" width="2400" style="display: block; margin: auto;" /> We can see that most of PCAWG global signatures can be properly matched to group signatures. <code>CNS2</code> 和 <code>CNS13</code> seems not stable and tend to be easier affected by extraction procedure.</p>
<p>Also, we observe almost all group signatures on the right side can be assigned to a PCAWG global signatures, although most of them have relatively low similarity. This data indicate the signatures may be redundant.</p>
<p>Let’s check the similarity between group signatures and best matched global signatures.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>mc <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim1<span class="sc">$</span>similarity, <span class="dv">2</span>, which.max)</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>mc_sim <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim1<span class="sc">$</span>similarity, <span class="dv">2</span>, max)</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>mc_sim</span></code></pre></div>
<pre><code> Sig1 Sig14  Sig2  Sig5 Sig10  Sig7 Sig18  Sig6 Sig11 Sig21 Sig15 Sig13 Sig19 
0.886 0.646 0.988 0.899 0.914 0.813 0.824 0.855 0.953 0.788 0.902 0.937 0.676 
 Sig9  Sig3  Sig4  Sig8 Sig12 Sig16 Sig17 Sig20 Sig22 Sig23 Sig24 
0.901 0.727 0.569 0.667 0.598 0.815 0.717 0.693 0.579 0.477 0.467 </code></pre>
<p>Next let’s visualize the data along with the similarity of signatures within a group (cluster).</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>mc_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">grp_sig =</span> <span class="fu">names</span>(mc),</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">global_sig =</span> <span class="fu">paste0</span>(<span class="st">&quot;CNS&quot;</span>, mc),</span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sim =</span> <span class="fu">as.numeric</span>(mc_sim)</span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(grp_sig, <span class="st">&quot;(&quot;</span>, global_sig, <span class="st">&quot;, &quot;</span>, sim, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">grp_sig =</span> <span class="fu">factor</span>(grp_sig, <span class="at">levels =</span> <span class="fu">paste0</span>(<span class="st">&quot;Sig&quot;</span>, <span class="fu">seq_len</span>(<span class="fu">nrow</span>(.))))</span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(grp_sig)</span></code></pre></div>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggboxplot</span>(grp_sigs<span class="sc">$</span>sim_sig_to_grp_mean,</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;grp_sig&quot;</span>, <span class="at">y =</span> <span class="st">&quot;sim&quot;</span>, <span class="at">width =</span> <span class="fl">0.3</span>,</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="cn">FALSE</span>, <span class="at">ylab =</span> <span class="st">&quot;cosine similarity&quot;</span>,</span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Cosine similarity between signatures in each group&quot;</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">rotate_x_text</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-179-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>Add labels:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggboxplot</span>(grp_sigs<span class="sc">$</span>sim_sig_to_grp_mean, <span class="co"># %&gt;%</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::filter(grp_sig %in% select_sigs),</span></span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;grp_sig&quot;</span>, <span class="at">y =</span> <span class="st">&quot;sim&quot;</span>, <span class="at">width =</span> <span class="fl">0.3</span>,</span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="cn">FALSE</span>, <span class="at">ylab =</span> <span class="st">&quot;Cosine similarity&quot;</span>,</span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Cosine similarity between signatures in each group&quot;</span></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>  ggpubr<span class="sc">::</span><span class="fu">rotate_x_text</span>() <span class="sc">+</span></span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> mc_df<span class="sc">$</span>label)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-180-1.png" width="2400" style="display: block; margin: auto;" /></p>
<blockquote>
<p>Here y axis indicates cosine similarity between the averaging signature of each group and the individual signatures that belong to each group.</p>
</blockquote>
</div>
</div>
<div id="pcawg-and-tcga-pan-cancer-copy-number-alteration-profile-and-analysis" class="section level2">
<h2>PCAWG and TCGA Pan-Cancer copy number alteration profile and analysis</h2>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sigminer)</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>pcawg_cn <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_cn_obj.rds&quot;</span>)</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>pcawg_type <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/pcawg_type_info.rds&quot;</span>)</span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>pcawg_sbs <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;../data/PCAWG/PCAWG_sigProfiler_SBS_signatures_in_samples.csv&quot;</span>)</span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>pcawg_sbs <span class="ot">&lt;-</span> pcawg_sbs <span class="sc">%&gt;%</span></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sbs =</span> <span class="fu">rowSums</span>(pcawg_sbs[, <span class="fu">grepl</span>(<span class="st">&quot;SBS&quot;</span>, <span class="fu">colnames</span>(pcawg_sbs)), <span class="at">with =</span> <span class="cn">FALSE</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample =</span> <span class="st">`</span><span class="at">Sample Names</span><span class="st">`</span></span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample, sbs)</span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a>pcawg_ids <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;../data/PCAWG/PCAWG_SigProfiler_ID_signatures_in_samples.csv&quot;</span>)</span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a>pcawg_ids <span class="ot">&lt;-</span> pcawg_ids <span class="sc">%&gt;%</span></span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb235-17"><a href="#cb235-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">ids =</span> <span class="fu">rowSums</span>(pcawg_ids[, <span class="fu">grepl</span>(<span class="st">&quot;ID&quot;</span>, <span class="fu">colnames</span>(pcawg_ids)), <span class="at">with =</span> <span class="cn">FALSE</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb235-18"><a href="#cb235-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb235-19"><a href="#cb235-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb235-20"><a href="#cb235-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample =</span> <span class="st">`</span><span class="at">Sample Names</span><span class="st">`</span></span>
<span id="cb235-21"><a href="#cb235-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb235-22"><a href="#cb235-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample, ids)</span>
<span id="cb235-23"><a href="#cb235-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-24"><a href="#cb235-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-25"><a href="#cb235-25" aria-hidden="true" tabindex="-1"></a>pcawg_summary <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">reduce</span>(</span>
<span id="cb235-26"><a href="#cb235-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb235-27"><a href="#cb235-27" aria-hidden="true" tabindex="-1"></a>    pcawg_cn<span class="sc">@</span>summary.per.sample,</span>
<span id="cb235-28"><a href="#cb235-28" aria-hidden="true" tabindex="-1"></a>    pcawg_sbs,</span>
<span id="cb235-29"><a href="#cb235-29" aria-hidden="true" tabindex="-1"></a>    pcawg_ids,</span>
<span id="cb235-30"><a href="#cb235-30" aria-hidden="true" tabindex="-1"></a>    pcawg_type</span>
<span id="cb235-31"><a href="#cb235-31" aria-hidden="true" tabindex="-1"></a>  ), dplyr<span class="sc">::</span>left_join,</span>
<span id="cb235-32"><a href="#cb235-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb235-33"><a href="#cb235-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb235-34"><a href="#cb235-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-35"><a href="#cb235-35" aria-hidden="true" tabindex="-1"></a>tcga_cn <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/TCGA/tcga_cn_obj.rds&quot;</span>)</span>
<span id="cb235-36"><a href="#cb235-36" aria-hidden="true" tabindex="-1"></a>tcga_type <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../data/TCGA/TCGA_type_info.rds&quot;</span>)</span>
<span id="cb235-37"><a href="#cb235-37" aria-hidden="true" tabindex="-1"></a>tcga_sbs <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;../data/PCAWG/TCGA_WES_sigProfiler_SBS_signatures_in_samples.csv&quot;</span>)</span>
<span id="cb235-38"><a href="#cb235-38" aria-hidden="true" tabindex="-1"></a>tcga_sbs <span class="ot">&lt;-</span> tcga_sbs <span class="sc">%&gt;%</span></span>
<span id="cb235-39"><a href="#cb235-39" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb235-40"><a href="#cb235-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">sbs =</span> <span class="fu">rowSums</span>(tcga_sbs[, <span class="fu">grepl</span>(<span class="st">&quot;SBS&quot;</span>, <span class="fu">colnames</span>(tcga_sbs)), <span class="at">with =</span> <span class="cn">FALSE</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb235-41"><a href="#cb235-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb235-42"><a href="#cb235-42" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb235-43"><a href="#cb235-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample =</span> <span class="st">`</span><span class="at">Sample Names</span><span class="st">`</span></span>
<span id="cb235-44"><a href="#cb235-44" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb235-45"><a href="#cb235-45" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sample =</span> <span class="fu">substr</span>(sample, <span class="dv">1</span>, <span class="dv">15</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb235-46"><a href="#cb235-46" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample, sbs)</span>
<span id="cb235-47"><a href="#cb235-47" aria-hidden="true" tabindex="-1"></a>tcga_ids <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;../data/PCAWG/TCGA_WES_sigProfiler_ID_signatures_in_samples.csv&quot;</span>)</span>
<span id="cb235-48"><a href="#cb235-48" aria-hidden="true" tabindex="-1"></a>tcga_ids <span class="ot">&lt;-</span> tcga_ids <span class="sc">%&gt;%</span></span>
<span id="cb235-49"><a href="#cb235-49" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb235-50"><a href="#cb235-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">ids =</span> <span class="fu">rowSums</span>(tcga_ids[, <span class="fu">grepl</span>(<span class="st">&quot;ID&quot;</span>, <span class="fu">colnames</span>(tcga_ids)), <span class="at">with =</span> <span class="cn">FALSE</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb235-51"><a href="#cb235-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb235-52"><a href="#cb235-52" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb235-53"><a href="#cb235-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample =</span> <span class="st">`</span><span class="at">Sample Names</span><span class="st">`</span></span>
<span id="cb235-54"><a href="#cb235-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb235-55"><a href="#cb235-55" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb235-56"><a href="#cb235-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample =</span> <span class="fu">substr</span>(sample, <span class="dv">1</span>, <span class="dv">15</span>)</span>
<span id="cb235-57"><a href="#cb235-57" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb235-58"><a href="#cb235-58" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample, ids)</span>
<span id="cb235-59"><a href="#cb235-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-60"><a href="#cb235-60" aria-hidden="true" tabindex="-1"></a>tcga_summary <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">reduce</span>(</span>
<span id="cb235-61"><a href="#cb235-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb235-62"><a href="#cb235-62" aria-hidden="true" tabindex="-1"></a>    tcga_cn<span class="sc">@</span>summary.per.sample,</span>
<span id="cb235-63"><a href="#cb235-63" aria-hidden="true" tabindex="-1"></a>    tcga_sbs,</span>
<span id="cb235-64"><a href="#cb235-64" aria-hidden="true" tabindex="-1"></a>    tcga_ids,</span>
<span id="cb235-65"><a href="#cb235-65" aria-hidden="true" tabindex="-1"></a>    tcga_type</span>
<span id="cb235-66"><a href="#cb235-66" aria-hidden="true" tabindex="-1"></a>  ), dplyr<span class="sc">::</span>left_join,</span>
<span id="cb235-67"><a href="#cb235-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;sample&quot;</span></span>
<span id="cb235-68"><a href="#cb235-68" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="summary" class="section level3">
<h3>Summary</h3>
<div id="scna-length-distribution" class="section level4">
<h4>SCNA length distribution</h4>
<p>PCAWG:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_cn_distribution</span>(pcawg_cn)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-182-1.png" width="1800" style="display: block; margin: auto;" /></p>
<p>TCGA:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_cn_distribution</span>(tcga_cn)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-183-1.png" width="1800" style="display: block; margin: auto;" /></p>
</div>
<div id="scna-chromosome-distribution" class="section level4">
<h4>SCNA chromosome distribution</h4>
<p>PCAWG:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_cn_distribution</span>(pcawg_cn, <span class="at">mode =</span> <span class="st">&quot;cd&quot;</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-184-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>TCGA:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_cn_distribution</span>(tcga_cn, <span class="at">mode =</span> <span class="st">&quot;cd&quot;</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-185-1.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
<div id="scna-variation-frequency" class="section level4">
<h4>SCNA variation frequency</h4>
<p>PCAWG:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_cn_group_profile</span>(pcawg_cn)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-186-1.png" width="2400" style="display: block; margin: auto;" /></p>
<p>TCGA:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_cn_group_profile</span>(tcga_cn)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-187-1.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="summary-data-analysis" class="section level3">
<h3>Summary data analysis</h3>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code></pre></div>
<div id="distribution" class="section level4">
<h4>Distribution</h4>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> pcawg_summary <span class="sc">%&gt;%</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample, n_of_cnv, cna_burden, sbs, ids) <span class="sc">%&gt;%</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_of_cnv =</span> <span class="fu">log10</span>(n_of_cnv <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sbs =</span> <span class="fu">log10</span>(sbs <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ids =</span> <span class="fu">log10</span>(ids <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;Total CNVs (log10)&quot;</span>, <span class="st">&quot;CNA burden&quot;</span>, <span class="st">&quot;Total SNVs (log10)&quot;</span>, <span class="st">&quot;Total Indels (log10)&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">colnames</span>(.)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb243-13"><a href="#cb243-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">&quot;gold&quot;</span>) <span class="sc">+</span></span>
<span id="cb243-14"><a href="#cb243-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb243-15"><a href="#cb243-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb243-16"><a href="#cb243-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb243-17"><a href="#cb243-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb243-18"><a href="#cb243-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb243-19"><a href="#cb243-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-189-1.png" width="2400" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ridges</span>() <span class="sc">+</span></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-190-1.png" width="2400" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> tcga_summary <span class="sc">%&gt;%</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample, n_of_cnv, cna_burden, sbs, ids) <span class="sc">%&gt;%</span></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_of_cnv =</span> <span class="fu">log10</span>(n_of_cnv <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sbs =</span> <span class="fu">log10</span>(sbs <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ids =</span> <span class="fu">log10</span>(ids <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>, <span class="st">&quot;Total CNVs (log10)&quot;</span>, <span class="st">&quot;CNA burden&quot;</span>, <span class="st">&quot;Total SNVs (log10)&quot;</span>, <span class="st">&quot;Total Indels (log10)&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">colnames</span>(.)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb245-13"><a href="#cb245-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">&quot;gold&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-14"><a href="#cb245-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb245-15"><a href="#cb245-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb245-16"><a href="#cb245-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb245-17"><a href="#cb245-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb245-18"><a href="#cb245-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb245-19"><a href="#cb245-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-191-1.png" width="2400" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_ridges</span>() <span class="sc">+</span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-192-1.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
<div id="correlation" class="section level4">
<h4>Correlation</h4>
<p>PCAWG:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> pcawg_summary <span class="sc">%&gt;%</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(n_of_cnv, cna_burden, sbs, ids) <span class="sc">%&gt;%</span></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_of_cnv =</span> <span class="fu">log10</span>(n_of_cnv <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sbs =</span> <span class="fu">log10</span>(sbs <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ids =</span> <span class="fu">log10</span>(ids <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;Total CNVs (log10)&quot;</span>, <span class="st">&quot;CNA burden&quot;</span>, <span class="st">&quot;Total SNVs (log10)&quot;</span>, <span class="st">&quot;Total Indels (log10)&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_cor</span>(data)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-194-1.png" width="2400" style="display: block; margin: auto;" /> Show some detail scatter plots.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatter</span>(data,</span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;Total CNVs (log10)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Total SNVs (log10)&quot;</span>,</span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="co"># Points color, shape and size</span></span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">add =</span> <span class="st">&quot;reg.line&quot;</span>, <span class="co"># Add regressin line</span></span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">add.params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightgray&quot;</span>), <span class="co"># Customize reg. line</span></span>
<span id="cb249-8"><a href="#cb249-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="co"># Add confidence interval</span></span>
<span id="cb249-9"><a href="#cb249-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">cor.coef =</span> <span class="cn">TRUE</span>, <span class="co"># Add correlation coefficient. see ?stat_cor</span></span>
<span id="cb249-10"><a href="#cb249-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cor.coeff.args =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>, <span class="at">label.x =</span> <span class="fl">1.5</span>, <span class="at">label.sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb249-11"><a href="#cb249-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-195-1.png" width="2400" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatter</span>(data,</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;Total CNVs (log10)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Total Indels (log10)&quot;</span>,</span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="co"># Points color, shape and size</span></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">add =</span> <span class="st">&quot;reg.line&quot;</span>, <span class="co"># Add regressin line</span></span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">add.params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightgray&quot;</span>), <span class="co"># Customize reg. line</span></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="co"># Add confidence interval</span></span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cor.coef =</span> <span class="cn">TRUE</span>, <span class="co"># Add correlation coefficient. see ?stat_cor</span></span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cor.coeff.args =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>, <span class="at">label.x =</span> <span class="fl">2.5</span>, <span class="at">label.sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-196-1.png" width="2400" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> tcga_summary <span class="sc">%&gt;%</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(n_of_cnv, cna_burden, sbs, ids) <span class="sc">%&gt;%</span></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_of_cnv =</span> <span class="fu">log10</span>(n_of_cnv <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sbs =</span> <span class="fu">log10</span>(sbs <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ids =</span> <span class="fu">log10</span>(ids <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;Total CNVs (log10)&quot;</span>, <span class="st">&quot;CNA burden&quot;</span>, <span class="st">&quot;Total SNVs (log10)&quot;</span>, <span class="st">&quot;Total Indels (log10)&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_cor</span>(data)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-198-1.png" width="2400" style="display: block; margin: auto;" /> Show some detail scatter plots.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatter</span>(data,</span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;Total CNVs (log10)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Total SNVs (log10)&quot;</span>,</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="co"># Points color, shape and size</span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">add =</span> <span class="st">&quot;reg.line&quot;</span>, <span class="co"># Add regressin line</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">add.params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightgray&quot;</span>), <span class="co"># Customize reg. line</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="co"># Add confidence interval</span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cor.coef =</span> <span class="cn">TRUE</span>, <span class="co"># Add correlation coefficient. see ?stat_cor</span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cor.coeff.args =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>, <span class="at">label.x =</span> <span class="fl">0.5</span>, <span class="at">label.sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-199-1.png" width="2400" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggscatter</span>(data,</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">&quot;Total CNVs (log10)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Total Indels (log10)&quot;</span>,</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="co"># Points color, shape and size</span></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">add =</span> <span class="st">&quot;reg.line&quot;</span>, <span class="co"># Add regressin line</span></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">add.params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightgray&quot;</span>), <span class="co"># Customize reg. line</span></span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="co"># Add confidence interval</span></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cor.coef =</span> <span class="cn">TRUE</span>, <span class="co"># Add correlation coefficient. see ?stat_cor</span></span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cor.coeff.args =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>, <span class="at">label.x =</span> <span class="fl">0.5</span>, <span class="at">label.sep =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-200-1.png" width="2400" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="cancer-type" class="section level3">
<h3>Cancer type</h3>
<div id="pcawg-cnv-number" class="section level4">
<h4>PCAWG CNV number</h4>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_group_distribution</span>(</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>  pcawg_summary,</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvar =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvar =</span> <span class="st">&quot;n_of_cnv&quot;</span>,</span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_angle =</span> <span class="dv">90</span>,</span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_size =</span> <span class="fl">0.3</span>,</span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Number of CNV&quot;</span></span>
<span id="cb255-9"><a href="#cb255-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-201-1.png" width="3600" style="display: block; margin: auto;" /></p>
</div>
<div id="pcawg-cna-burden" class="section level4">
<h4>PCAWG CNA burden</h4>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_group_distribution</span>(</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>  pcawg_summary,</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvar =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvar =</span> <span class="st">&quot;cna_burden&quot;</span>,</span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_angle =</span> <span class="dv">90</span>,</span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_size =</span> <span class="fl">0.3</span>,</span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;CNA burden&quot;</span></span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-202-1.png" width="3600" style="display: block; margin: auto;" /></p>
</div>
<div id="pcawg-sbs-number" class="section level4">
<h4>PCAWG SBS number</h4>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_group_distribution</span>(</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>  pcawg_summary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sbs =</span> <span class="fu">log10</span>(sbs <span class="sc">+</span> <span class="dv">1</span>)),</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvar =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvar =</span> <span class="st">&quot;sbs&quot;</span>,</span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_angle =</span> <span class="dv">90</span>,</span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_size =</span> <span class="fl">0.3</span>,</span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Number of SBS (log10)&quot;</span></span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-203-1.png" width="3600" style="display: block; margin: auto;" /></p>
</div>
<div id="pcawg-indel-number" class="section level4">
<h4>PCAWG Indel number</h4>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_group_distribution</span>(</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>  pcawg_summary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ids =</span> <span class="fu">log10</span>(ids <span class="sc">+</span> <span class="dv">1</span>)),</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvar =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvar =</span> <span class="st">&quot;ids&quot;</span>,</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_angle =</span> <span class="dv">90</span>,</span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_size =</span> <span class="fl">0.3</span>,</span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Number of Indel (log10)&quot;</span></span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-204-1.png" width="3600" style="display: block; margin: auto;" /></p>
</div>
<div id="tcga-cnv-number" class="section level4">
<h4>TCGA CNV number</h4>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_group_distribution</span>(</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>  tcga_summary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cancer_type)),</span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvar =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvar =</span> <span class="st">&quot;n_of_cnv&quot;</span>,</span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_angle =</span> <span class="dv">90</span>,</span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_size =</span> <span class="fl">0.3</span>,</span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Number of CNV&quot;</span></span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-205-1.png" width="4500" style="display: block; margin: auto;" /></p>
</div>
<div id="tcga-cna-burden" class="section level4">
<h4>TCGA CNA burden</h4>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_group_distribution</span>(</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>  tcga_summary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cancer_type)),</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvar =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvar =</span> <span class="st">&quot;cna_burden&quot;</span>,</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_angle =</span> <span class="dv">90</span>,</span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_size =</span> <span class="fl">0.3</span>,</span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;CNA burden&quot;</span></span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-206-1.png" width="4500" style="display: block; margin: auto;" /></p>
</div>
<div id="tcga-sbs-number" class="section level4">
<h4>TCGA SBS number</h4>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_group_distribution</span>(</span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>  tcga_summary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cancer_type)) <span class="sc">%&gt;%</span></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sbs =</span> <span class="fu">log10</span>(sbs <span class="sc">+</span> <span class="dv">1</span>)),</span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvar =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvar =</span> <span class="st">&quot;sbs&quot;</span>,</span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_angle =</span> <span class="dv">90</span>,</span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_size =</span> <span class="fl">0.3</span>,</span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Number of SBS (log10)&quot;</span></span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-207-1.png" width="4500" style="display: block; margin: auto;" /></p>
</div>
<div id="tcga-indel-number" class="section level4">
<h4>TCGA Indel number</h4>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_group_distribution</span>(</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>  tcga_summary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cancer_type)) <span class="sc">%&gt;%</span></span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">ids =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(ids), <span class="dv">0</span>, ids),</span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">ids =</span> <span class="fu">log10</span>(ids <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvar =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvar =</span> <span class="st">&quot;ids&quot;</span>,</span>
<span id="cb262-9"><a href="#cb262-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_by_fun =</span> <span class="cn">FALSE</span>,</span>
<span id="cb262-10"><a href="#cb262-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_angle =</span> <span class="dv">90</span>,</span>
<span id="cb262-11"><a href="#cb262-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_size =</span> <span class="fl">0.3</span>,</span>
<span id="cb262-12"><a href="#cb262-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Number of Indel (log10)&quot;</span></span>
<span id="cb262-13"><a href="#cb262-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-208-1.png" width="4500" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="variation-enrichment-in-cancer-types" class="section level3">
<h3>Variation enrichment in cancer types</h3>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>enrich_pcawg <span class="ot">&lt;-</span> <span class="fu">group_enrichment</span>(</span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>  pcawg_summary <span class="sc">%&gt;%</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CNA burden</span><span class="st">`</span> <span class="ot">=</span> cna_burden,</span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total CNVs</span><span class="st">`</span> <span class="ot">=</span> n_of_cnv,</span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total SNVs</span><span class="st">`</span> <span class="ot">=</span> sbs,</span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total Indels</span><span class="st">`</span> <span class="ot">=</span> ids</span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb263-9"><a href="#cb263-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">grp_vars =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb263-10"><a href="#cb263-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">enrich_vars =</span> <span class="fu">c</span>(<span class="st">&quot;CNA burden&quot;</span>, <span class="st">&quot;Total CNVs&quot;</span>, <span class="st">&quot;Total SNVs&quot;</span>, <span class="st">&quot;Total Indels&quot;</span>),</span>
<span id="cb263-11"><a href="#cb263-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">co_method =</span> <span class="st">&quot;wilcox.test&quot;</span></span>
<span id="cb263-12"><a href="#cb263-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_group_enrichment</span>(enrich_pcawg, <span class="at">cut_p_value =</span> <span class="cn">TRUE</span>, <span class="at">return_list =</span> <span class="cn">TRUE</span>)</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>cancer_type <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">rotate_x_text</span>(<span class="at">angle =</span> <span class="dv">45</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-210-1.png" width="1500" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>enrich_tcga <span class="ot">&lt;-</span> <span class="fu">group_enrichment</span>(</span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>  tcga_summary <span class="sc">%&gt;%</span></span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CNA burden</span><span class="st">`</span> <span class="ot">=</span> cna_burden,</span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total CNVs</span><span class="st">`</span> <span class="ot">=</span> n_of_cnv,</span>
<span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total SNVs</span><span class="st">`</span> <span class="ot">=</span> sbs,</span>
<span id="cb265-7"><a href="#cb265-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total Indels</span><span class="st">`</span> <span class="ot">=</span> ids</span>
<span id="cb265-8"><a href="#cb265-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb265-9"><a href="#cb265-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">grp_vars =</span> <span class="st">&quot;cancer_type&quot;</span>,</span>
<span id="cb265-10"><a href="#cb265-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">enrich_vars =</span> <span class="fu">c</span>(<span class="st">&quot;CNA burden&quot;</span>, <span class="st">&quot;Total CNVs&quot;</span>, <span class="st">&quot;Total SNVs&quot;</span>, <span class="st">&quot;Total Indels&quot;</span>),</span>
<span id="cb265-11"><a href="#cb265-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">co_method =</span> <span class="st">&quot;wilcox.test&quot;</span></span>
<span id="cb265-12"><a href="#cb265-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">show_group_enrichment</span>(enrich_tcga, <span class="at">cut_p_value =</span> <span class="cn">TRUE</span>, <span class="at">return_list =</span> <span class="cn">TRUE</span>)</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>cancer_type <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span> ggpubr<span class="sc">::</span><span class="fu">rotate_x_text</span>(<span class="at">angle =</span> <span class="dv">45</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-212-1.png" width="1500" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="r-session" class="section level1">
<h1>R Session:</h1>
<p><em>Many thanks to authors and contributors of all packages used in this project</em>.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code></pre></div>
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value                       
 version  R version 4.0.2 (2020-06-22)
 os       CentOS Linux 7 (Core)       
 system   x86_64, linux-gnu           
 ui       X11                         
 language EN                          
 collate  en_US.UTF-8                 
 ctype    en_US.UTF-8                 
 tz       Asia/Shanghai               
 date     2021-01-22                  

─ Packages ───────────────────────────────────────────────────────────────────
 package        * version    date       lib source          
 abind            1.4-5      2016-07-21 [1] CRAN (R 4.0.2)  
 annotate         1.68.0     2020-10-27 [1] Bioconductor    
 AnnotationDbi    1.52.0     2020-10-27 [1] Bioconductor    
 assertthat       0.2.1      2019-03-21 [1] CRAN (R 4.0.2)  
 backports        1.2.1      2020-12-09 [1] CRAN (R 4.0.2)  
 bayestestR       0.8.0      2020-12-05 [1] CRAN (R 4.0.2)  
 Biobase        * 2.50.0     2020-10-27 [1] Bioconductor    
 BiocGenerics   * 0.36.0     2020-10-27 [1] Bioconductor    
 BiocManager      1.30.10    2019-11-16 [1] CRAN (R 4.0.2)  
 bit              4.0.4      2020-08-04 [1] CRAN (R 4.0.2)  
 bit64            4.0.5      2020-08-30 [1] CRAN (R 4.0.2)  
 blob             1.2.1      2020-01-20 [1] CRAN (R 4.0.2)  
 bookdown         0.21       2020-10-13 [1] CRAN (R 4.0.2)  
 brew             1.0-6      2011-04-13 [1] CRAN (R 4.0.2)  
 broom            0.7.3      2020-12-16 [1] CRAN (R 4.0.2)  
 Cairo            1.5-12.2   2020-07-07 [1] CRAN (R 4.0.2)  
 callr            3.5.1      2020-10-13 [1] CRAN (R 4.0.2)  
 car              3.0-10     2020-09-29 [1] CRAN (R 4.0.2)  
 carData          3.0-4      2020-05-22 [1] CRAN (R 4.0.2)  
 cellranger       1.1.0      2016-07-27 [1] CRAN (R 4.0.2)  
 circlize         0.4.12     2021-01-08 [1] CRAN (R 4.0.2)  
 cli              2.2.0      2020-11-20 [1] CRAN (R 4.0.2)  
 clue             0.3-58     2020-12-03 [1] CRAN (R 4.0.2)  
 cluster          2.1.0      2019-06-19 [1] CRAN (R 4.0.2)  
 codetools        0.2-18     2020-11-04 [1] CRAN (R 4.0.2)  
 cola           * 1.9.0.1013 2021-01-08 [1] Bioconductor    
 colorspace       2.0-0      2020-11-11 [1] CRAN (R 4.0.2)  
 ComplexHeatmap * 2.7.3      2020-12-27 [1] git2r (@3612bf5)
 correlation    * 0.5.0      2020-12-02 [1] CRAN (R 4.0.2)  
 cowplot        * 1.1.1      2020-12-30 [1] CRAN (R 4.0.2)  
 crayon           1.3.4      2017-09-16 [1] CRAN (R 4.0.2)  
 crosstalk        1.1.1      2021-01-12 [1] CRAN (R 4.0.2)  
 curl             4.3        2019-12-02 [1] CRAN (R 4.0.2)  
 data.table       1.13.6     2020-12-30 [1] CRAN (R 4.0.2)  
 DBI              1.1.1      2021-01-15 [1] CRAN (R 4.0.2)  
 dbplyr           2.0.0      2020-11-03 [1] CRAN (R 4.0.2)  
 dendextend       1.14.0     2020-08-26 [1] CRAN (R 4.0.2)  
 desc             1.2.0      2018-05-01 [1] CRAN (R 4.0.2)  
 devtools         2.3.0      2020-04-10 [1] CRAN (R 4.0.2)  
 digest           0.6.27     2020-10-24 [1] CRAN (R 4.0.2)  
 doParallel       1.0.16     2020-10-16 [2] CRAN (R 4.0.2)  
 dplyr          * 1.0.2      2020-08-18 [1] CRAN (R 4.0.2)  
 DT               0.17       2021-01-06 [1] CRAN (R 4.0.2)  
 effectsize       0.4.3      2021-01-18 [1] CRAN (R 4.0.2)  
 ellipsis         0.3.1      2020-05-15 [1] CRAN (R 4.0.2)  
 eulerr           6.1.0      2020-03-09 [1] CRAN (R 4.0.2)  
 evaluate         0.14       2019-05-28 [1] CRAN (R 4.0.2)  
 ezcox          * 0.8.0      2020-09-25 [1] CRAN (R 4.0.2)  
 factoextra       1.0.7      2020-04-01 [1] CRAN (R 4.0.2)  
 fansi            0.4.1      2020-01-08 [1] CRAN (R 4.0.2)  
 farver           2.0.3      2020-01-16 [1] CRAN (R 4.0.2)  
 forcats        * 0.5.0      2020-03-01 [1] CRAN (R 4.0.2)  
 foreach          1.5.1      2020-08-12 [2] local           
 foreign          0.8-81     2020-12-22 [1] CRAN (R 4.0.2)  
 forestmodel      0.6.2      2020-07-19 [1] CRAN (R 4.0.2)  
 fs               1.5.0      2020-07-31 [1] CRAN (R 4.0.2)  
 furrr            0.2.1      2020-10-21 [1] CRAN (R 4.0.2)  
 future           1.21.0     2020-12-10 [1] CRAN (R 4.0.2)  
 genefilter       1.72.0     2020-10-27 [1] Bioconductor    
 generics         0.1.0      2020-10-31 [1] CRAN (R 4.0.2)  
 GetoptLong       1.0.5      2020-12-15 [1] CRAN (R 4.0.2)  
 ggcorrplot       0.1.3      2019-05-19 [1] CRAN (R 4.0.2)  
 ggforce          0.3.2      2020-06-23 [1] CRAN (R 4.0.2)  
 ggplot2        * 3.3.3      2020-12-30 [1] CRAN (R 4.0.2)  
 ggplotify        0.0.5      2020-03-12 [1] CRAN (R 4.0.2)  
 ggpubr         * 0.4.0      2020-06-27 [1] CRAN (R 4.0.2)  
 ggraph         * 2.0.4      2020-11-16 [1] CRAN (R 4.0.2)  
 ggrepel          0.9.1      2021-01-15 [1] CRAN (R 4.0.2)  
 ggridges       * 0.5.3      2021-01-08 [1] CRAN (R 4.0.2)  
 ggsci            2.9        2018-05-14 [1] CRAN (R 4.0.2)  
 ggsignif         0.6.0      2019-08-08 [1] CRAN (R 4.0.2)  
 ggwordcloud    * 0.5.0      2019-06-02 [1] CRAN (R 4.0.2)  
 GlobalOptions    0.1.2      2020-06-10 [1] CRAN (R 4.0.2)  
 globals          0.14.0     2020-11-22 [1] CRAN (R 4.0.2)  
 glue             1.4.2      2020-08-27 [1] CRAN (R 4.0.2)  
 graphlayouts     0.7.1      2020-10-26 [1] CRAN (R 4.0.2)  
 gridBase         0.4-7      2014-02-24 [1] CRAN (R 4.0.2)  
 gridExtra        2.3        2017-09-09 [1] CRAN (R 4.0.2)  
 gridGraphics     0.5-1      2020-12-13 [1] CRAN (R 4.0.2)  
 gtable           0.3.0      2019-03-25 [1] CRAN (R 4.0.2)  
 haven            2.3.1      2020-06-01 [1] CRAN (R 4.0.2)  
 hms              0.5.3      2020-01-08 [1] CRAN (R 4.0.2)  
 htmltools        0.5.0      2020-06-16 [1] CRAN (R 4.0.2)  
 htmlwidgets      1.5.3      2020-12-10 [1] CRAN (R 4.0.2)  
 httr             1.4.2      2020-07-20 [1] CRAN (R 4.0.2)  
 igraph           1.2.6      2020-10-06 [1] CRAN (R 4.0.2)  
 impute           1.64.0     2020-10-27 [1] Bioconductor    
 insight          0.12.0     2021-01-14 [1] CRAN (R 4.0.2)  
 IRanges          2.24.1     2020-12-12 [1] Bioconductor    
 iterators        1.0.13     2020-10-15 [1] CRAN (R 4.0.2)  
 jsonlite         1.7.2      2020-12-09 [1] CRAN (R 4.0.2)  
 km.ci            0.5-2      2009-08-30 [1] CRAN (R 4.0.2)  
 KMsurv           0.1-5      2012-12-03 [1] CRAN (R 4.0.2)  
 knitr          * 1.30       2020-09-22 [1] CRAN (R 4.0.2)  
 labeling         0.4.2      2020-10-20 [1] CRAN (R 4.0.2)  
 lattice          0.20-41    2020-04-02 [1] CRAN (R 4.0.2)  
 lifecycle        0.2.0      2020-03-06 [1] CRAN (R 4.0.2)  
 listenv          0.8.0      2019-12-05 [1] CRAN (R 4.0.2)  
 lubridate        1.7.9.2    2020-11-13 [1] CRAN (R 4.0.2)  
 magrittr         2.0.1      2020-11-17 [1] CRAN (R 4.0.2)  
 markdown         1.1        2019-08-07 [1] CRAN (R 4.0.2)  
 MASS             7.3-53     2020-09-09 [2] CRAN (R 4.0.2)  
 Matrix           1.3-2      2021-01-06 [1] CRAN (R 4.0.2)  
 matrixStats      0.57.0     2020-09-25 [1] CRAN (R 4.0.2)  
 mclust           5.4.7      2020-11-20 [1] CRAN (R 4.0.2)  
 memoise          1.1.0      2017-04-21 [1] CRAN (R 4.0.2)  
 mgcv             1.8-33     2020-08-27 [1] CRAN (R 4.0.2)  
 microbenchmark   1.4-7      2019-09-24 [1] CRAN (R 4.0.2)  
 modelr           0.1.8      2020-05-19 [1] CRAN (R 4.0.2)  
 munsell          0.5.0      2018-06-12 [1] CRAN (R 4.0.2)  
 nlme             3.1-151    2020-12-10 [1] CRAN (R 4.0.2)  
 NMF              0.23.0     2020-08-01 [1] CRAN (R 4.0.2)  
 openxlsx         4.2.3      2020-10-27 [1] CRAN (R 4.0.2)  
 parallelly       1.23.0     2021-01-04 [1] CRAN (R 4.0.2)  
 parameters       0.11.0     2021-01-15 [1] CRAN (R 4.0.2)  
 patchwork        1.1.1      2020-12-17 [1] CRAN (R 4.0.2)  
 pheatmap         1.0.12     2019-01-04 [1] CRAN (R 4.0.2)  
 pillar           1.4.7      2020-11-20 [1] CRAN (R 4.0.2)  
 pkgbuild         1.2.0      2020-12-15 [1] CRAN (R 4.0.2)  
 pkgconfig        2.0.3      2019-09-22 [1] CRAN (R 4.0.2)  
 pkgload          1.1.0      2020-05-29 [1] CRAN (R 4.0.2)  
 pkgmaker         0.32.2     2020-10-20 [1] CRAN (R 4.0.2)  
 plyr             1.8.6      2020-03-03 [1] CRAN (R 4.0.2)  
 png              0.1-7      2013-12-03 [2] CRAN (R 4.0.2)  
 polyclip         1.10-0     2019-03-14 [1] CRAN (R 4.0.2)  
 prettyunits      1.1.1      2020-01-24 [1] CRAN (R 4.0.2)  
 processx         3.4.5      2020-11-30 [1] CRAN (R 4.0.2)  
 ps               1.5.0      2020-12-05 [1] CRAN (R 4.0.2)  
 purrr          * 0.3.4      2020-04-17 [1] CRAN (R 4.0.2)  
 R.cache          0.14.0     2019-12-06 [1] CRAN (R 4.0.2)  
 R.methodsS3      1.8.1      2020-08-26 [1] CRAN (R 4.0.2)  
 R.oo             1.24.0     2020-08-26 [1] CRAN (R 4.0.2)  
 R.utils          2.10.1     2020-08-26 [1] CRAN (R 4.0.2)  
 R6               2.5.0      2020-10-28 [1] CRAN (R 4.0.2)  
 RColorBrewer     1.1-2      2014-12-07 [1] CRAN (R 4.0.2)  
 Rcpp             1.0.5      2020-07-06 [2] CRAN (R 4.0.2)  
 readr          * 1.4.0      2020-10-05 [1] CRAN (R 4.0.2)  
 readxl           1.3.1      2019-03-13 [1] CRAN (R 4.0.2)  
 registry         0.5-1      2019-03-05 [1] CRAN (R 4.0.2)  
 rematch2         2.1.2      2020-05-01 [1] CRAN (R 4.0.2)  
 remotes          2.2.0      2020-07-21 [1] CRAN (R 4.0.2)  
 reprex           0.3.0      2019-05-16 [1] CRAN (R 4.0.2)  
 reshape2         1.4.4      2020-04-09 [1] CRAN (R 4.0.2)  
 RevoUtils      * 11.0.2     2020-08-12 [2] local           
 RevoUtilsMath  * 11.0.0     2020-08-12 [2] local           
 rio              0.5.16     2018-11-26 [1] CRAN (R 4.0.2)  
 rjson            0.2.20     2018-06-08 [1] CRAN (R 4.0.2)  
 rlang            0.4.10     2020-12-30 [1] CRAN (R 4.0.2)  
 rmarkdown        2.6        2020-12-14 [1] CRAN (R 4.0.2)  
 rmdformats     * 1.0.1      2021-01-13 [1] CRAN (R 4.0.2)  
 rngtools         1.5        2020-01-23 [1] CRAN (R 4.0.2)  
 rprojroot        2.0.2      2020-11-15 [1] CRAN (R 4.0.2)  
 RSQLite          2.2.2      2021-01-08 [1] CRAN (R 4.0.2)  
 rstatix          0.6.0      2020-06-18 [1] CRAN (R 4.0.2)  
 rstudioapi       0.13       2020-11-12 [1] CRAN (R 4.0.2)  
 rvcheck          0.1.8      2020-03-01 [1] CRAN (R 4.0.2)  
 rvest            0.3.6      2020-07-25 [1] CRAN (R 4.0.2)  
 S4Vectors        0.28.1     2020-12-09 [1] Bioconductor    
 scales           1.1.1      2020-05-11 [1] CRAN (R 4.0.2)  
 see            * 0.6.1      2020-12-06 [1] CRAN (R 4.0.2)  
 sessioninfo      1.1.1      2018-11-05 [1] CRAN (R 4.0.2)  
 shape            1.4.5      2020-09-13 [1] CRAN (R 4.0.2)  
 sigminer       * 1.2.1.999  2021-01-20 [1] local           
 skmeans          0.2-13     2020-12-03 [1] CRAN (R 4.0.2)  
 slam             0.1-48     2020-12-03 [1] CRAN (R 4.0.2)  
 stringi          1.5.3      2020-09-09 [1] CRAN (R 4.0.2)  
 stringr        * 1.4.0      2019-02-10 [1] CRAN (R 4.0.2)  
 styler           1.3.2      2020-02-23 [1] CRAN (R 4.0.2)  
 survival       * 3.2-7      2020-09-28 [1] CRAN (R 4.0.2)  
 survminer      * 0.4.8      2020-07-25 [1] CRAN (R 4.0.2)  
 survMisc         0.5.5      2018-07-05 [1] CRAN (R 4.0.2)  
 testthat         3.0.1      2020-12-17 [1] CRAN (R 4.0.2)  
 tibble         * 3.0.4      2020-10-12 [1] CRAN (R 4.0.2)  
 tidygraph        1.2.0      2020-05-12 [1] CRAN (R 4.0.2)  
 tidyr          * 1.1.2      2020-08-27 [1] CRAN (R 4.0.2)  
 tidyselect       1.1.0      2020-05-11 [1] CRAN (R 4.0.2)  
 tidyverse      * 1.3.0      2019-11-21 [1] CRAN (R 4.0.2)  
 tweenr           1.0.1      2018-12-14 [1] CRAN (R 4.0.2)  
 usethis          2.0.0      2020-12-10 [1] CRAN (R 4.0.2)  
 utf8             1.1.4      2018-05-24 [1] CRAN (R 4.0.2)  
 vctrs            0.3.6      2020-12-17 [1] CRAN (R 4.0.2)  
 viridis          0.5.1      2018-03-29 [1] CRAN (R 4.0.2)  
 viridisLite      0.3.0      2018-02-01 [1] CRAN (R 4.0.2)  
 withr            2.3.0      2020-09-22 [1] CRAN (R 4.0.2)  
 xfun             0.20       2021-01-06 [1] CRAN (R 4.0.2)  
 XML              3.99-0.5   2020-07-23 [1] CRAN (R 4.0.2)  
 xml2             1.3.2      2020-04-23 [1] CRAN (R 4.0.2)  
 xtable           1.8-4      2019-04-21 [1] CRAN (R 4.0.2)  
 yaml             2.2.1      2020-02-01 [1] CRAN (R 4.0.2)  
 zip              2.1.1      2020-08-27 [1] CRAN (R 4.0.2)  
 zoo              1.8-8      2020-05-02 [1] CRAN (R 4.0.2)  

[1] /home/public/R/library
[2] /opt/microsoft/ropen/4.0.2/lib64/R/library</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-degasperiPracticalFrameworkOnline2020" class="csl-entry">
Degasperi, Andrea, Tauanne Dias Amarante, Jan Czarnecki, Scott Shooter, Xueqing Zou, Dominik Glodzik, Sandro Morganella, et al. 2020. <span>“A Practical Framework and Online Tool for Mutational Signature Analyses Show Intertissue Variation and Driver Dependencies.”</span> <em>Nature Cancer</em> 1 (2): 249–63. <a href="https://doi.org/10.1038/s43018-020-0027-5">https://doi.org/10.1038/s43018-020-0027-5</a>.
</div>
<div id="ref-kimExtrachromosomalDNAAssociated2020" class="csl-entry">
Kim, Hoon, Nam-Phuong Nguyen, Kristen Turner, Sihan Wu, Amit D. Gujar, Jens Luebeck, Jihe Liu, et al. 2020. <span>“Extrachromosomal <span>DNA</span> Is Associated with Oncogene Amplification and Poor Outcome Across Multiple Cancers.”</span> <em>Nature Genetics</em> 52 (9): 891–97. <a href="https://doi.org/10.1038/s41588-020-0678-2">https://doi.org/10.1038/s41588-020-0678-2</a>.
</div>
<div id="ref-martinez-jimenezCompendiumMutationalCancer2020" class="csl-entry">
Martínez-Jiménez, Francisco, Ferran Muiños, Inés Sentís, Jordi Deu-Pons, Iker Reyes-Salazar, Claudia Arnedo-Pac, Loris Mularoni, et al. 2020. <span>“A Compendium of Mutational Cancer Driver Genes.”</span> <em>Nature Reviews Cancer</em> 20 (10): 555–72. <a href="https://doi.org/10.1038/s41568-020-0290-x">https://doi.org/10.1038/s41568-020-0290-x</a>.
</div>
<div id="ref-mauraPracticalGuideMutational2019" class="csl-entry">
Maura, Francesco, Andrea Degasperi, Ferran Nadeu, Daniel Leongamornlert, Helen Davies, Luiza Moore, Romina Royo, et al. 2019. <span>“A Practical Guide for Mutational Signature Analysis in Hematological Malignancies.”</span> <em>Nature Communications</em> 10 (1): 2969. <a href="https://doi.org/10.1038/s41467-019-11037-8">https://doi.org/10.1038/s41467-019-11037-8</a>.
</div>
<div id="ref-nguyenPancancerLandscapeHomologous2020" class="csl-entry">
Nguyen, Luan, John Martens, Arne Van Hoeck, and Edwin Cuppen. 2020. <span>“Pan-Cancer Landscape of Homologous Recombination Deficiency.”</span> Preprint. <span>Cancer Biology</span>. <a href="https://doi.org/10.1101/2020.01.13.905026">https://doi.org/10.1101/2020.01.13.905026</a>.
</div>
<div id="ref-pcawgmutationalsignaturesworkinggroupRepertoireMutationalSignatures2020" class="csl-entry">
PCAWG Mutational Signatures Working Group, PCAWG Consortium, Ludmil B. Alexandrov, Jaegil Kim, Nicholas J. Haradhvala, Mi Ni Huang, Alvin Wei Tian Ng, et al. 2020. <span>“The Repertoire of Mutational Signatures in Human Cancer.”</span> <em>Nature</em> 578 (7793): 94–101. <a href="https://doi.org/10.1038/s41586-020-1943-3">https://doi.org/10.1038/s41586-020-1943-3</a>.
</div>
<div id="ref-pcawg-structuralvariationworkinggroupGenomicFootprintsActivated2020" class="csl-entry">
PCAWG-Structural Variation Working Group, PCAWG Consortium, Lina Sieverling, Chen Hong, Sandra D. Koser, Philip Ginsbach, Kortine Kleinheinz, et al. 2020. <span>“Genomic Footprints of Activated Telomere Maintenance Mechanisms in Cancer.”</span> <em>Nature Communications</em> 11 (1): 733. <a href="https://doi.org/10.1038/s41467-019-13824-9">https://doi.org/10.1038/s41467-019-13824-9</a>.
</div>
</div>
</div>
</div>

   
   
              </div>
  </div>
  </div>
  </div>
   
      

  <script>
    $(document).ready(function () {

		// add bootstrap table styles to pandoc tables
	$('tr.header').parent('thead').parent('table').addClass('table table-condensed');
		
 		
	    });
  </script>



    <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
	var script = document.createElement("script");
	script.type = "text/javascript";
	script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
	document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>
  
</body>
</html>
